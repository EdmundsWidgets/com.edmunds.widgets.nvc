!function(a,b,c,d){"use strict";var e="Microsoft Internet Explorer"===navigator.appName?!0:!1,f=function(a,b,c){return(f=document.getElementsByClassName?function(a,b,c){c=c||document;for(var d,e=c.getElementsByClassName(a),f=b?new RegExp("\\b"+b+"\\b","i"):null,g=[],h=0,i=e.length;i>h;h+=1)d=e[h],(!f||f.test(d.nodeName))&&g.push(d);return g}:document.evaluate?function(a,b,c){b=b||"*",c=c||document;for(var d,e,f=a.split(" "),g="",h="http://www.w3.org/1999/xhtml",i=document.documentElement.namespaceURI===h?h:null,j=[],k=0,l=f.length;l>k;k+=1)g+="[contains(concat(' ', @class, ' '), ' "+f[k]+" ')]";try{d=document.evaluate(".//"+b+g,c,i,0,null)}catch(m){d=document.evaluate(".//"+b+g,c,null,0,null)}for(;e=d.iterateNext();)j.push(e);return j}:function(a,b,c){b=b||"*",c=c||document;for(var d,e,f=a.split(" "),g=[],h="*"===b&&c.all?c.all:c.getElementsByTagName(b),i=[],j=0,k=f.length;k>j;j+=1)g.push(new RegExp("(^|\\s)"+f[j]+"(\\s|$)"));for(var l=0,m=h.length;m>l;l+=1){d=h[l],e=!1;for(var n=0,o=g.length;o>n&&(e=g[n].test(d.className),e);n+=1);e&&i.push(d)}return i})(a,b,c)};c.mixin({currency:function(a){return 0>a?(a*=-1,"($"+c.formatNumber(a)+")"):"$"+c.formatNumber(a)},formatNumber:function(a){return(Number(a)||0).toString().split(/(?=(?:\d{3})+(?:\.|$))/g).join(",")},rgb2hex:function(a){function b(a){return Number(a).toString(16).replace(/^(.)$/,"0$1")}return"#"+b(a.r)+b(a.g)+b(a.b)}});var g=a.NVC=function(e,h,i){var j,k,l=h;this.getDealerApiKey=function(){return l},a.Widget.call(this,e,i),c.extend(this,d.Events),this.htmlSetup=function(){function h(a){var b;for(b in a)return!1;return!0}function i(){return w&&A&&x?void C.removeAttribute("disabled"):void C.setAttribute("disabled","disabled")}function l(){b(E).closest(".nvcwidget-nav-bottom-inner").find(".msg-error").remove()}function m(a){A=!0,y.zipcode=a,this.configLeadForm.setOption("zip",a),this.vehicleFeaturesController.setZipCode(a),this.zipUpdate.updateZipCode(a),this.zipLocation.updateZipCode(a),this.zipMiField.updateZipCode(a),this.dealers.searchCriteria.unset("zipcode",{silent:!0}).set("zipcode",a),l(),this.zip=a,w&&this.vehiclePrice.loadPrice(this.configLeadForm.config.styleid,a,this.vehicleFeaturesController.getSelectedOptionsIds())}function n(){i(),k.eq(1).addClass("disable"),k.eq(2).addClass("disable")}var o=this,p=o.getBaseId(),q=o.getBaseClass(),r=o.getRootElement(),s=this.getOptions(),t=EDMUNDSAPI.Vehicle,u=this.getApiKey(),v=this.getDealerApiKey(),w=!1,x=!1,y={radius:100,rows:5,isPublic:!1,bookName:"",apiKey:v,premierOnly:!0,invalidTiers:"T1",keywords:s.dealerKeywords},z=this.zip="string"==typeof s.zip?s.zip:"",A=z?!0:!1,B="";if((navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i))&&(B="apple-device"),y.zipcode=z,null===r)throw new Error("Root element was not found.");r.innerHTML=c.template(g.template,{titleTooltip:g.TOOLTIP_TITLE,baseId:p,nav:B,baseClass:o.getBaseClass(),layoutType:s.layoutType});var C=document.getElementById(p+"_button"),D=document.getElementById(p+"_button2"),E=document.getElementById(p+"_button3"),F=f(q+"-list-dealer","div",document)[0],G=(document.getElementById(p+"_list_options"),document.getElementById(p+"_price")),H=document.getElementById(p+"_zip_location"),I=(document.getElementById(p+"_zip_mi"),document.getElementById(p+"_form")),J=document.getElementById(p+"_tmvprice"),K=!1;k=b("#"+p+"_tabs").find(".tab"),j=document.getElementById(p+"_tab_content"),this.printEmailOptions=new d.Model,this.styleConfigurator=new a.VehicleStyleConfigurator({apiKey:u,includedMakes:s.includedMakes}),document.getElementById(p+"_filters").appendChild(this.styleConfigurator.render().el),this.vehiclePhotos=new a.nvc.VehiclePhotos({vehicleApiKey:e,colorScheme:s.colorScheme}),document.getElementById(p+"_vehicle_details").appendChild(this.vehiclePhotos.render().el),this.vehicleDetails=new a.nvc.VehicleDetails,document.getElementById(p+"_vehicle_details").appendChild(this.vehicleDetails.el),this.vehicleDetails2=new a.nvc.VehicleDetails,document.getElementById(p+"_vehicle_details2").appendChild(this.vehicleDetails2.el),this.vehicleDetails3=new a.nvc.VehicleDetails,document.getElementById(p+"_vehicle_details3").appendChild(this.vehicleDetails3.el),this.vehicleFeaturesController=new a.controller.VehicleFeatures({vehicleApiKey:e,baseId:p,zipCode:z}),this.zipUpdate=new a.view.form.ZipUpdate({vehicleApiKey:e,zipCode:z}),b("#"+p+"_zip_configure").append(this.zipUpdate.render().el),this.zipLocation=new a.view.form.ZipLocation({vehicleApiKey:e,zipCode:z}),b(H).html(this.zipLocation.render().el),this.zipMiField=new a.view.form.ZipMiField({el:b("#"+p+"_zip_mi"),vehicleApiKey:e,zipCode:z,radius:y.radius}),this.zipMiField.render(),this.configLeadForm=new a.nvc.ConfigLeadForm(u),this.configLeadForm.setOption("zip",z),this.vehiclePrice=new a.nvc.VehiclePrice({el:G,vehicleApiKey:e}),this.dealers=new a.view.Dealers({el:b(F)}),this.dealers.searchCriteria.set({zipcode:z,api_key:v,keywords:(s.dealerKeywords||[]).join(",")},{silent:!0}),this.dealers.render(),this.messageDialog=new a.nvc.MessageDialog,this.vehicleForm=new a.ui.VehicleForm,this.vehicleForm.render(I),this.vehicleApi=new t(u),C.onclick=function(){o.showTab(k[s.tabs.tab2?1:2]),o.vehiclePrice.updateGraph(),o.trigger("nextbtn1.click")},D.onclick=function(){o.showTab(k[2]),o.trigger("nextbtn2.click")},E.onclick=function(){function d(a){r.appendChild(o.messageDialog.render(a).el),o.messageDialog.init(),o.messageDialog.on("reset",function(){o.showTab(k[0]),o.styleConfigurator.reset(),m.call(o,z),o.vehicleForm.resetValues(),o.styleConfigurator.findMakes(),o.trigger("dialogbtn.click"),o.trigger("reset")})}function e(){j.isSuccess=!0,d(j),E.removeAttribute("disabled"),E.innerHTML=s,o.trigger("leadformsubmit")}function f(){j.isSuccess=!1,d(j),E.removeAttribute("disabled"),E.innerHTML=s}var g,i=o.configLeadForm.config,j={isSuccess:!0,name:[i.year,i.makeName,i.model].join(" "),dealers:[]},n=[],p=h(i.dealers),q=new EDMUNDSAPI.Vehicle(v);if(q.submitLeadForm=function(a,d,e){return b.ajax({url:"http://widgets.edmunds.com/dealer/sendlead",data:c.defaults(a||{},{fmt:"json",api_key:v}),dataType:"jsonp",timeout:7e3,traditional:!0,success:d,error:e})},l(),p)return void b(E).closest(".nvcwidget-nav-bottom-inner").prepend('<div class="msg-error">At least 1 dealer must be selected.</div>');i.dealers.each(function(a){n.push(a.get("id")),j.dealers.push(a.get("name"))}),g={make:i.make,model:i.modelNiceName,year:i.year,style:i.styleid,optIds:i.options.join(","),pqrf_sbmtdlr:n,zip:i.zip,firstname:i.firstname,lastname:i.lastname,email:i.email,area_code:i.phoneCode,phone_prefix:i.phonePrefix,phone_suffix:i.phoneSuffix,client_key:a.util.ClientKeyGenerator.generate(16,36)};var s=E.innerHTML;E.setAttribute("disabled","disabled"),E.innerHTML="Getting dealer quotes...",q.submitLeadForm(g,e,f),o.trigger("submitbtn.click")},this.styleConfigurator.on("complete",function(a){var c=a.get("make"),d=a.get("model"),e=a.get("year"),f=a.get("style"),g=c.get("name"),h=c.get("niceName"),j=d.get("name"),k=d.get("niceName"),l=f.get("id");y.makeName=g,y.model=j,y.styleId=l,this.configLeadForm.setOption("make",h),this.configLeadForm.setOption("makeName",g),this.configLeadForm.setOption("model",j),this.configLeadForm.setOption("modelNiceName",k),this.configLeadForm.setOption("year",e.get("year")),this.configLeadForm.setOption("styleName",f.get("name")),this.configLeadForm.setOption("styleid",l),this.vehicleFeaturesController.setStyleId(l),this.zip&&(this.vehiclePhotos.loadPhotos(l),this.dealers.searchCriteria.set({makeName:g,model:j,styleid:l}),this.zipLocation.loadLocation(),this.vehiclePrice.loadPrice(l,this.zip,[])),this.resizeOptionsContainer(),o.vehiclePhotos.loadPhotos(l),x=!1,w=!0,i(),b(r).find(".get-started").hide()},this),this.styleConfigurator.on("error",function(a){r.appendChild(o.messageDialog.render({isSuccess:!1,text:c.isString(a)?a:'<p>Something went wrong!</p><p>Please return and try again or <a href="Mailto:api@edmunds.com">contact</a> us directly.</p>'}).el),o.messageDialog.init()}),this.styleConfigurator.on("reset",function(){this.vehiclePhotos.reset(),this.vehicleDetails.reset(),this.vehicleFeaturesController.reset(),this.configLeadForm.reset({contacts:!0,zip:!0}),this.vehicleForm.resetValues();var a=f("msg-error","div",E.parentNode)[0];a&&E.parentNode.removeChild(a),this.dealers.reset(),w=!1,K=!1,n(),b(r).find(".get-started").show()},this),this.vehicleFeaturesController.on("updatestatus",function(){var a=this.configLeadForm.config.styleid,b=this.configLeadForm.config.zip,c=this.vehicleFeaturesController.getSelectedOptionsIds();this.vehiclePrice.loadPrice(a,b,c),this.configLeadForm.setOption("options",c)},this),this.vehicleFeaturesController.on("load loaderror",function(){x=!0,i(),b(k[1]).removeClass("disable"),b(k[2]).removeClass("disable")},this),this.vehiclePrice.on("load",function(a,b){var d=o.configLeadForm.config,e={tmv:b.tmv.nationalBasePrice.tmv,baseMSRP:b.tmv.nationalBasePrice.baseMSRP,baseInvoice:b.tmv.nationalBasePrice.baseInvoice},f={name:[d.year,d.makeName,d.model].join(" "),description:d.styleName,price:e.baseMSRP};w&&(this.vehicleDetails.render(f,!0),this.vehicleDetails2.render(f,!1),this.vehicleDetails3.render(f,!1)),x?this.updatePrices(b):this.vehicleFeaturesController.getDefaultConfig({previous:w}).done(c.bind(function(){this.updatePrices(b)},this)),i()},this),this.updatePrices=function(d){var e,f,g={tmv:d.tmv.nationalBasePrice.tmv,baseMSRP:d.tmv.nationalBasePrice.baseMSRP,baseInvoice:d.tmv.nationalBasePrice.baseInvoice},h=this.configLeadForm.config,i={name:[h.year,h.makeName,h.model].join(" "),description:h.styleName};this.vehicleFeaturesController.selectedFeatures.collection.updatePrices(d.tmv),this.vehicleFeaturesController.selectedFeatures.setBasePrice(g),e=this.vehicleFeaturesController.selectedFeatures.collection.getTotalPrice(),f={tmv:g.tmv+e.tmv,baseMSRP:g.baseMSRP+e.baseMSRP,baseInvoice:g.baseInvoice+e.baseInvoice};var j=b(r).find(".incentives").hide();if(d.tmv.incentivesAndRebates>0){var k=new a.view.IncentivesAndRebates({el:j,turnedOn:K,incentive:d.tmv.incentivesAndRebates});k.on("change",function(a){var e=d.tmv.incentivesAndRebates*(a?-1:1);K=a,f.tmv+=e,b(J).html('True Market Value<sub>&reg;</sub>:&nbsp;<sub class="currency">$</sub><span class="price">'+c.formatNumber(f.tmv)+"</span>"),this.vehiclePrice.render({tmv:f.tmv,invoice:f.baseInvoice,msrp:f.baseMSRP})},this),k.render(),j.show(),K&&(f.tmv-=d.tmv.incentivesAndRebates)}L.find(".tab-2")[d.tmv.incentivesAndRebates>0?"addClass":"removeClass"]("with-insentive"),b(J).html('True Market Value<sub>&reg;</sub>:&nbsp;<sub class="currency">$</sub><span class="price">'+c.formatNumber(f.tmv)+"</span>"),this.vehiclePrice.render({tmv:f.tmv,invoice:f.baseInvoice,msrp:f.baseMSRP}),this.printEmailOptions.set({vehicleFullName:i.name,vehicleStyleName:i.description,totalPrice:f,basePrice:g,customerCashPrice:d.tmv.incentivesAndRebates}),this.configLeadForm.setOption("price",f)},this.vehiclePrice.on("loaderror",function(){r.appendChild(o.messageDialog.render({isSuccess:!1,text:'<p>Something went wrong!</p><p>Please return and try again or <a href="Mailto:api@edmunds.com">contact</a> us directly.</p>'}).el),o.messageDialog.init()}),this.zipUpdate.on("update",m,this),this.zipLocation.on("update",m,this),this.zipMiField.on("update",function(a,b){this.configLeadForm.setOption("radius",b),this.dealers.searchCriteria.set("radius",b,{silent:!0}),m.call(this,a)},this),this.dealers.on("select",function(){this.configLeadForm.setOption("dealers",this.dealers.getSelected()),E.disabled=!this.configLeadForm.validate(),l()},this),this.dealers.on("deselect",function(){this.configLeadForm.setOption("dealers",this.dealers.getSelected())},this),this.vehicleForm.on("update-request-form",function(a){this.configLeadForm.setOption(a.name,a.value)},this),this.configLeadForm.on("readytosubmit",function(a){E.disabled=!a},this);var L=b(r);L.find(".tab-2 .email-print-icons [data-action]").click(function(){var c,d=b(this).data("action"),f=new a.PrintEmailTemplate,g={vehicleFullName:o.printEmailOptions.get("vehicleFullName"),vehicleStyleName:o.printEmailOptions.get("vehicleStyleName"),features:o.vehicleFeaturesController.selectedFeatures.collection,basePrice:o.printEmailOptions.get("basePrice"),totalPrice:o.printEmailOptions.get("totalPrice"),customerCashPrice:o.printEmailOptions.get("customerCashPrice")};switch(d){case"email":c=prompt("Please enter e-mail address:"),c&&f.sendConfiguration(e,c,g);break;case"print":g.print=!0,f.printConfiguration(g)}}),L.find(".tab-3 .email-print-icons [data-action]").click(function(){var c,d=b(this).data("action"),f=new a.PrintEmailTemplate,g={vehicleFullName:o.printEmailOptions.get("vehicleFullName"),vehicleStyleName:o.printEmailOptions.get("vehicleStyleName"),premierDealers:o.dealers.premierDealers.collection,allDealers:o.dealers.allDealers.collection,basePrice:o.printEmailOptions.get("basePrice"),totalPrice:o.printEmailOptions.get("totalPrice"),customerCashPrice:o.printEmailOptions.get("customerCashPrice")};switch(d){case"email":c=prompt("Please enter e-mail address:"),c&&f.sendPriceQuotes(e,c,g);break;case"print":g.print=!0,f.printPriceQuotes(g)}}),k.eq(0).click(function(){b(this).hasClass("disable")||(o.trigger("tab:show",this,"Configure Tab"),o.trigger("tab1.click"))}),k.eq(1).click(function(){b(this).hasClass("disable")||(o.trigger("tab:show",this,"TMV Tab"),o.trigger("tab2.click"))}),k.eq(2).click(function(){b(this).hasClass("disable")||(o.trigger("tab:show",this,"Price Quote Tab"),o.trigger("tab3.click"))}),this.bindEvents(),this.zipUpdate.disable();var M=b(r).find(".nvcwidget-tabs");return M.find(".tab1 .tab-text").html(s.tabs.tab1?s.tabs.tab1:"Configure"),M.find(".tab2 .tab-text").html(s.tabs.tab2?s.tabs.tab2:"TMV&reg;"),M.find(".tab3 .tab-text").html(s.tabs.tab3?s.tabs.tab3:"Price Quotes"),c.isString(s.tabs.tab1)&&c.isString(s.tabs.tab2)&&c.isNull(s.tabs.tab3)&&(M.addClass("tab-layout-2"),M.find(".tab3").hide(),b(D).closest(".nvcwidget-top-footer").hide()),c.isString(s.tabs.tab1)&&c.isNull(s.tabs.tab2)&&c.isString(s.tabs.tab3)&&(M.addClass("tab-layout-2"),M.find(".tab2").hide(),b(C).text("Get Price Quote")),u&&v&&A&&(this.styleConfigurator.findMakes(),this.zipUpdate.enable()),this},this.showTab=function(a){var c,d=a.id.split("-").pop(),e=this.getBaseId(),g=this.getBaseClass(),h=f(g+"-tab-inner","",j),i=h.length;for(c=0;i>c;c+=1)b(h[c]).addClass("hide");return k.removeClass("active"),b(a).addClass("active"),b("#"+e+"_"+d).removeClass("hide"),this.trigger(d+":showed"),this}},h=g.prototype;b.extend(g.prototype,a.Widget.prototype),h.bindEvents=function(){return this.off(),this.on("tab:show",this.showTab,this),this.on("tab:show",function(){this.vehicleFeaturesController.closeCategory()},this),this.on("tab1:showed",this.resizeOptionsContainer,this),this.on("tab2:showed",this.resizeTMVTab,this),this.on("tab3:showed",this.resizePriceQuotesTab,this),this.vehicleDetails.on("render",this.resizeOptionsContainer,this),this.vehiclePhotos.on("render",this.resizeOptionsContainer,this),this},h.init=function(a){return a=a||{},this.setOptions(a),this.vehiclesApi=new EDMUNDSAPI.Vehicle(this.getApiKey()),this.zip=a.zip||"",this.trigger("init"),this},h.resizeOptionsContainer=function(){try{var a=document.getElementById(this.getBaseId()+"_tab1"),b=a.children,c=b[0],d=b[1],e=b[2];d.style.height=a.offsetHeight-(c.offsetHeight+e.offsetHeight+15)+"px"}catch(f){}return this},h.resizeListOptions=function(){try{var a=document.getElementById(this.getBaseId()+"_list_options"),b=a.children,c=b[0],d=b[1],e=b[2];d&&c&&e&&a&&(d.style.maxHeight=a.offsetHeight-(c.offsetHeight+e.offsetHeight+25)+"px")}catch(f){}return this.optionsList&&this.optionsList.resize(),this},h.resizeTMVTab=function(){var a,c,d,e=document.getElementById(this.getBaseId()+"_tab2"),f=this.getOptions().layoutType,g=e.children;if(e&&0!==g.length){try{a=g[0],d=g[1].children[0],c=g[2],d.style.height=e.offsetHeight-(a.offsetHeight+c.offsetHeight+20)+"px",g=d.children;for(var h=0,i=0,j=g.length;j>i;i++)1!==i&&(h+=g[i].offsetHeight);if(g[1].style.height=d.offsetHeight-h-20+"px","narrow"===f||"medium"===f){var k=b(".tab-2 .w1"),l=b(".tab-2 .w2");k.find(".nvcwidget-list-options").outerHeight(k.outerHeight()-l.outerHeight())}}catch(m){}return this.vehicleFeaturesController.selectedFeatures.resize(),this}},h.resizePriceQuotesTab=function(){var a,b,c,d,e=document.getElementById(this.getBaseId()+"_tab3"),f=e.children;if(e&&0!==f.length){try{a=f[0],c=f[1].children[0],b=f[2],d=f[3],c.style.height=e.offsetHeight-(a.offsetHeight+b.offsetHeight+d.offsetHeight+20)+"px",f=c.children;for(var g=0,h=0,i=f.length;i>h;h++)1!==h&&(g+=f[h].offsetHeight);f[1].style.height=c.offsetHeight-g-20+"px",f[1].children[1].style.maxHeight=f[1].offsetHeight-f[1].children[0].offsetHeight+"px"}catch(j){}return this}},h.render=function(){return this.htmlSetup(),this.reset(),this.trigger("render"),this},h.reset=function(){return this.styleConfigurator.reset(),this.resizeOptionsContainer(),this},h.updateZipCode=function(){},g.template=['<div class="<%= baseClass %>-inner <%= nav %>">','<div class="<%= baseClass %>-header noise-bg">',"<div>",'<span class="title">NEW VEHICLE CONFIGURATOR</span>','<span class="question" onclick="">',"<sup>?</sup>",'<div class="nvcwidget-tooltip"><div class="arrow-left"></div><%= titleTooltip %></div>',"</span>","</div>","</div>",'<div class="<%= baseClass %>-tabs" id="<%= baseId %>_tabs">','<div class="tab tab1 active" id="<%= baseId %>-tab1"><span class="tab-text">Configure</span></div>','<div class="tab tab2 disable" id="<%= baseId %>-tab2"><span class="tab-text">TMV&reg;</span></div>','<div class="tab tab3 disable" id="<%= baseId %>-tab3"><span class="tab-text">Price Quotes</span></div>',"</div>",'<div class="<%= baseClass %>-tab-content" id="<%= baseId %>_tab_content">','<div class="<%= baseClass %>-tab-inner tab-1" id="<%= baseId %>_tab1">','<div class="noise-bg"><div class="bottom-shadow clearfix">','<% if (layoutType === "narrow") { %>','<div class="<%= baseClass %>-filters">','<div class="filters" id="<%= baseId %>_filters"></div>','<div class="zip-code" id="<%= baseId %>_zip_configure"></div>',"</div>",'<div class="<%= baseClass %>-image" id="<%= baseId %>_vehicle_details"></div>',"<% } else { %>",'<div class="<%= baseClass %>-image" id="<%= baseId %>_vehicle_details"></div>','<div class="<%= baseClass %>-filters">','<div class="filters" id="<%= baseId %>_filters"></div>','<div class="zip-code" id="<%= baseId %>_zip_configure"></div>',"</div>","<% } %>","</div></div>",'<div class="<%= baseClass %>-options-outer">','<div class="get-started">',"<h1>Get Started</h1>","<p>Select <strong>Make</strong>, <strong>Model</strong>, <strong>Year</strong> and <strong>Style</strong> to get full list of available options</p>",'<div class="arrow"></div>',"</div>",'<div class="<%= baseClass %>-options" id="<%= baseId %>_options"></div>','<div class="category-features-list" id="<%= baseId %>_category_features_list"></div>',"</div>",'<div class="<%= baseClass %>-nav-bottom">','<button type="button" disabled="disabled" id="<%= baseId %>_button" class="button-block">Get Price</button>',"</div>","</div>",'<div class="<%= baseClass %>-tab-inner tab-2 hide" id="<%= baseId %>_tab2">','<div class="<%= baseClass %>-inner-header">','<div class="<%= baseClass %>-image" id="<%= baseId %>_vehicle_details3"></div>',"</div>",'<div class="shadow-top noise-bg">','<div class="<%= baseClass %>-body">','<div class="<%= baseClass %>-inner-zip zip-location" id="<%= baseId %>_zip_location"></div>','<div class="w1">','<% if (layoutType === "narrow" || layoutType === "medium") { %>','<div class="<%= baseClass %>-list-options" id=<%= baseId %>_list_options></div>','<div class="w2">','<div class="<%= baseClass %>-price" id="<%= baseId %>_price"></div>','<div class="incentives"></div>',"</div>","<% } else { %>",'<div class="w2">','<div class="<%= baseClass %>-price" id="<%= baseId %>_price"></div>','<div class="incentives"></div>',"</div>",'<div class="<%= baseClass %>-list-options" id=<%= baseId %>_list_options></div>',"<% } %>","</div>",'<ul class="email-print-icons">','<li data-action="email"><i class="icon-email"></i>e-mail</li>','<li data-action="print"><i class="icon-print"></i>print</li>',"</ul>","</div>","</div>",'<div class="<%= baseClass %>-top-footer"><button type="button" id="<%= baseId %>_button2">GET PRICE QUOTE</button><span>Next Step</span></div>',"</div>",'<div class="<%= baseClass %>-tab-inner tab-3 hide" id="<%= baseId %>_tab3">','<div class="<%= baseClass %>-inner-header">','<% if (layoutType === "narrow") { %>','<div class="<%= baseClass %>-image" id="<%= baseId %>_vehicle_details2"></div>','<div class="tmvprice" id="<%= baseId %>_tmvprice"></div>',"<% } else { %>",'<div class="tmvprice" id="<%= baseId %>_tmvprice"></div>','<div class="<%= baseClass %>-image" id="<%= baseId %>_vehicle_details2"></div>',"<% } %>","</div>",'<div class="shadow-top noise-bg">','<div class="<%= baseClass %>-body">','<div class="<%= baseClass %>-inner-zip" id="<%= baseId %>_zip_mi"></div>','<div class="<%= baseClass %>-list-dealer">','<div class="tab-bar">','<ul class="navbar">','<li class="tab tab-premier active" data-tab-id="premier"><div><div><span>Premier Dealers</span></div></div></li>','<li class="tab" data-tab-id="all"><div><div><span>All Dealers</span></div></div></li>',"</ul>",'<div class="tab-strip"></div>',"</div>",'<div class="tab-content">','<div class="tab-panel tab-panel-premier active"></div>','<div class="tab-panel tab-panel-all"></div>',"</div>","</div>",'<ul class="email-print-icons">','<li data-action="email"><i class="icon-email"></i>e-mail</li>','<li data-action="print"><i class="icon-print"></i>print</li>',"</ul>","</div>","</div>",'<div class="<%= baseClass %>-top-footer" id="<%= baseId %>_form">',"</div>",'<div class="<%= baseClass %>-nav-bottom">','<div class="<%= baseClass %>-nav-bottom-inner">','<div class="button-wrapper">','<button type="button" disabled class="button-green" id="<%= baseId %>_button3">GET DEALER QUOTE</button>',"</div>","</div>","</div>","</div>","</div>",'<div class="<%= baseClass %>-footer">','<a href="http://developer.edmunds.com/tmv_widget_terms" class="copy" target="_blank">Legal Notice</a>','<div class="logo">Built by<a href="http://www.edmunds.com/" target="_blank"></a></div>',"</div>","</div>"].join(""),g.TOOLTIP_TITLE="The New Vehicle Configurator is a tool that helps you customize a new vehicle, see what others in your area are paying for it on average, and get a FREE price quote from a dealership near you.",g.TOOLTIP_TMV="The Edmunds.com TMV® (Edmunds.com True Market Value®) price is the average price that others have paid for this car in the zip code provided.",g.TOOLTIP_INVOICE="This is the price the dealer paid for this car, including destination charges.",g.TOOLTIP_MSRP="This is the price the manufacturer recommends selling the car for. Most consumers end up purchasing their car for less than MSRP.",g.TOOLTIP_TRADEIN="This is the amount you can expect to receive when you trade in your used car and purchase a new car. The trade-in price is usually credited as a down payment on the new car.",g.TOOLTIP_PRIVATEPARTY="This is the amount at which the car is sold to or purchased by a private party, not a car dealer. This amount is usually more than the trade-in price but less than the dealer retail price.",g.TOOLTIP_TMVRETAIL="This is the average price that others have paid for this car in the zip code provided. Dealer retail will usually be higher than private party prices and much higher than trade-in prices.",g.TOOLTIP_CUSTOMERCASH="Rebates provided by the manufacturer directly to the customer at the time the vehicle is purchased to lower the final price of the vehicle. Consumers usually may elect to either receive this amount in cash or to credit the rebate as part of the vehicle's down payment.",a.namespace("util").ClientKeyGenerator=function(){function a(a,b){return d.floor(d.random()*(b-a+1)+a)}function b(b,c){for(var d,e=[],f=0;b>f;f++)d=a(0,c-1),e[f]=d.toString(c);return e}function c(a,c){for(var d,e=b(a,c),f=0,g=0,h=1,i=2;a>i;)f+=parseInt(e[h],c)^++g,d=h,h=i,i=d+h;return e[h]=(f%c).toString(c),e.join("")}var d=Math;return{generate:c}}(),a.PrintEmailTemplate=function(){function a(){e=document.createElement("iframe"),e.style.display="none",h.appendChild(e),f=e.contentWindow,g=e.contentDocument||f.document}function c(a){g&&(g.open(),g.write(a),g.close())}function d(){h.removeChild(e),e=f=g=void 0}var e,f,g,h=document.body,i="http://api.edmunds.com/api/emp/esp/sendEmail",j="api@edmunds.com",k="Edmunds.com",l="api@edmunds.com",m="Your New Vehicle Configuration Details";this.printConfiguration=function(b){var e=this.getConfigurationHTML(b);a(),c(e),f.print(),d()},this.printPriceQuotes=function(b){var e=this.getPriceQuotesHTML(b);a(),c(e),f.print(),d()},this.sendConfiguration=function(a,c,d){b.ajax({url:i,type:"POST",data:{api_key:a,fromAddress:j,fromNiceName:k,toAddress:c,replyToAddress:l,emailSubject:m,emailBody:this.getConfigurationBodyHTML(d)}})},this.sendPriceQuotes=function(a,c,d){b.ajax({url:i,type:"POST",data:{api_key:a,fromAddress:j,fromNiceName:k,toAddress:c,replyToAddress:l,emailSubject:m,emailBody:this.getPriceQuotesBodyHTML(d)}})}},a.PrintEmailTemplate.prototype={getLogoSection:function(a){var b="data:image/png;base64,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",c="http://static.ed.edmunds-media.com/unversioned/img/logo.png",d=a?b:c;
return'<img src="'+d+'" alt="Edmunds.com" height="36" width="109" />'},getDescriptionSection:function(a,b){return['<div class="vehicle-description">','<div class="name">'+a+"</div>","<div>"+b+"</div>","</div>"].join("")},getPricesSection:function(a){return["<h2>New Car Prices</h2>",'<div class="prices">','<div class="note">* Price as configured</div>',a.baseMSRP?"<div>MSRP: "+c.currency(a.baseMSRP)+"</div>":"",a.baseInvoice?"<div>Invoice: "+c.currency(a.baseInvoice)+"</div>":"",a.tmv?"<div><b>True Market Value<sup>&reg</sup>: "+c.currency(a.tmv)+"</b></div>":"","</div>"].join("")},getIncentivesSection:function(a){return a>0?["<h2>Incentives</h2>",'<div class="incentives">Customer Cash: '+c.currency(a)+"</div>"].join(""):""},getFeaturesSection:function(a,b){var d=["<h2>Your selected options</h2>",'<table class="table-features">',"<thead>","<tr>","<th>Description</th>",'<th class="price">MSRP</th>',"</tr>","<tr>","<th>Base Price</th>",'<th class="price">'+c.currency(b.baseMSRP)+"</th>","</tr>","</thead>","<tbody>"].join("");return a&&a.each(function(a){var b=a.get("price").baseMSRP;c.isNull(b)||(d+=["<tr>","<td>"+a.get("name")+"</td>",'<td class="price">'+(a.isIncluded()?"included":c.currency(b))+"</td>","</tr>"].join(""))}),d+=["</tbody>","<tfoot>","<tr>","<th>Total Price</th>",'<th class="price">'+c.currency(b.baseMSRP+(a?a.getTotalPrice().baseMSRP:0))+"</th>","</tr>","</tfoot>","</table>"].join("")},getDealersSection:function(a,b){return['<table class="table-dealers">',"<thead>","<tr>",'<th class="col">Premier Dealers</th>','<th class="space"></th>','<th class="col">All Dealers</th>',"</tr>","</thead>","<tbody>","<tr>",'<td class="col">'+this.getDealersList(a)+"</td>",'<td class="space"></td>','<td class="col">'+this.getDealersList(b)+"</td>","</tr>","</tbody>","</table>"].join("")},getDealersList:function(a){var b="";return a&&(b+="<table><tbody>",a.each(function(a){b+=["<tr>","<td>",'<div class="name"><b>'+(a.get("name")||"&nbsp;")+"</b></div>",'<div class="distance">'+(a.getDistance()||"&nbsp;")+" mi away</div>",'<div class="address">'+(a.getAddress()||"&nbsp;")+"</div>",'<div class="phone"><b>'+(a.getPhone()||"&nbsp;")+"</b></div>","</td>","</tr>"].join("")}),b+="</tbody></table>"),b},getFooterSection:function(){return'<div class="footer">&copy; Edmunds Inc. All rights Reserved. This information was extracted from www.edmunds.com and is subject to the terms of the Visitor Agreement at http://www.edmunds.com/about/visitor-agreement.html</div>'},getCommonStyles:function(){return["<style>","body{font-family:Arial,sans-serif;font-size:12px;line-height:1.5}","h2{font-size:14px;margin:15px 0 5px}",".container{padding-top:10px;width:700px}",".vehicle-description{border-bottom:1px solid #ddd;font-size:14px;padding:15px 0}",".vehicle-description .name{font-weight:700}",".prices{border:1px solid #000;font-size:18px;list-style:none;margin:0;padding:10px 20px}",".prices .note{font-size:12px;line-height:1;margin-top:-5px;text-align:right}",".incentives{border:1px solid #000;font-size:18px;padding:10px 20px}",".footer{border-top:1px solid #ddd;color:#555;font-size:11px;margin-top:30px;padding:15px 0}","</style>"].join("")},getConfigurationStyles:function(){return["<style>",".table-features{border:0;border-collapse:collapse}",".table-features th{text-align:left}",".table-features th,.table-features td{padding:7px 0}",".table-features .price{padding-left:75px;text-align:right}","</style>"].join("")},getPriceQuotesStyles:function(){return["<style>",".table-dealers{border:0;border-collapse:collapse;margin-top:20px;width:100%}",".table-dealers th{text-align:left}",".table-dealers .space{width:10%}",".table-dealers .col{width:45%}",".table-dealers table{border:1px solid black;border-collapse:collapse;width:100%}",".table-dealers table, .table-dealers table td{border:1px solid black}",".table-dealers table td{padding:10px 15px}","</style>"].join("")},getConfigurationBodyHTML:function(a){return[this.getCommonStyles(),this.getConfigurationStyles(),'<table style="border:0;border-collapse:collapse;width:700px"><tbody><tr><td>',this.getLogoSection(a.print),this.getDescriptionSection(a.vehicleFullName,a.vehicleStyleName),this.getPricesSection(a.totalPrice),this.getIncentivesSection(a.customerCashPrice),this.getFeaturesSection(a.features,a.basePrice),this.getFooterSection(),"</td></tr></tbody></table>"].join("")},getPriceQuotesBodyHTML:function(a){return[this.getCommonStyles(),this.getPriceQuotesStyles(),'<table style="border:0;border-collapse:collapse;width:700px"><tbody><tr><td>',this.getLogoSection(a.print),this.getDescriptionSection(a.vehicleFullName,a.vehicleStyleName),this.getPricesSection(a.totalPrice),this.getIncentivesSection(a.customerCashPrice),this.getDealersSection(a.premierDealers,a.allDealers),this.getFooterSection(),"</td></tr></tbody></table>"].join("")},getConfigurationHTML:function(a){return['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">','<html xmlns="http://www.w3.org/1999/xhtml">',"<head>",'<meta http-equiv="Content-Type" content="text/html; charset=utf-8">',"<title>Configuration</title>","</head>","<body>",this.getConfigurationBodyHTML(a),"</body>","</html>"].join("")},getPriceQuotesHTML:function(a){return['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">','<html xmlns="http://www.w3.org/1999/xhtml">',"<head>",'<meta http-equiv="Content-Type" content="text/html; charset=utf-8">',"<title>Price Quotes</title>","</head>","<body>",this.getPriceQuotesBodyHTML(a),"</body>","</html>"].join("")}},a.namespace("ui").Validator=function(){function c(){}var d=/[0-9]/,e=/^[0-1]/,f=/^(.)\1{6}$/,g=/^[0-9]+$/,h=/^\-?[0-9]*\.?[0-9]+$/,i=/^([0-9a-zA-Z]([\-.\w]*[0-9a-zA-Z])*@([0-9a-zA-Z][\-\w]*[0-9a-zA-Z]\.)+[a-zA-Z]{2,9})$/,j=/^[A-Za-z0-9](([_\.\-]?[a-zA-Z0-9]+)*)@([A-Za-z0-9]+)(([\.\-]?[a-zA-Z0-9]+)*)\.([A-Za-z]{2,3})$/,k=/[\*\^<>\\\"\.\;\:\[\]\(\)\{\}\!\@\_]/,l=/^[a-z]+([\-][a-z]+)*?$/i,m=/(.)\1{2}/i,n=/[bcdfghjklmnpqrstvwxz]{6}/i,o=/^(ng|([a-z\-]*?[a|e|i|o|u|y][a-z\-]*?))$/i,p=a.util.Array.contains;return c.prototype={required:function(a){var c=b.trim(a.value);return null!==c&&""!==c},nameLength:function(a){var c=b.trim(a.value);return c.length>=2},alpha:function(a){var c=b.trim(a.value);return l.test(c)},noSpecialCharacters:function(a){return!k.test(a.value)},noNumeric:function(a){return!d.test(a.value)},decimal:function(a){return h.test(a.value)||!a.value.length},excludeCode:function(a){var b=[222,333,411,444,456,500,555,666,777,911,900,999],c=a.value;return c=parseInt(c,10),!p(b,c)&&"000"!==a.value},excludePrefix:function(a){var b=[411,555,611,911],c=a.value;return c=parseInt(c,10),!p(b,c)},minLength:function(a){var c=b.trim(a.value),d=a.maxLength;return c.length===d},email:function(a){var c=b.trim(a.value);return i.test(c)},emailDomain:function(a){var c=b.trim(a.value);return j.test(c)},maxValue:function(a){return a.value<=100},integer:function(a){return g.test(b.trim(a.value))},noRepeatSame:function(a){var c=b.trim(a.value);return!m.test(c)},noRepeatConsanant:function(a){return!n.test(a.value)},containsVowel:function(a){var c=b.trim(a.value);return o.test(c)},firstDigit:function(a){return!e.test(b.trim(a.value))},phone:function(){var a=b.trim(b('[name="phonePrefix"]').val()),c=b.trim(b('[name="phoneSuffix"]').val());if(3===a.length&&4===c.length){var d=a+c;return!f.test(d)}return!0}},c}(),a.namespace("ui").Tooltip=function(){var b=a.ui.View;return b.extend({className:"edm-tooltip",initialize:function(a){this.render(a.text)},render:function(a){var b=document.createElement("div"),c=document.createElement("span");c.innerHTML=a||"",b.className="arrow-left",this.el.appendChild(b),this.el.appendChild(c)},setText:function(a){this.el.getElementsByTagName("span")[0].innerHTML=a},show:function(){this.el.style.display="block"},hide:function(){this.el.style.display="none"}})}(),a.namespace("ui").Button=function(){var b=a.ui.View;return b.extend({tagName:"button",events:{click:"onClick"},onClick:function(){this.trigger("click")},setText:function(a){return this.el.innerHTML=a,this},disable:function(){return this.el.setAttribute("disabled","disabled"),this},enable:function(){return this.el.removeAttribute("disabled"),this}})}(),a.namespace("ui").TextField=function(){var b=a.ui.View,c=a.ui.Tooltip,d=(a.api.Region,a.event.KeyCode,a.util.Array.contains,a.dom.Element),e=new a.ui.Validator;return b.extend({tagName:"input",className:"",attributes:{type:"text"},events:{focus:"hideLabel",blur:"showLabel",change:"validate",keyup:"validate"},initialize:function(a){a.validators&&(this.validators=a.validators)},render:function(a){var b,c,d,e=this.el;return b=document.createElement("label"),b.className=e.name,c=document.createElement("span"),c.className="text-label",c.innerHTML=e.alt,a.appendChild(b),b.appendChild(c),e.maxLength>4&&(d=document.createElement("span"),d.innerHTML="*",c.innerHTML=e.title,c.appendChild(d)),b.appendChild(e),this.renderTooltip(),this},renderTooltip:function(){var a=this.tooltip=new c({className:"nvcwidget-tooltip",text:""});return this.el.parentNode&&this.el.parentNode.insertBefore(this.tooltip.el,this.el.nextSibling),a.hide(),this.on("valid",a.hide,a),this.on("error",a.show,a),this},showLabel:function(){var a=this.el;!a.value&&f("text-label","",a.parentNode)[0]&&(f("text-label","",a.parentNode)[0].style.display="block"),this.tooltip.hide()},hideLabel:function(){f("text-label","",this.el.parentNode)[0]&&(f("text-label","",this.el.parentNode)[0].style.display="none")},reset:function(){var a=new d(this.el.parentNode);a.removeClass("invalid"),this.el.value="",this.showLabel()},validate:function(){var a,b,c=this.validators,f=this.el,g=new d(f.parentNode);this.trigger("focus");for(a in c){if(b=e[a](f),!b)return this.tooltip.setText(c[a].message.replace("%s",f.title)),g.addClass("invalid"),this.trigger("error"),void this.trigger("change",{isValid:b,fieldName:f.name,fieldValue:f.value});g.removeClass("invalid"),this.trigger("valid")}this.trigger("change",{isValid:b,fieldName:f.name,fieldValue:f.value})},validateField:function(){var a,b,c=this.validators,f=this.el,g=new d(f.parentNode);for(a in c){if(b=e[a](f),!b)return g.addClass("invalid"),{isValid:b,fieldName:f.name,fieldValue:f.value};g.removeClass("invalid")}return{isValid:b,fieldName:f.name,fieldValue:f.value}}})}(),a.namespace("ui").PhoneFieldGroup=function(){{var b=a.ui.View,c=(a.ui.Tooltip,a.ui.TextField);a.api.Region,a.event.KeyCode,new a.ui.Validator}return b.extend({initialize:function(){var a=this.phoneCode=new c({className:"code-field",attributes:{type:"text",name:"phoneCode",title:"Area Code",alt:"999",maxLength:3,required:"required"},validators:{required:{message:"The %s field is required"},integer:{message:"%s must contain digits only"},firstDigit:{message:"%s must not begin with 0 or 1"},excludeCode:{message:"Must not be 000, 222, 333, 411, 444, 456, 500, 555, 666, 777, 911, 900, or 999"},decimal:{message:"%s must contain 3 digits"},minLength:{message:"%s must contain 3 digits"}}}),b=this.phonePrefix=new c({className:"prefix-field",attributes:{type:"text",name:"phonePrefix",title:"Prefix",alt:"999",maxLength:3,required:"required"},validators:{required:{message:"The %s field is required"},integer:{message:"%s must contain digits only"},firstDigit:{message:"%s must not begin with 0 or 1"},excludePrefix:{message:"Must not be 411, 555, 611 or 911"},phone:{message:"Phone number is invalid"},decimal:{message:"%s must contain 3 digits"},minLength:{message:"%s must contain 3 digits"}}}),d=this.phoneSuffix=new c({className:"suffix-field",attributes:{type:"text",name:"phoneSuffix",title:"Suffix",alt:"9999",maxLength:4,required:"required"},validators:{required:{message:"The %s field is required"},integer:{message:"%s must contain digits only"},phone:{message:"Phone number is invalid"},decimal:{message:"%s must contain 4 digits"},minLength:{message:"%s must contain 4 digits"}}});this.fields=[a,b,d]},bindEvents:function(){this.phoneCode.on("change",this.validate,this),this.phonePrefix.on("change",this.validate,this),this.phoneSuffix.on("change",this.validate,this)},render:function(a){for(var b=this.fields,c=b.length,d=0;c>d;d+=1)b[d].render(a);return this.bindEvents(),this},reset:function(){var a=this.fields,b=a.length,c=0;for(c=0;b>c;c+=1)a[c].reset()},validate:function(){var a,b=this.fields,c=b.length,d=0;for(d=0;c>d;d+=1)a=b[d].validateField(),this.trigger("change",a)},changeAvailable:function(a){var b,c=this.fields;for(b in c)c.hasOwnProperty(b)&&(c[b].el.disabled=a?!1:!0)}})}(),a.namespace("ui").VehicleForm=function(){{var c=a.ui.View,d=(a.ui.Tooltip,a.ui.TextField),e=a.ui.PhoneFieldGroup,f=(a.api.Region,a.event.KeyCode,a.template);a.util.Array.contains,new a.ui.Validator}return c.extend({initialize:function(){var a=this.firstname=new d({attributes:{type:"text",name:"firstname",title:"First Name",required:"required",maxlength:50},validators:{required:{message:"The %s field is required"},nameLength:{message:"Must contain at least 2 characters"},noNumeric:{message:"The %s field cannot contain numbers"},noSpecialCharacters:{message:'Must not contain any special characters such as * ^ < > \\ " . ; : [ ] ( ) { } ! @ _'},alpha:{message:"The %s field is invalid"},noRepeatSame:{message:"Must not contain 3 of the same letter concurrently"},noRepeatConsanant:{message:"Must not contain 6 consecutive consonants"},containsVowel:{message:"Must contain a vowel"}}}),b=this.lastname=new d({attributes:{type:"text",name:"lastname",title:"Last Name",required:"required",maxlength:50},validators:{required:{message:"The %s field is required"},nameLength:{message:"Must contain at least 2 characters"},noNumeric:{message:"The %s field cannot contain numbers"},noSpecialCharacters:{message:'Must not contain any special characters such as * ^ < > \\ " . ; : [ ] ( ) { } ! @ _'},alpha:{message:"The %s field is invalid"},noRepeatSame:{message:"Must not contain 3 of the same letter concurrently"},noRepeatConsanant:{message:"Must not contain 6 consecutive consonants"},containsVowel:{message:"Must contain a vowel"}}}),c=this.email=new d({attributes:{type:"text",name:"email",title:"E-mail",required:"required",maxlength:50},validators:{required:{message:"The %s field is required"},email:{message:"The %s field is invalid"},emailDomain:{message:"The %s field is invalid"}}}),g=this.phoneGroup=new e;this.fields=[a,b,c,g],this.template=f(this.template)},bindEvents:function(){this.firstname.on("change",this.validate,this),this.lastname.on("change",this.validate,this),this.email.on("change",this.validate,this),this.phoneGroup.on("change",this.validate,this)},resetValues:function(){var a=this.fields,b=a.length,c=0;for(c=0;b>c;c+=1)a[c].reset()},render:function(a){var c,d,e,f=this.fields,g=f.length;for(this.root=a,a&&(a.innerHTML=this.template({})),c=b(a).find(".form"),d=0;g>d;d+=1)e=b('<div class="form-field"><div class="form-field-inner"></div></div>'),b(c).append(e),f[d].render(e.find(".form-field-inner")[0]);return this.bindEvents(),this},reset:function(){return this.root.innerHTML="",this},validate:function(a){this.trigger("update-request-form",{name:a.fieldName,value:a.isValid?b.trim(a.fieldValue):""})},changeAvailable:function(a){var b,c=this.fields;for(b in c)c.hasOwnProperty(b)&&(c[b].hasOwnProperty("fields")?c[b].changeAvailable(a):c[b].el.disabled=a?!1:!0)},template:'<div class="rule"><b>2.</b> Request free price quote by using the form below and find the best deals</div><div class="form"></div>'})}(),a.namespace("nvc").ConfigLeadForm=function(){function b(a){d.call(this),this.apiKey=a,this.initialize(a),this.bindEvents()}{var d=a.mixin.Observable,e=a.util.Array;e.isArray,e.contains,a.util.Function.bind}return b.prototype={initialize:function(a){this.config={apiKey:a,make:"",model:"",year:"",styleid:"",zip:"",options:[],price:{},radius:100,dealers:[],firstname:"",lastname:"",email:"",phoneCode:"",phonePrefix:"",phoneSuffix:""}},setOption:function(a,b){return this.config[a]=b,this.trigger("change"),this},bindEvents:function(){this.on("change",this.validate,this)},validate:function(){var a=!1;return this.config.dealers.length&&this.config.firstname.length&&this.config.lastname.length&&this.config.email.length&&this.config.phoneCode.length&&this.config.phonePrefix.length&&this.config.phoneSuffix.length&&(a=!0),this.trigger("readytosubmit",a),a},reset:function(a){var b=c.clone(this.config);this.config={apiKey:this.apiKey,make:"",model:"",year:"",styleid:"",zip:a.zip?b.zip:"",options:[],price:{},radius:100,dealers:[],firstname:"",lastname:"",email:"",phoneCode:"",phonePrefix:"",phoneSuffix:""}}},b}(),a.namespace("nvc").VehicleDetails=function(){var b=a.ui.View,c=a.template;return b.extend({className:"vehicle-description",render:function(a,b){return this.el.innerHTML=c(this.template,{details:a,showPrice:b,msrpTooltip:g.TOOLTIP_MSRP}),this.trigger("render"),this},reset:function(){return this.el.innerHTML='<span class="default-price">Base MSRP:&nbsp;---</span>',this},template:['<div class="name"><%= details.name %></div>','<div class="desc"><%= details.description %></div>',"<% if(showPrice) { %>",'<div class="price">',"Base MSRP:<sup>$</sup>",'<span class="value" onclick="">',"<%= _.formatNumber(details.price) %>",'<div class="nvcwidget-tooltip"><div class="arrow-left"></div><%= msrpTooltip %></div>',"</span>","</div>","<% } %>"].join("")})}(),a.namespace("nvc").VehiclePhotos=function(){var b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAAWdEVYdENyZWF0aW9uIFRpbWUAMDkvMTIvMTOcPiNzAAAADUlEQVQImWP4//8/AwAI/AL+hc2rNAAAAABJRU5ErkJggg==";return d.View.extend({className:"vehicle-photos",template:'<div class="image"><img src="" alt=""></div><div class="image"><img src="" alt=""></div>',initialize:function(b){this.vehicleApi=new a.api.Vehicle(b.vehicleApiKey),this.$el.addClass(b.colorScheme)},render:function(){return this.$el.html(this.template),this.reset(),this},reset:function(){return this.$("img").attr("src",b),this},loadPhotos:function(a){var b=c.bind(this.onPhotosLoad,this);this.vehicleApi.getPhotosByStyleId(a,b)},onPhotosLoad:function(a){var d="http://media.ed.edmunds-media.com",e=[],f=this.$("img");e.push(c.findWhere(a,{subType:"exterior",shotTypeAbbreviation:"FQ"})),e.push(c.findWhere(a,{subType:"exterior",shotTypeAbbreviation:"RQ"})),e=c.map(e,function(a){return d+(a&&a.id||b).replace("dam/photo","")+"_500.jpg"}),f.eq(0).attr("src",e[0]),f.eq(1).attr("src",e[1])}})}(),a.namespace("nvc").VehiclePrice=function(){function b(a){this.initialize(a),this.bindEvents()}var h=(a.mixin.Observable,EDMUNDSAPI.Vehicle),i=(a.util.Function.bind,a.template);return c.extend(b.prototype,d.Events,{initialize:function(a){this.options=a,this.el=a.el,this.template=i(this.template),this.vehicleApi=new h(a.vehicleApiKey)},bindEvents:function(){},render:function(a){var b,c,d=a,e=/(?=(?:\d{3})+(?:\.|$))/g;return this.totalPrice=a,d.tmv>d.invoice&&d.tmv<=d.msrp?(b=100*(d.tmv-d.invoice)/(d.msrp-d.invoice),c=0):d.tmv<d.invoice?(b=0,c=100*(d.invoice-d.tmv)/(d.msrp-d.tmv)):d.tmv>d.msrp?(b=100,c=0):(b=0,c=0),this.graphDash=c,d={tmv:d.tmv?d.tmv.toString().split(e).join(","):"N/A",invoice:d.invoice?d.invoice.toString().split(e).join(","):"N/A",msrp:d.msrp?d.msrp.toString().split(e).join(","):"N/A",width:b,leftDash:c,tmvTooltip:g.TOOLTIP_TMV,msrpTooltip:g.TOOLTIP_MSRP,invoiceTooltip:g.TOOLTIP_INVOICE},this.el.innerHTML=this.template({totalPrice:d}),this.updateGraph(),this.trigger("render"),this},updateGraph:function(){try{var a,b=f("bottom","",this.el)[0],c=e?b.childNodes[1]:f("left","",b)[0],d=e?b.childNodes[0]:f("right","",b)[0],g=f("value","",c)[0].offsetWidth,h=f("value","",d)[0].offsetWidth,i=b.offsetWidth,j=this.graphDash,k=10;j>0&&(a=100*(g+h+k)/i,a>100-j&&!e&&(c.style.marginLeft=100-a+"%"))}catch(l){}},loadPrice:function(a,b,d){var e=c.bind(this.onPriceLoadSuccess,this),f=c.bind(this.onPriceLoadError,this),g="optionid="+d.join("&optionid=")+"&";return this.vehicleApi.getOptionsList(g,b,a,e,f),this},onPriceLoadSuccess:function(a){if(a.error||a.hasOwnProperty("errorType"))return this.onPriceLoadError();var b={invoice:a.tmv.totalWithOptions.baseInvoice,tmv:a.tmv.totalWithOptions.tmv,msrp:a.tmv.totalWithOptions.baseMSRP};this.trigger("load",b,a)},onPriceLoadError:function(){this.trigger("loaderror")},reset:function(){this.el.innerHTML=""},template:["<div>","<div>",'<div class="nvcwidget-price-graph">','<div class="top" style="width: <%= totalPrice.width %>%;">','<div class="top-inner">','<span class="name">True Market Value&reg;</span>','<span class="value" onclick=""><sup>$</sup><%= totalPrice.tmv %><div class="nvcwidget-tooltip"><div class="arrow-left"></div><%= totalPrice.tmvTooltip %></div></span>',"</div>","</div>",'<div class="graph">','<div class="left" style="width: <%= totalPrice.width %>%;">','<div class="middle"></div>',"</div>",'<div class="dash" style="left: <%= totalPrice.leftDash %>%;"></div>','<div class="dash rights"></div>','<div class="right"></div>',"</div>",'<div class="bottom">','<div class="right">','<span class="name">MSRP</span>','<span class="value" onclick=""><sup>$</sup><%= totalPrice.msrp %><div class="nvcwidget-tooltip"><div class="arrow-left"></div><%= totalPrice.msrpTooltip %></div></span>',"</div>",'<div class="left" style="margin-left: <%= totalPrice.leftDash %>%;">','<span class="name">Invoice</span>','<span class="value" onclick=""><sup>$</sup><%= totalPrice.invoice %><div class="nvcwidget-tooltip"><div class="arrow-left"></div><%= totalPrice.invoiceTooltip %></div></span>',"</div>","</div>","</div>","</div>","</div>"].join("")}),b}(),a.namespace("nvc").MessageDialog=function(){function b(){c.call(this),this.el=document.createElement("div"),this.el.className="nvcwidget-overlay",this.template=d(this.template)}var c=a.mixin.Observable,d=a.template;return b.prototype={render:function(a){return a=a||{},a.text||(a.text=["<p>Something went wrong when sending your form!</p>",'<p>Please return to the form and try again or <a href="Mailto:api@edmunds.com">contact</a> us directly.</p>'].join("")),this.el.innerHTML='<div class="overlay-bg"></div>',this.isSuccess=a.isSuccess,this.message=document.createElement("div"),this.message.className="nvcwidget-message",this.message.innerHTML=this.template({options:a}),this.message.className+=a.isSuccess?" success-message":" failure-message",this.el.appendChild(this.message),this},setMargin:function(){var a=this.message.offsetHeight;this.message.style.marginTop=-a/2+"px"},init:function(){var a=this.el.getElementsByTagName("button")[0];this.setMargin(),a.onclick=function(a){return function(){a.isSuccess===!0&&a.trigger("reset"),a.el.parentNode.removeChild(a.el)}}(this)},template:["<% if (options.isSuccess === true) { %>",'<div class="message-header">Thank you!</div>','<div class="message-body">',"<p>We have sent your request for a price quote on the</p>",'<p class="name"><%= options.name%></p>',"<p>to the following dealer(s)</p>","<ul>","<% for (var i = 0, length = options.dealers.length; i < length; i++) { %>","<li>-&nbsp;<%= options.dealers[i] %></li>","<% } %>","</ul>","</div>",'<div class="message-bottom">','<button type="reset" id="continue_button">Configure another vehicle</button>',"</div>","<% } else { %>",'<div class="message-header">Oh no...</div>','<div class="message-body">',"<%= options.text %>","</div>",'<div class="message-bottom">','<button type="button">Return and try again</button>',"</div>","<% } %>"].join("")},b}(),a.namespace("view").Tooltip=d.View.extend({className:"edm-tooltip",template:'<div class="arrow arrow-left"></div><span></span>',render:function(){return this.$el.html(this.template),this.options.text&&this.setText(this.options.text),this[this.options.show?"show":"hide"](),this},setText:function(a){return this.$("span").text(a),this},show:function(){return this.$el.show(),this},hide:function(){return this.$el.hide(),this}}),a.namespace("view.form").Button=d.View.extend({tagName:"button",events:{click:"onClick"},render:function(){return this.$el.text(this.options.text),this},onClick:function(){this.trigger("click")},disable:function(){return this.$el.prop("disabled",!0),this},enable:function(){return this.$el.prop("disabled",!1),this}}),a.namespace("view.form").ZipField=d.View.extend({tagName:"input",className:"edm-form-zipfield zip-field",attributes:{type:"text",title:"ZIP Code",maxlength:5},events:{change:"validate",blur:"setCurrentValue",keyup:"validate",keypress:"onKeyPress"},initialize:function(b){this.currentZipCode=b.zipCode,this.regionApi=new a.api.Region(b.vehicleApiKey),this.tooltip=new a.view.Tooltip({className:"nvcwidget-tooltip",text:"Please enter a valid Zip Code"}),this.on("valid",this.onValid,this),this.on("invalid",this.onInvalid,this),this.on("change",this.validate,this)},render:function(){return this.$el.val(this.currentZipCode),this.$el.before(this.tooltip.render().el),this},enable:function(){return this.$el.prop("disabled",!1),this},disable:function(){return this.$el.prop("disabled",!0),this},onKeyPress:function(b){var d=b.which,e=a.event.KeyCode,f=[e.BACKSPACE,e.DELETE,e.TAB,e.ENTER,e.ARROW_LEFT,e.ARROW_UP,e.ARROW_RIGHT,e.ARROW_DOWN];if(!(b.shiftKey||b.altKey||b.ctrlKey||b.metaKey||String.fromCharCode(d).match(/\d/)||!(b.which&&b.charCode||!b.keyCode)&&c.contains(f,b.keyCode)))return b.preventDefault(),!1},validate:function(){var a=this.$el.val(),b=/\d{5}/,d=c.bind(this.onZipLoadSuccess,this),e=c.bind(this.onZipLoadError,this);return this.pending?this:this.currentZipCode===a?this.trigger("valid",a):b.test(a)?(this.pending=!0,this.regionApi.getValidZip(a,d,e),this):this.trigger("invalid",a)},setCurrentValue:function(){return this.$el.val(this.currentZipCode),this.validate()},onValid:function(a){this.currentZipCode=a,this.tooltip.hide()},onInvalid:function(){this.tooltip.show()},onZipLoadSuccess:function(a){var b=this.$el.val();return this.pending=!1,a[b]&&"true"===a[b]?this.trigger("valid",b):this.trigger("invalid",b)},onZipLoadError:function(){return this.pending=!1,this.trigger("invalid",this.$el.val())},updateZipCode:function(a){return this.$el.val(a),this.trigger("valid",a)}}),a.namespace("view.form").MiField=d.View.extend({tagName:"input",className:"edm-form-mifield within-field",attributes:{type:"text",maxlength:3},events:{change:"onChange",blur:"onChange",keyup:"validate",keypress:"onKeyPress"},initialize:function(){c.defaults(this.options,{min:1,max:100,radius:100}),this.tooltip=this.tooltip=new a.view.Tooltip({className:"nvcwidget-tooltip",text:"The Radius is invalid"}),this.on("valid",this.onValid,this),this.on("invalid",this.onInvalid,this)},onChange:function(){var a=this.$el.val(),b=this.validate();b&&this.$el.val(Number(a))},render:function(){return this.$el.val(this.options.radius),this.$el.before(this.tooltip.render().el),this},validate:function(){var a=Number(this.$el.val());return this.$el.val().length?/\d+/.test(a)?a!==Math.round(a)?(this.trigger("invalid","Radius must be an integer"),!1):a>this.options.max?(this.trigger("invalid","Radius must be less than or equal to "+this.options.max),!1):a<this.options.min?(this.trigger("invalid","Radius must be greater than or equal to "+this.options.min),!1):(this.trigger("valid",a),!0):(this.trigger("invalid","Radius must be a number"),!1):(this.trigger("invalid","Radius must not be empty"),!1)},onValid:function(){this.tooltip.hide()},onInvalid:function(a){this.tooltip.setText(a).show()},onKeyPress:function(b){var d=b.which,e=a.event.KeyCode,f=[e.BACKSPACE,e.DELETE,e.TAB,e.ENTER,e.ARROW_LEFT,e.ARROW_UP,e.ARROW_RIGHT,e.ARROW_DOWN];if(!(b.shiftKey||b.altKey||b.ctrlKey||b.metaKey||String.fromCharCode(d).match(/\d/)||!(b.which&&b.charCode||!b.keyCode)&&c.contains(f,b.keyCode)))return b.preventDefault(),!1}}),a.namespace("view.form").ZipUpdate=d.View.extend({className:"edm-form-zipupdate zipcode-update",initialize:function(b){this.zipField=new a.view.form.ZipField({vehicleApiKey:b.vehicleApiKey,zipCode:b.zipCode}),this.zipField.on("valid",this.onZipValid,this),this.zipField.on("invalid",this.onZipInvalid,this),this.zipField.on("blur",this.onZipBlur,this),this.button=new a.view.form.Button({className:"button-light",text:"Update"}),this.button.on("click",this.onButtonClick,this)},render:function(){var a=this.$el;return a.append("<label>ZIP: </label>"),a.append(this.zipField.el),a.append(this.button.render().el),this.zipField.render(),this},disable:function(){return this.button.disable(),this.zipField.disable(),this},enable:function(){return this.button.enable(),this.zipField.enable(),this},onButtonClick:function(){this.trigger("update",this.zipField.$el.val())},onZipValid:function(){this.button.enable()},onZipInvalid:function(){this.button.disable()},updateZipCode:function(a){this.zipField.updateZipCode(a)}}),a.namespace("view.form").ZipLocation=a.view.form.ZipUpdate.extend({className:"edm-form-zipupdate zipcode-update",template:['<span class="name">Prices for Zip code</span>','<div class="zip-code tab2-zip"></div>','<span class="state">&nbsp;</span>'],initialize:function(b){a.view.form.ZipUpdate.prototype.initialize.apply(this,arguments),this.vehicleApi=new EDMUNDSAPI.Vehicle(b.vehicleApiKey)},render:function(){return this.$el.html(this.template),this.$(".zip-code").append(this.zipField.el),this.$(".zip-code").after(this.button.render().el),this.zipField.render(),this},onButtonClick:function(){this.trigger("update",this.zipField.$el.val())},loadLocation:function(){var a=c.bind(this.onLocationLoad,this),b=this.zipField.$el.val();this.vehicleApi.getUpdateLocation(b,a)},onLocationLoad:function(a){var b=this.parseLocation(a);this.setLocationText(b),this.trigger("location-load")},parseLocation:function(a){var b={state:a.regionsHolder?a.regionsHolder[0].name:null,stateCode:a.regionsHolder?a.regionsHolder[0].stateCode:null};return b},setLocationText:function(a){var b=a.state?a.state+", "+a.stateCode:"Please click UPDATE button one more time.";return this.$(".state").text(b),this},updateZipCode:function(a){this.zipField.updateZipCode(a),this.loadLocation()}}),a.namespace("view.form").ZipMiField=a.view.form.ZipUpdate.extend({className:"edm-form-zipupdate zipcode-update",template:['<div class="name"><b>1.</b> Select dealer near your location</div>','<div class="zip-code"></div>','<div class="within"><span>within</span><span>mi</span></div>'],initialize:function(){a.view.form.ZipUpdate.prototype.initialize.apply(this,arguments),this.miField=new a.view.form.MiField({radius:this.options.radius}),this.miField.on("valid",this.onRadiusValid,this),this.miField.on("invalid",this.onRadiusInValid,this),this.isValidZip=c.has(this.options,"zipCode"),this.isValidRadius=c.has(this.options,"radius")},render:function(){return this.$el.html(this.template),this.$(".zip-code").append("<label>ZIP: </label>"),this.$(".zip-code").append(this.zipField.el),this.$(".within").after(this.button.render().el),this.$(".within span:first").after(this.miField.el),this.zipField.render(),this.miField.render(),this},toggleButton:function(){this.button[this.isValidZip&&this.isValidRadius?"enable":"disable"]()},onButtonClick:function(){this.trigger("update",this.zipField.$el.val(),this.miField.$el.val())},onZipValid:function(){this.isValidZip=!0,this.toggleButton()},onZipInvalid:function(){this.isValidZip=!1,this.toggleButton()},onRadiusValid:function(){this.isValidRadius=!0,this.toggleButton()},onRadiusInValid:function(){this.isValidRadius=!1,this.toggleButton()}}),a.namespace("view").IncentivesAndRebates=d.View.extend({className:"incentives",events:{"click .switcher":"toggleState"},template:['<div class="incentive-toggle">','<div class="switcher-wrapper">','<span class="">Include in TMV<sup>&reg;</sup></span>','<div class="switcher"></div>',"</div>",'<div class="incentive-label"><i class="icon-incentive"></i>Incentives</div>',"</div>",'<div class="incentive-info">','<span class="incentive-price"><%= _.currency(incentive) %></span>','<span class="incentive-subprogram">Customer Cash<div class="nvcwidget-tooltip"><div class="arrow-left"></div><%= description %></div></span>',"</div>"].join(""),render:function(){return this.$el.html(c.template(this.template,{incentive:this.options.incentive,description:g.TOOLTIP_CUSTOMERCASH})),this.switcher=this.$(".switcher"),this.options.turnedOn?this.switcher.removeClass("off").addClass("on"):this.switcher.removeClass("on").addClass("off"),this
},toggleState:function(){return this.switcher.toggleClass("on off"),this.trigger("change",this.switcher.hasClass("on")),this}}),function(){var b=d.Model.extend({defaults:{name:"",status:"available",price:{tmv:0,baseMSRP:0,baseInvoice:0}},setAvailable:function(){return this.set("status",b.STATUS_AVAILABLE)},setExcluded:function(){return this.set("status",b.STATUS_EXCLUDED)},setIncluded:function(){return this.set("status",b.STATUS_INCLUDED)},setSelected:function(){return this.set("status",b.STATUS_SELECTED)},isAvailable:function(){return this.get("status")===b.STATUS_AVAILABLE},isExcluded:function(){return this.get("status")===b.STATUS_EXCLUDED},isIncluded:function(){return this.get("status")===b.STATUS_INCLUDED},isSelected:function(){return this.get("status")===b.STATUS_SELECTED},isUnavailableSelected:function(){return this.get("status")===b.STATUS_UNAVAILABLE_SELECTED},isColor:function(){return this.get("type")===b.TYPE_COLOR},isOption:function(){return this.get("type")===b.TYPE_OPTION}},{fromFeaturesMapObject:function(a){return new b({id:a.id,name:a.name,type:a.equipmentType})},STATUS_AVAILABLE:"available",STATUS_INCLUDED:"included",STATUS_EXCLUDED:"excluded",STATUS_SELECTED:"selected",STATUS_UNAVAILABLE_SELECTED:"unavailable selected",TYPE_COLOR:"color",TYPE_OPTION:"option"});a.namespace("model").Feature=b}(),function(b){var c=b.extend({},{fromFeaturesMapObject:function(a){var b={id:a.id,name:a.name,type:a.equipmentType},d=a.attributeGroups;return d.COLOR_INFO&&d.COLOR_INFO.attributes.MANUFACTURER_OPTION_NAME&&(b.name=d.COLOR_INFO.attributes.MANUFACTURER_OPTION_NAME.value),d.COLOR_TYPE&&d.COLOR_TYPE.attributes.COLOR_TYPE&&(b.category=d.COLOR_TYPE.attributes.COLOR_TYPE.value),d.COLOR_CHIPS&&(d.COLOR_CHIPS.attributes.PRIMARY_R_CODE&&d.COLOR_CHIPS.attributes.PRIMARY_G_CODE&&d.COLOR_CHIPS.attributes.PRIMARY_B_CODE&&(b.primaryColor={r:d.COLOR_CHIPS.attributes.PRIMARY_R_CODE.value,g:d.COLOR_CHIPS.attributes.PRIMARY_G_CODE.value,b:d.COLOR_CHIPS.attributes.PRIMARY_B_CODE.value}),d.COLOR_CHIPS.attributes.SECONDARY_R_CODE&&d.COLOR_CHIPS.attributes.SECONDARY_G_CODE&&d.COLOR_CHIPS.attributes.SECONDARY_B_CODE&&(b.secondaryColor={r:d.COLOR_CHIPS.attributes.SECONDARY_R_CODE.value,g:d.COLOR_CHIPS.attributes.SECONDARY_G_CODE.value,b:d.COLOR_CHIPS.attributes.SECONDARY_B_CODE.value})),b.price=a.price,new c(b)}});a.namespace("model.feature").Color=c}(a.model.Feature),function(b){var c=b.extend({},{fromFeaturesMapObject:function(a){var b={id:a.id,name:a.name,type:a.equipmentType},d=a.attributeGroups;return d.OPTION_INFO&&d.OPTION_INFO.attributes.MANUFACTURER_OPTION_NAME&&(b.name=d.OPTION_INFO.attributes.MANUFACTURER_OPTION_NAME.value),b.category=d.OPTION_INFO&&d.OPTION_INFO.attributes.OPTION_CATEGORY?d.OPTION_INFO.attributes.OPTION_CATEGORY.value:"Other",b.price=a.price,new c(b)}});a.namespace("model.feature").Option=c}(a.model.Feature),function(b,e,f){var g=d.Collection.extend({model:b,currentState:{},previousState:{},comparator:function(a){var b="Additional Fees"===a.get("category")?"_":"";return+a.get("id")<6&&(b+="_"),b+a.get("name")},saveCurrentState:function(){var a;return this.previousState=c.clone(this.currentState),a=this.currentState={available:[],selected:[],excluded:[],included:[]},this.each(function(b){b.isAvailable()&&a.available.push(b.get("id")),b.isSelected()&&a.selected.push(b.get("id")),b.isIncluded()&&a.included.push(b.get("id")),b.isExcluded()&&a.excluded.push(b.get("id"))}),this},applyOptions:function(a){function d(a){var b=this.get(a);return b&&b.isColor()}var e=this.mapByType(),f=(e[b.TYPE_OPTION],e[b.TYPE_COLOR].mapByCategory(),[]),g=[],h=[],i=[],j=[],k=[],l=[];f=c.union(this.currentState.selected,a.requiredItems,a.currentOptions,a.selectedOption),f=c.without(f,a.deselectedOption),f=c.difference(f,a.furtherRemovals,a.includedItems),h=a.excludedItems,k=c.filter(a.includedItems,d,this),i=c.difference(a.includedItems,k),l=c.filter(f,d,this),j=c.difference(f,l);var m=(c.union(k,l),this.mapByTypeAndCategory()),n=m[b.TYPE_COLOR];return c.each(n,function(b){var d=b.pluck("id"),e=c.intersection(d,k),f=c.intersection(d,l),g=c.intersection(f,a.requiredItems);g.length&&(f=g),k=c.difference(k,d),l=c.difference(l,d),c.contains(e,a.selectedOption)?(l=c.without(l,a.selectedOption),k.push(a.selectedOption)):c.contains(f,a.selectedOption)?l.push(a.selectedOption):e.length>0?k.push(c.last(e)):l=c.union(l,f)},this),g=c.union(k,i),f=c.union(l,j),this.each(function(a){a.isAvailable()||a.isUnavailableSelected()||a.setAvailable()},this),this.setExcluded(h),this.setIncluded(g),this.setSelected(f),this.saveCurrentState(),this},setPreviousState:function(){var a=this.previousState;return this.setAvailable(a.available),this.setExcluded(a.excluded),this.setIncluded(a.included),this.setSelected(a.selected),this.saveCurrentState(),this},resetState:function(){return this.previousState={},this.currentState={},this},mapByType:function(){var a={};return this.each(function(b){var c=b.get("type");a[c]||(a[c]=new g),a[c].add(b)}),a},mapByCategory:function(){var a={};return this.each(function(b){var c=b.get("category");a[c]||(a[c]=new g),a[c].add(b)}),a},mapByTypeAndCategory:function(){var a={};return c.each(this.mapByType(),function(b,c){a[c]=b.mapByCategory()}),a},setAvailable:function(a){return c.each(a,function(a){var b=this.get(a);b&&b.setAvailable()},this),this},setExcluded:function(a){return c.each(a,function(a){var b=this.get(a);b&&b.setExcluded()},this),this},setIncluded:function(a){return c.each(a,function(a){var b=this.get(a);b&&b.setIncluded()},this),this},setSelected:function(a){return c.each(a,function(a){var b=this.get(a);b&&b.setSelected()},this),this},getTotalPrice:function(){var a={tmv:0,baseMSRP:0,baseInvoice:0};return this.each(function(b){var c;(b.isSelected()||b.isUnavailableSelected())&&(c=b.get("price"),a.tmv+=Number(c.tmv)||0,a.baseMSRP+=c.baseMSRP,a.baseInvoice+=c.baseInvoice)}),a},updatePrices:function(a){var d;return a.regionalAdjustment&&(d=this.get("000000003"),d?d.set("price",{tmv:Number(a.regionalAdjustment.tmv),baseMSRP:null,baseInvoice:null}):this.add({id:"000000003",name:"Regional Adjustment",category:"Additional Fees",type:b.TYPE_OPTION,status:b.STATUS_UNAVAILABLE_SELECTED,price:{tmv:Number(a.regionalAdjustment.tmv),baseMSRP:null,baseInvoice:null}})),a.colorAdjustment&&(d=this.get("000000004"),d?d.set("price",{tmv:Number(a.colorAdjustment.tmv),baseMSRP:null,baseInvoice:null}):this.add({id:"000000004",name:"Color Adjustment",category:"Additional Fees",type:b.TYPE_OPTION,status:b.STATUS_UNAVAILABLE_SELECTED,price:{tmv:Number(a.colorAdjustment.tmv),baseMSRP:null,baseInvoice:null}})),a.colorAdjustment&&(d=this.get("000000005"),d?d.set("price",{tmv:null,baseMSRP:null,baseInvoice:Number(a.regionalAdFee)||0}):this.add({id:"000000005",name:"Advertising Fee",category:"Additional Fees",type:b.TYPE_OPTION,status:b.STATUS_UNAVAILABLE_SELECTED,price:{tmv:null,baseMSRP:null,baseInvoice:Number(a.regionalAdFee)}})),c.each(a.optionTMVPrices,function(a,b){var d,e=this.get(b);e&&(d=e.get("price"),e.set("price",{tmv:c.isNull(a.tmv)?d.tmv:a.tmv,baseMSRP:c.isNull(a.baseMSRP)?d.baseMSRP:a.baseMSRP,baseInvoice:c.isNull(a.baseInvoice)?d.baseInvoice:a.baseInvoice}))},this),this}},{fromFeaturesMap:function(a){var d=[];return c.each(a,function(a){var c;switch(a.equipmentType){case b.TYPE_COLOR:c=e.fromFeaturesMapObject(a);break;case b.TYPE_OPTION:a.price?a.price.baseMSRP>=0&&(c=f.fromFeaturesMapObject(a)):c=f.fromFeaturesMapObject(a)}c&&d.push(c)}),new g(d)}});a.namespace("collection").Features=g}(a.model.Feature,a.model.feature.Color,a.model.feature.Option),a.namespace("view.features").Category=d.View.extend({className:"features-category-head",events:{click:"onClick"},template:['<div class="inner">','<div class="features-category-price"><%= _.currency(totalPrice.baseMSRP) %></div>','<div class="features-category-title"><%= categoryName %></div>',"</div>"].join(""),initialize:function(){this.collection.on("reset",this.updateTotalPrice,this),this.template=c.template(this.template),this.setTitle(this.options.categoryName)},render:function(){return this.el.innerHTML=this.template({categoryName:this.categoryName,totalPrice:this.collection.getTotalPrice()}),this},updateTotalPrice:function(){var a=this.collection.getTotalPrice();return this.$(".features-category-price").html(c.currency(a.baseMSRP)),this},onClick:function(){this.trigger("open",this.categoryName,this.collection)},setTitle:function(a){return this.categoryName=this.normalizeTitle(a||""),this.render()},normalizeTitle:function(a){var b=a.split(/[\s_]+/g);return c.each(b,function(a,b,c){c[b]=a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()}),b.join(" ")}}),a.namespace("view.features.category").ColorCategory=a.view.features.Category.extend({template:['<div class="inner">','<div class="features-category-color">','<% if (feature && feature.has("secondaryColor")) { %>','<div class="feature-secondary-color" style="background-color: <%= _.rgb2hex(feature && feature.get("secondaryColor")) %>"></div>',"<% } %>",'<% if (feature && feature.has("primaryColor")) { %>','<div class="feature-primary-color" style="background-color: <%= _.rgb2hex(feature && feature.get("primaryColor")) %>"></div>',"<% } %>","</div>",'<div class="features-category-price"><%= _.currency(totalPrice.baseMSRP) %></div>','<div class="features-category-title"><%= categoryName %></div>',"</div>"].join(""),render:function(){var a=this.collection.filter(function(a){return a.isSelected()||a.isIncluded()})[0],b=this.collection.at(0),c="category-"+(b&&b.get("category")||"").toLowerCase().replace(/[\s_]+/g,"-");return this.el.innerHTML=this.template({categoryName:a?a.get("name"):"Select a color",totalPrice:this.collection.getTotalPrice(),feature:a}),this.$el.addClass(c),this}}),a.namespace("view.features").Categories=d.View.extend({categoriesMap:{},render:function(){var a,b="Package",d="Additional Fees",e="color",f="option";return this.$el.empty(),0===this.collection.length?(this.$el.html('<div class="alert">Sorry, we don\'t have configurable options for this vehicle.</div>'),this):(a=this.collection.mapByTypeAndCategory(),this.createGroupWrapper(),a[f]&&a[f][b]&&this.renderOptionsCategory(b,a[f][b]),this.createExtraGroupWrapper(),c.each(a[e],function(a,b){this.renderColorsCategory(b,a)},this),this.$extraGroupWrapper=null,this.createGroupWrapper(),a[f]&&this.$groupWrapper.append('<h6 class="features-category-title">Options</h6>'),c.each(a[f],function(a,c){c!==b&&c!==d&&this.renderOptionsCategory(c,a)},this),this.createGroupWrapper(),a[f]&&a[f][d]&&this.renderOptionsCategory(d,a[f][d]),this)},createGroupWrapper:function(){return this.$groupWrapper=b('<div class="features-group-wrapper"></div>').appendTo(this.$extraGroupWrapper||this.el),this},createExtraGroupWrapper:function(){return this.$extraGroupWrapper=b('<div class="features-extra-group-wrapper"></div>').appendTo(this.el),this},renderColorsCategory:function(b,c){var d=new a.view.features.category.ColorCategory({collection:c,categoryName:b});return d.on("open",this.openCategory,this),this.createGroupWrapper(),this.$groupWrapper.append('<h6 class="features-category-title">'+d.normalizeTitle(b)+"</h6>"),this.$groupWrapper.append(d.render().el),this.categoriesMap.color||(this.categoriesMap.color={}),this.categoriesMap.color[b]=d,this},renderOptionsCategory:function(b,c){var d=new a.view.features.Category({collection:c,categoryName:b});return d.on("open",this.openCategory,this),this.$groupWrapper.append(d.render().el),this.categoriesMap.option||(this.categoriesMap.option={}),this.categoriesMap.option[b]=d,this},refresh:function(){return c.each(this.categoriesMap.color,function(a){a.render()}),c.each(this.categoriesMap.option,function(a){a.updateTotalPrice()}),this},openCategory:function(a,b){this.trigger("opencategory",a,b)}}),a.namespace("view.features").ListItem=d.View.extend({tagName:"li",className:"features-list-item",events:{'click [type="checkbox"]':"onSelect"},template:['<label for="feature-<%= data.cid %>-<%= data.feature.get("id") %>">',"<% if (data.feature.isColor()) { %>",'<div class="feature-color">','<% if (data.feature.has("secondaryColor")) { %>','<div class="feature-secondary-color" style="background-color: <%= _.rgb2hex(data.feature.get("secondaryColor")) %>"></div>',"<% } %>",'<% if (data.feature.has("primaryColor")) { %>','<div class="feature-primary-color" style="background-color: <%= _.rgb2hex(data.feature.get("primaryColor")) %>"></div>',"<% } %>","<i></i>","</div>","<% } %>",'<input type="checkbox" id="feature-<%= data.cid %>-<%= data.feature.get("id") %>" value="<%= data.feature.get("id") %>">','<span class="feature-price feature-price-msrp"><%= _.currency(data.feature.get("price").baseMSRP) %></span>','<span class="feature-name"><span class="notification-icon"></span><%= data.feature.get("name") %></span>',"</label>"].join(""),initialize:function(){this.model.on("change",this.render,this)},render:function(){function a(a){return c.isNull(a)?"N/A":c.currency(a)}var b,d,e=this.model;return this.$el.html(c.template(this.template,{feature:e,cid:this.cid},{variable:"data"})).removeClass("available included excluded selected").addClass(e.get("status")).addClass(e.get("type")),b=this.$('[type="checkbox"]'),e.isSelected()?b.prop({checked:!0,disabled:!1}):e.isIncluded()||e.isUnavailableSelected()?b.prop({checked:!0,disabled:!0}):(e.isAvailable()||e.isExcluded())&&b.prop({checked:!1,disabled:!1}),e.isIncluded()?this.$(".feature-price").text("Included"):(d=this.model.get("price"),this.$(".feature-price-msrp").html(a(d.baseMSRP)),this.$(".feature-price-tmv").html(a(d.tmv)),this.$(".feature-price-invoice").html(a(d.baseInvoice))),this},onSelect:function(a){var b=a.target;a.preventDefault(),this.trigger("select",b.value,b.checked,this)}}),a.namespace("view.features").List=d.View.extend({tagName:"ul",className:"features-list",loadingText:"Loading options...",emptyText:"Sorry, we don't have configurable options for this vehicle.",initialize:function(){this.collection.on("reset",this.render,this),this.collection.on("request",this.onRequest,this)},render:function(){return this.$el.empty(),this.collection.length?(this.setClassName(),this.collection.each(this.add,this),this):(this.$el.html(this.emptyText),this)},add:function(b){var d;return c.isNull(b.get("price").baseMSRP)?this:(d=new a.view.features.ListItem({model:b}),d.on("select",this.onSelect,this),this.$el.append(d.render().el),this)},showLoadingOverlay:function(){this.loadingOverlay||(this.loadingOverlay=b('<li class="overlay"></li>')),this.loadingOverlay.appendTo(this.$el)},hideLoadingOverlay:function(){this.loadingOverlay&&this.loadingOverlay.remove()},onSelect:function(a,b,c){this.trigger("select",a,b,c)},onRequest:function(){this.showLoadingOverlay()},setClassName:function(){var a="category-"+(this.collection.at(0).get("category")||"").toLowerCase().replace(/[\s_]+/g,"-");return this.$el.removeClass().addClass(this.className).addClass(a),this}}),a.namespace("view.features").SelectedListItem=a.view.features.ListItem.extend({events:{'click [data-action="remove"]':"onRemoveClick"},template:['<a href="#" class="icon-remove" data-action="remove">','<div class="nvcwidget-tooltip"><div class="arrow-left"></div>Delete</div>',"</a>",'<span class="feature-price feature-price-msrp"><%= _.currency(data.feature.get("price").baseMSRP) %></span>','<span class="feature-price feature-price-tmv"><%= _.currency(data.feature.get("price").tmv) %></span>','<span class="feature-price feature-price-invoice"><%= _.currency(data.feature.get("price").baseInvoice) %></span>','<span class="feature-name"><span class="notification-icon"></span><%= data.feature.get("name") %></span>'].join(""),onRemoveClick:function(a){a.preventDefault(),this.trigger("select",this.model.get("id"),!1,this)}}),a.namespace("view.features").SelectedList=a.view.features.List.extend({className:"selected-features-list",emptyText:"",add:function(b){var c=new a.view.features.SelectedListItem({model:b});return c.on("select",this.onSelect,this),this.$el.append(c.render().el),this}}),a.namespace("view.features").SelectedFeatures=d.View.extend({className:"selected-features",headerTemplate:['<div class="selected-features-header">','<div class="headers-row">','<div class="price-dropdown">','<div class="arrow"></div>',"<ul>",'<li data-price-type="msrp">MSRP</li>','<li data-price-type="tmv">TMV&reg;</li>','<li data-price-type="invoice">Invoice</li>',"</ul>","</div>",'<div class="feature-price feature-price-msrp">MSRP</div>','<div class="feature-price feature-price-tmv">TMV&reg;</div>','<div class="feature-price feature-price-invoice">Invoice</div>','<div class="feature-name">Description</div>',"</div>",'<div class="base-price-row">','<div class="feature-price feature-price-msrp">$0</div>','<div class="feature-price feature-price-tmv">$0</div>','<div class="feature-price feature-price-invoice">$0</div>','<div class="feature-name">Base Price</div>',"</div>","</div>"].join(""),footerTemplate:['<div class="selected-features-footer">','<div class="total-price-row">','<div class="feature-price feature-price-msrp">$0</div>','<div class="feature-price feature-price-tmv">$0</div>','<div class="feature-price feature-price-invoice">$0</div>','<div class="feature-name">Total Price</div>',"</div>","</div>"].join(""),initialize:function(b){this.basePrice=this.setBasePrice(b.basePrice),this.list=new a.view.features.SelectedList({collection:this.collection})},render:function(){var a=c.template(this.headerTemplate,{baseMSRP:this.baseMSRP}),b=c.template(this.footerTemplate,{totalPrice:this.totalPrice});return this.$el.append(a),this.initPriceDropdown(),this.$el.append(this.list.el),this.$el.append(b),this},initPriceDropdown:function(){function a(a){var d=c.$(".feature-price");d.hide(),d.filter(function(){return b(this).hasClass("feature-price-"+a)}).show()}var c=this,d=this.$(".price-dropdown"),e=d.find("ul");return d.on({mouseenter:function(){e.show()},mouseleave:function(){e.hide()}}),e.find("li").on("click",function(){a(b(this).data("priceType")),e.hide()}),this},resize:function(){var a,b,c=this.$el.parent().height(),d=this.$(".selected-features-header"),e=this.$(".selected-features-footer"),f=d.height(),g=e.height(),h=this.$(".selected-features-list > :first");return(this.$el.closest(".nvcwidget").hasClass("nvcwidget-wide")||this.$el.closest(".nvcwidget").hasClass("nvcwidget-x-wide"))&&(c=this.$el.closest(".w1").height()),this.list.$el.css("max-height",c-(f+g)),1===h.length&&(a=h.outerWidth(),b=Math.max(e.outerWidth()-a,0),d.css("padding-right",b),e.css("padding-right",b)),this},setBasePrice:function(a){var b=this.$(".selected-features-header .base-price-row");return this.basePrice=a||{tmv:0,baseMSRP:0,baseInvoice:0},b.find(".feature-price-msrp").text(c.currency(this.basePrice.baseMSRP)),b.find(".feature-price-tmv").text(c.currency(this.basePrice.tmv)),b.find(".feature-price-invoice").text(c.currency(this.basePrice.baseInvoice)),this.updateTotalPrice(),this},updateTotalPrice:function(){var a=this.collection.getTotalPrice(),b=this.basePrice,d=this.$(".selected-features-footer");return d.find(".feature-price-msrp").text(c.currency(b.baseMSRP+a.baseMSRP)),d.find(".feature-price-tmv").text(c.currency(b.tmv+a.tmv)),d.find(".feature-price-invoice").text(c.currency(b.baseInvoice+a.baseInvoice)),this}}),a.namespace("view.features").Notification=d.View.extend({className:"feature-notification",events:{'click [data-action="ok"]':"onOkClick",'click [data-action="cancel"]':"onCancelClick"},itemTemplate:["<li>",'<span class="feature-price"><%= _.currency(feature.get("price").baseMSRP) %></span>','<span class="feature-name"><%= feature.get("name") %></span>',"</li>"].join(""),render:function(){var a,d;return this.options.required.length&&(this.$el.append("<p>Your selection requires the following:</p>"),a=b("<ul/>").appendTo(this.el),c.each(this.options.required,function(b){d=c.template(this.itemTemplate,b,{variable:"feature"}),a.append(d)},this),this.$el.append("<p>which will be selected.</p>")),this.options.excluded.length&&(this.$el.append(this.options.required.length?"<p>And excludes the following:</p>":"<p>Your selection excludes the following:</p>"),a=b("<ul/>").appendTo(this.el),c.each(this.options.excluded,function(b){d=c.template(this.itemTemplate,b,{variable:"feature"}),a.append(d)},this)),this.$el.append("<p>Continue with these changes?</p>"),this.$el.append(['<div class="feature-notification-buttons">','<button type="button" data-action="ok">Yes, continue</button>','<button type="button" data-action="cancel">Do not change</button>',"</div>"].join("")),this},onOkClick:function(){this.trigger("ok")},onCancelClick:function(){this.trigger("cancel")}}),a.namespace("view.features").CategoryList=d.View.extend({className:"features-category",events:{'[data-action="close"]':"onCloseClick"},initialize:function(){this.head=new a.view.features.Category({categoryName:this.options.categoryName,collection:this.collection}),this.list=new a.view.features.List({collection:this.collection}),this.button=new a.view.form.Button({className:"button-small button-light",text:"Close"}),this.button.on("click",this.close,this)},render:function(){return this.$el.html(this.head.render().el),this.$el.append(this.list.el),this.$el.append('<div class="features-category-footer"></div>'),this.$(".features-category-footer").append(this.button.render().el),this},close:function(){return this.trigger("close")}}),function(){var e=function(a){this.initialize(a)};c.extend(e.prototype,d.Events,{defaults:{},initialize:function(d){return this.options=c.extend({},this.defaults,d),this.features=new a.collection.Features,this.features.on("reset",this.renderCategories,this),this.$categoriesEl=b("#"+this.options.baseId+"_options"),this.$featuresEl=b("#"+this.options.baseId+"_category_features_list"),this.$selectedFeaturesEl=b("#"+this.options.baseId+"_options_list"),this.categoryListView=new a.view.features.CategoryList({el:this.$featuresEl,collection:new a.collection.Features}),this.categoryListView.render(),this.categoryListView.on("close",this.closeCategory,this),this.categoryListView.list.on("select",this.onSelectFeature,this),this.selectedFeatures=new a.view.features.SelectedFeatures({collection:new a.collection.Features}),this.selectedFeatures.list.on("select",this.onSelectFeature,this),b("#"+this.options.baseId+"_list_options").html(this.selectedFeatures.render().el),this},onSelectFeature:function(a,b,c){var d={},e=b?"select":"deselect";d[b?"selectedId":"deselectedId"]=a,this.trigger("vehicle.feature."+e,a),this.removeNotification(),this.selectedItemView=c,this.getConfigWithOptions(d)},getDefaultConfig:function(c){var d=this.features,e=this;return c=c||{},this.$categoriesEl.html('<div class="alert">Loading options...</div>'),this.$featuresEl.hide(),this.$categoriesEl.show(),(!c.previous||this.isNewStyle)&&this.features.resetState(),b.ajax({url:"http://api.edmunds.com/v1/api/configurator/default",data:{api_key:this.options.vehicleApiKey,zip:this.options.zipCode,styleid:this.options.styleId},timeout:7e3,dataType:"jsonp",success:function(b){if(b.error||b.errorMessage)return d.reset(),e.updateSelectedList(),void e.trigger("loaderror");var f=a.collection.Features.fromFeaturesMap(b.featuresMap),g=e.parseAdditionalFees(b);f.add(g),d.reset(f.models),e.updateFeaturesStatus(b,c.previous,{silent:!0}),e.trigger("load",b)},error:function(){d.reset(),e.updateSelectedList(),e.trigger("loaderror")}})},getConfigWithOptions:function(a){var c=(this.features,this.categoryListView.list),d=this;return c&&c.showLoadingOverlay(),b.ajax({url:"http://api.edmunds.com/v1/api/configurator/withOptions",data:{zip:this.options.zipCode,api_key:this.options.vehicleApiKey,styleid:this.options.styleId,optionid:this.features.currentState.selected,selected:a.selectedId,deselected:a.deselectedId},traditional:!0,timeout:7e3,dataType:"jsonp",success:function(b){return b.errorMessage?void d.updateFeaturesStatus({selectedOption:a.selectedId,deselectedOption:a.deselectedId}):b.error?void d.trigger("updateerror"):b.requiredItems.length||b.furtherRemovals.length?d.showNotification(b):void d.updateFeaturesStatus(b)},error:function(){},complete:function(){c&&c.hideLoadingOverlay(),d.updateSelectedList()}})},resizeCategoryList:function(){var a,b=this.categoryListView.$el,c=b.parent().height();a=c-(b.find(".features-category-head").outerHeight()+b.find(".features-category-footer").outerHeight()),b.find(".features-list").height(a)},parseAdditionalFees:function(b){if(b.error||b.hasOwnProperty("errorType"))return void this.trigger("loaderror");var c,d=b.pricingAttributeGroup.attributes,e=a.model.Feature,f=[];return d.DELIVERY_CHARGE&&d.DELIVERY_CHARGE.value>0&&(c=new e({id:"000000001",name:"Destination Fee",category:"Additional Fees",type:e.TYPE_OPTION,status:e.STATUS_UNAVAILABLE_SELECTED,price:{tmv:Number(d.DELIVERY_CHARGE.value),baseMSRP:Number(d.DELIVERY_CHARGE.value),baseInvoice:Number(d.DELIVERY_CHARGE.value)}}),f.push(c)),d.GAS_GUZZLER_TAX&&d.GAS_GUZZLER_TAX.value>0&&(c=new e({id:"000000002",name:"Gas Guzzler Tax",category:"Additional Fees",type:e.TYPE_OPTION,status:e.STATUS_UNAVAILABLE_SELECTED,price:{tmv:Number(d.GAS_GUZZLER_TAX.value),baseMSRP:Number(d.GAS_GUZZLER_TAX.value),baseInvoice:Number(d.GAS_GUZZLER_TAX.value)}}),f.push(c)),b.tmv&&b.tmv.regionalAdjustment&&(c=new e({id:"000000003",name:"Regional Adjustment",category:"Additional Fees",type:e.TYPE_OPTION,status:e.STATUS_UNAVAILABLE_SELECTED,price:{tmv:Number(b.tmv.regionalAdjustment.tmv),baseMSRP:null,baseInvoice:null}}),f.push(c)),b.tmv&&b.tmv.colorAdjustment&&(c=new e({id:"000000004",name:"Color Adjustment",category:"Additional Fees",type:e.TYPE_OPTION,status:e.STATUS_UNAVAILABLE_SELECTED,price:{tmv:Number(b.tmv.colorAdjustment.tmv),baseMSRP:null,baseInvoice:null}}),f.push(c)),c=new e({id:"000000005",name:"Advertising Fee",category:"Additional Fees",type:e.TYPE_OPTION,status:e.STATUS_UNAVAILABLE_SELECTED,price:{tmv:null,baseMSRP:null,baseInvoice:Number(b.tmv.regionalAdFee)}}),f.push(c),f},getSelectedOptionsIds:function(){var a=this.features.filter(function(a){return a.isSelected()});return c.map(a,function(a){return a.get("id")})},showNotification:function(b){function d(a){return this.features.filter(function(b){return c.contains(a,b.get("id"))})}this.removeNotification(),this.notification=new a.view.features.Notification({required:d.call(this,c.without(b.requiredItems,b.selectedOption)),excluded:d.call(this,b.furtherRemovals)}),this.notification.on("ok",function(){this.updateFeaturesStatus(b),this.removeNotification()},this),this.notification.on("cancel",function(){this.removeNotification()},this),this.selectedItemView&&(this.selectedItemView.$el.addClass("active"),this.selectedItemView.$el.append(this.notification.render().el))},removeNotification:function(){this.notification&&this.notification.remove(),this.selectedItemView&&this.selectedItemView.$el.removeClass("active")},updateFeaturesStatus:function(a,b,c){return this.features.applyOptions(a),b&&this.features.setPreviousState(),this.updateSelectedList(),this.categories.refresh(),this.categoryListView.head.updateTotalPrice(),(!c||c&&!c.silent)&&this.trigger("updatestatus"),this},setStyleId:function(a){return this.isNewStyle=this.options.styleId!==a,this.options.styleId=a,this},setZipCode:function(a){return this.options.zipCode=a,this},renderCategories:function(){return this.categories=new a.view.features.Categories({collection:this.features}),this.categories.on("opencategory",this.openCategory,this),this.$categoriesEl.html(this.categories.render().el),this},openCategory:function(a,b){return this.categoryListView.head.setTitle(a),this.categoryListView.collection.reset(b.models),this.$categoriesEl.hide(),this.$featuresEl.show(),this.resizeCategoryList(),this},closeCategory:function(){return this.removeNotification(),this.$featuresEl.hide(),this.$categoriesEl.show(),this},updateSelectedList:function(){var a=this.features.filter(function(a){return a.isSelected()||a.isIncluded()||a.isUnavailableSelected()});this.selectedFeatures.collection.reset(a),this.selectedFeatures.updateTotalPrice().resize()},setBasePrice:function(a){return this.selectedFeatures.updateBasePrice(a),this},reset:function(){return this.$featuresEl.hide(),this.$categoriesEl.empty(),this.$categoriesEl.show(),this}}),a.namespace("controller").VehicleFeatures=e}(),a.namespace("model.dealers").SearchCriteria=d.Model.extend({defaults:{api_key:"",makeName:"",model:"",styleid:"",zipcode:"",keywords:"",premierOnly:!1,radius:100,rows:5,isPublic:!1,bookName:"",invalidTiers:"T1",sortBy:"dealer_distance:asc",fmt:"json"}}),a.namespace("model.dealers").Dealer=d.Model.extend({defaults:{address:{},displayinfo:{},ratings:{},selected:!1},getAddress:function(){var a=this.attributes.address;return a.city+", "+a.stateCode+" "+a.zipcode},getDistance:function(){return parseFloat(this.attributes.displayinfo.dealer_distance).toFixed(2)},getPhone:function(){return this.attributes.displayinfo.dealer_trackable_phone},getFullRating:function(){return parseFloat(this.attributes.ratings.SALES_OVERALL_RATING)||0},getRatingClassName:function(){var a=this.getFullRating();return(Math.round(2*a)/2).toString().replace(".","_")},getReviewsCount:function(){var a=this.attributes.ratings,b=parseInt(a.SALES_RECOMMENDED_REVIEW_COUNT,10)||0,c=parseInt(a.SALES_NOT_RECOMMENDED_REVIEW_COUNT,10)||0;return b+c},getSalesReviewsUrl:function(){return this.getUrl()+"/sales.1.html"},getUrl:function(){var a=this.attributes,b=a.address;return["http://www.edmunds.com/dealerships",b.stateName.replace(/\s+/g,""),b.city.replace(/\s+/g,""),a.logicalName].join("/")},isPremier:function(){return"true"===this.attributes.displayinfo.is_premier},isSelected:function(){return this.attributes.selected}}),a.namespace("collection").Dealers=d.Collection.extend({url:"http://api.edmunds.com/v1/api/dealer",model:a.model.dealers.Dealer,parse:function(a){return a.dealerHolder},setSelected:function(a){return c.each(a,function(b){var d=this.get(b);d?d.set("selected",!0):a=c.without(a,b)},this),a}}),a.namespace("view.dealers").ListItem=d.View.extend({className:"item",template:['<div class="item-inner"><div class="item-inner-bg">','<input type="checkbox" value="<%= dealer.get("id") %>" <% if (dealer.isSelected()) { %> checked="checked"<% } %>>','<div class="info">','<span class="name"><%= dealer.get("name") %></span>','<span class="map"><span><%= dealer.getDistance() %> mi</span><%= dealer.getAddress() %> <a href="<%= dealer.getUrl() %>" target="_blank"></a></span>','<span class="phone"><%= dealer.getPhone() %></span>','<span class="rating r<%= dealer.getRatingClassName() %>" title="<%= dealer.getFullRating() %>"></span>','<span class="reviews">','(<a href="<%= dealer.getSalesReviewsUrl() %>" target="_blank"><%= dealer.getReviewsCount() %> consumer review<% if (dealer.getReviewsCount() > 1) { print("s"); } %></a>)',"</span>","</div>","</div></div>"].join(""),initialize:function(){this.model.on("change",this.render,this)},render:function(){return this.el.innerHTML=c.template(this.template,{dealer:this.model}),this.model.isPremier()&&this.$el.addClass("premier-dealer"),this}}),a.namespace("view.dealers").List=d.View.extend({className:"list",events:{'click [data-action="select-all"]':"onSelectAllClick",'click [type="checkbox"]':"onChange"},initialize:function(){this.collection.on("reset",this.render,this),this.collection.on("request",this.onRequest,this)},render:function(){return 0===this.collection.length?this.showMessage("There are no dealers in our network that are located within your location."):(1===this.collection.length&&(this.collection.at(0).set("selected",!0),this.trigger("change",this.collection.at(0),!0)),this.$el.empty(),this.collection.each(this.add,this),this)},add:function(b){var c=new a.view.dealers.ListItem({model:b});return this.el.appendChild(c.render().el),this},showMessage:function(a){return this.$el.html('<div class="loading">'+a+"</div>"),this},onChange:function(a){var b=a.target,c=this.collection.get(b.value);a.preventDefault(),c.set("selected",b.checked),this.trigger("change",c,b.checked)
},onRequest:function(){return this.$el.html('<div class="loading">Loading dealers...</div>'),this.showMessage("Loading dealers...")}}),a.namespace("view").Dealers=d.View.extend({events:{"click .tab":"onTabClick"},selectedDealers:[],initialize:function(){this.premierDealers=new a.view.dealers.List({collection:new a.collection.Dealers}),this.allDealers=new a.view.dealers.List({collection:new a.collection.Dealers}),this.premierDealers.on("change",this.onPremierChange,this),this.allDealers.on("change",this.onAllChange,this),this.searchCriteria=new a.model.dealers.SearchCriteria,this.searchCriteria.on("change",this.findDealers,this),this.searchCriteria.on("change:makeName",this.onMakeChange,this)},isGMC:function(){return"GMC"===this.searchCriteria.get("makeName")},onMakeChange:function(a,b){var c="GMC"===b;this.$('.tab[data-tab-id="all"]')[c?"show":"hide"](),this.showTabById("premier")},findDealers:function(){return this.findPremierDealers(),this.isGMC()&&this.findAllDealers(),this},findAllDealers:function(){return this.searchCriteria.set("premierOnly",!1,{silent:!0}),this.allDealers.collection.fetch({data:this.searchCriteria.toJSON(),dataType:"jsonp",timeout:7e3,reset:!0}).done(c.bind(this.onFindAllDealersDone,this)).fail(c.bind(this.onFindAllDealersFail,this))},findPremierDealers:function(){return this.searchCriteria.set("premierOnly",!0,{silent:!0}),this.premierDealers.collection.fetch({data:this.searchCriteria.toJSON(),dataType:"jsonp",timeout:7e3,reset:!0}).done(c.bind(this.onFindPremierDealersDone,this)).fail(c.bind(this.onFindPremierDealersFail,this))},render:function(){return this.$(".tab-panel-premier").html(this.premierDealers.render().el),this.$(".tab-panel-all").html(this.allDealers.render().el),this},onFindPremierDealersDone:function(){this.selectedDealers=this.premierDealers.collection.setSelected(this.selectedDealers)},onFindPremierDealersFail:function(){this.premierDealers.collection.reset()},onFindAllDealersDone:function(){this.selectedDealers=this.allDealers.collection.setSelected(this.selectedDealers)},onFindAllDealersFail:function(){this.premierDealers.collection.reset()},onTabClick:function(a){var c=b(a.currentTarget),d="active";c.hasClass(d)||this.showTabById(c.data("tabId"))},showTabById:function(a){var b="active";return this.$(".tab").removeClass(b).filter('[data-tab-id="'+a+'"]').addClass(b),this.$(".tab-panel").removeClass(b).filter(".tab-panel-"+a).addClass(b),this},onAllChange:function(a,b){var d=a.get("id"),e=this.premierDealers.collection.get(d);e&&e.set("selected",b),this.selectedDealers=b?c.union(this.selectedDealers,[d]):c.without(this.selectedDealers,d),this.trigger(b?"select":"deselect",a)},onPremierChange:function(a,b){var d=a.get("id"),e=this.allDealers.collection.get(d);e&&e.set("selected",b),this.selectedDealers=b?c.union(this.selectedDealers,[d]):c.without(this.selectedDealers,d),this.trigger(b?"select":"deselect",a)},getSelected:function(){var b=new a.collection.Dealers,c=function(a){return a.get("selected")};return b.add(this.allDealers.collection.filter(c)),b.add(this.premierDealers.collection.filter(c)),b},reset:function(){return this.selectedDealers=[],this.allDealers.collection.reset(),this.premierDealers.collection.reset(),this.searchCriteria.unset("makeName",{silent:!0}),this}})}(window.EDM,window.jQuery,window._,window.Backbone);
define("underscore",function(){return window._}),define("backbone",function(){return window.Backbone}),define("api/Core",["jquery","underscore"],function(e,t){function r(e){var t=e,n="http://api.edmunds.com";this.getApiKey=function(){return t},this.getBaseUrl=function(){return n}}var n=[].slice;return r.mixin=function i(){return t.each(n.call(arguments),function(e){if(t.isArray(e))return i.apply(this,e);t.extend(this.prototype,t.pick(e,t.functions(e)))},this),this},r.mixin({get:function(n,r,i){var s=e.Deferred();return r=t.defaults(r||{},{api_key:this.getApiKey(),fmt:"json"}),i=t.defaults(i||{},{cache:!1,timeout:5e3,traditional:!0}),s.done(i.success).fail(i.error),e.ajax({url:this.getBaseUrl()+n,data:r,dataType:"jsonp",timeout:i.timeout,success:function(e){if(e.errorType){s.reject({message:e.message});return}if(e.error){s.reject({message:e.error.message});return}if(e.errorMessage){s.reject({message:e.errorMessage});return}s.resolve(e)},error:function(){s.reject({message:"timeout"})}}),s.promise()}}),r}),define("api/helper/PublicationState",[],{NEW:"new",USED:"used",FUTURE:"future"}),define("api/mixin/find-vehicle-makes",["api/helper/PublicationState"],function(e){return{findVehicleMakes:function(e){return this.get("/api/vehicle/v2/makes",{state:e})},findNewVehicleMakes:function(){return this.findVehicleMakes(e.NEW)},findUsedVehicleMakes:function(){return this.findVehicleMakes(e.USED)},findFutureVehicleMakes:function(){return this.findVehicleMakes(e.FUTURE)},findNewUsedVehicleMakes:function(){return this.findVehicleMakes([e.NEW,e.USED])}}}),define("api/mixin/find-vehicle-models",["api/helper/PublicationState"],function(e){return{findVehicleModels:function(e,t){var n=["/api/vehicle/v2",e,"models"].join("/");return this.get(n,{state:t})},findNewVehicleModels:function(t){return this.findVehicleModels(t,e.NEW)},findUsedVehicleModels:function(t){return this.findVehicleModels(t,e.USED)},findFutureVehicleModels:function(t){return this.findVehicleModels(t,e.FUTURE)},findNewUsedVehicleModels:function(t){return this.findVehicleModels(t,[e.NEW,e.USED])}}}),define("api/mixin/find-vehicle-years",["api/helper/PublicationState"],function(e){return{findVehicleYears:function(e,t,n,r){var i=["/api/vehicle/v2",e,t,"years"].join("/");return this.get(i,{state:r,submodel:n})},findNewVehicleYears:function(t,n,r){return this.findVehicleYears(t,n,r,e.NEW)},findUsedVehicleYears:function(t,n,r){return this.findVehicleYears(t,n,r,e.USED)},findFutureVehicleYears:function(t,n,r){return this.findVehicleYears(t,n,r,e.FUTURE)},findNewUsedVehicleYears:function(t,n,r){return this.findVehicleYears(t,n,r,[e.NEW,e.USED])}}}),define("api/mixin/find-vehicle-styles",["api/helper/PublicationState"],function(e){return{findVehicleStyles:function(e,t,n,r,i){var s=["/api/vehicle/v2",e,t,r,"styles"].join("/");return this.get(s,{state:i,submodel:n})},findNewVehicleStyles:function(t,n,r,i){return this.findVehicleStyles(t,n,r,i,e.NEW)},findUsedVehicleStyles:function(t,n,r,i){return this.findVehicleStyles(t,n,r,i,e.USED)},findFutureVehicleStyles:function(t,n,r,i){return this.findVehicleStyles(t,n,r,i,e.FUTURE)},findNewUsedVehicleStyles:function(t,n,r,i){return this.findVehicleStyles(t,n,r,i,[e.NEW,e.USED])}}}),define("api/Vehicle",["api/Core","api/mixin/find-vehicle-makes","api/mixin/find-vehicle-models","api/mixin/find-vehicle-years","api/mixin/find-vehicle-styles"],function(e,t,n,r,i){return e.mixin([t,n,r,i])}),define("view/vehicle/Select",["underscore","backbone","api/Vehicle"],function(e,t,n){var r=["defaultText","loadingText","selectText","emptyText","Collection"];return t.View.extend({tagName:"select",className:"form-select",defaultText:"List of Items",emptyText:"Items not found",selectText:"Select an Item",loadingText:"Loading Items...",Collection:t.Collection,events:{change:"onChange"},initialize:function(t){e.extend(this,e.pick(t,r)),this.api=new n(t.apiKey),this.collection=new this.Collection,this.collection.on("reset",this.render,this)},render:function(){return this.collection.length===0?(this.empty(this.emptyText),this):(this.empty(this.selectText),this.collection.each(this.add,this),this.enable(),this)},add:function(e){return this.$el.append('<option value="'+e.get("id")+'">'+e.get("name")+"</option>"),this},reset:function(){return this.empty(this.defaultText),this.collection.reset([],{silent:!0}),this.trigger("reset"),this},disable:function(){return this.el.setAttribute("disabled","disabled"),this},enable:function(){return this.el.removeAttribute("disabled"),this},empty:function(e){return this.$el.html('<option value="-1">'+e+"</option>"),this.disable(),this},onChange:function(){var e=this.collection.get(this.$el.val());this.trigger("change",e)}})}),define("model/vehicle/Make",["backbone"],function(e){return e.Model.extend({defaults:{}})}),define("collection/vehicle/Makes",["backbone","model/vehicle/Make"],function(e,t){return e.Collection.extend({model:t,comparator:function(e){return e.get("name")}})}),define("view/vehicle/Makes",["underscore","view/vehicle/Select","collection/vehicle/Makes"],function(e,t,n){return t.extend({Collection:n,defaultText:"List of Makes",emptyText:"Makes not found",selectText:"Select a Make",loadingText:"Loading Makes...",find:function(){return this.reset(),this.empty(this.loadingText),this.api.findNewVehicleMakes().done(e.bind(this.onFindDone,this)).fail(e.bind(this.onFindFail,this))},filterMakes:function(t,n){return n==="all"?t:(e.isString(n)&&(n=n.split(",")),e.filter(t,function(t){return e.contains(n,t.niceName)}))},onFindDone:function(e){var t=this.filterMakes(e.makes,this.options.includedMakes);this.collection.reset(t)},onFindFail:function(){this.collection.reset(),this.trigger("error",{message:"Makes has not been loaded"})}})}),define("model/vehicle/SubModel",["backbone"],function(e){return e.Model.extend({defaults:{}})}),define("collection/vehicle/SubModels",["backbone","model/vehicle/SubModel"],function(e,t){return e.Collection.extend({model:t,comparator:function(e){return e.get("modelName")}})}),define("view/vehicle/SubModels",["backbone","collection/vehicle/SubModels"],function(e,t){return e.View.extend({tagName:"optGroup",initialize:function(e){this.el.setAttribute("label",e.modelName),this.collection=new t,this.collection.on("reset",this.render,this)},render:function(){return this.collection.each(this.add,this),this},add:function(e){var t=this.options.modelId+":"+e.get("niceName");return this.$el.append('<option value="'+t+'">'+e.get("modelName")+"</option>"),this}})}),define("model/vehicle/Model",["underscore","backbone"],function(e,t){return t.Model.extend({getSubModels:function(){var t={};return e.each(this.attributes.years,function(n){e.each(n.styles,function(e){var n=e.submodel;t[n.niceName]||(t[n.niceName]=n)})}),e.values(t)}})}),define("collection/vehicle/Models",["backbone","model/vehicle/Model"],function(e,t){return e.Collection.extend({model:t,comparator:function(e){return e.get("name")}})}),define("view/vehicle/Models",["underscore","view/vehicle/Select","view/vehicle/SubModels","collection/vehicle/Models"],function(e,t,n,r){return t.extend({Collection:r,defaultText:"List of Models",emptyText:"Models not found",selectText:"Select a Model",loadingText:"Loading Models...",add:function(e){var t=new n({modelId:e.get("id"),modelName:e.get("name")});return this.$el.append(t.el),t.collection.reset(e.getSubModels()),this},find:function(t){return this.reset(),this.empty(this.loadingText),this.api.findNewVehicleModels(t).done(e.bind(this.onFindDone,this)).fail(e.bind(this.onFindFail,this))},onFindDone:function(e){this.collection.reset(e.models)},onFindFail:function(){this.collection.reset(),this.trigger("error",{message:"Models has not been loaded"})},onChange:function(){var e=this.$el.val().split(":"),t=e[0],n=e[1],r=this.collection.get(t);this.trigger("change",r,n)}})}),define("model/vehicle/Year",["backbone"],function(e){return e.Model.extend({defaults:{}})}),define("collection/vehicle/Years",["backbone","model/vehicle/Year"],function(e,t){return e.Collection.extend({model:t,comparator:function(e){return e.get("year")}})}),define("view/vehicle/Years",["underscore","view/vehicle/Select","collection/vehicle/Years"],function(e,t,n){return t.extend({Collection:n,defaultText:"List of Years",emptyText:"Years not found",selectText:"Select a Year",loadingText:"Loading Years...",add:function(e){return this.$el.append('<option value="'+e.get("id")+'">'+e.get("year")+"</option>"),this},find:function(t,n,r){return this.reset(),this.empty(this.loadingText),this.api.findNewVehicleYears(t,n,r).done(e.bind(this.onFindDone,this)).fail(e.bind(this.onFindFail,this))},onFindDone:function(e){this.collection.reset(e.years)},onFindFail:function(){this.collection.reset(),this.trigger("error",{message:"Years has not been loaded"})}})}),define("model/vehicle/Style",["backbone"],function(e){return e.Model.extend({defaults:{}})}),define("collection/vehicle/Styles",["backbone","model/vehicle/Style"],function(e,t){return e.Collection.extend({model:t,comparator:function(e){return e.get("name")}})}),define("view/vehicle/Styles",["underscore","view/vehicle/Select","collection/vehicle/Styles"],function(e,t,n){return t.extend({Collection:n,defaultText:"List of Styles",emptyText:"Styles not found",selectText:"Select a Style",loadingText:"Loading Styles...",find:function(t,n,r,i){return this.reset(),this.empty(this.loadingText),this.api.findNewVehicleStyles(t,n,r,i).done(e.bind(this.onFindDone,this)).fail(e.bind(this.onFindFail,this))},onFindDone:function(e){this.collection.reset(e.styles)},onFindFail:function(){this.collection.reset(),this.trigger("error",{message:"Styles has not been loaded"})}})}),define("view/vehicle/StyleConfigurator",["underscore","backbone","view/vehicle/Makes","view/vehicle/Models","view/vehicle/Years","view/vehicle/Styles"],function(e,t,n,r,i,s){return t.View.extend({className:"vehicle-style-configurator",initialize:function(){this.selection=new t.Model,this.initializeViews(),this.initializeEvents()},initializeViews:function(){var e=this.options,t=e.apiKey;this.makes=new n({apiKey:t,includedMakes:e.includedMakes}),this.models=new r({apiKey:t}),this.years=new i({apiKey:t}),this.styles=new s({apiKey:t})},initializeEvents:function(){this.makes.on("change",this.onChangeMake,this),this.models.on("change",this.onChangeModel,this),this.years.on("change",this.onChangeYear,this),this.styles.on("change",this.onChangeStyle,this),this.makes.on("reset",this.unsetMake,this),this.models.on("reset",this.unsetModel,this),this.years.on("reset",this.unsetYear,this),this.styles.on("reset",this.unsetStyle,this),this.makes.on("error",this.error,this),this.models.on("error",this.error,this),this.years.on("error",this.error,this),this.styles.on("error",this.error,this)},render:function(){var e=this.el;return e.appendChild(this.makes.el),e.appendChild(this.models.el),e.appendChild(this.years.el),e.appendChild(this.styles.el),this.reset(),this},reset:function(){return this.makes.reset(),this},findMakes:function(){return this.makes.find()},findModels:function(t){return this.onBeforeModelsFind(),this.models.find(t).always(e.bind(this.onAfterModelsFind,this))},findYears:function(t,n,r){return this.onBeforeYearsFind(),this.years.find(t,n,r).always(e.bind(this.onAfterYearsFind,this))},findStyles:function(t,n,r,i){return this.onBeforeStylesFind(),this.styles.find(t,n,r,i).always(e.bind(this.onAfterStylesFind,this))},onChangeMake:function(e){if(!e){this.unsetMake();return}this.setMake(e),this.findModels(e.get("niceName"))},onChangeModel:function(e,t){var n=this.selection.get("make");if(!e){this.unsetModel();return}this.setModel(e,t),this.findYears(n.get("niceName"),e.get("niceName"),t)},onChangeYear:function(e){var t=this.selection.get("make"),n=this.selection.get("model"),r=this.selection.get("subModelNiceName");if(!e){this.unsetYear();return}this.setYear(e),this.findStyles(t.get("niceName"),n.get("niceName"),r,e.get("year"))},onChangeStyle:function(e){if(!e){this.unsetStyle();return}this.setStyle(e),this.complete()},onBeforeModelsFind:function(){this.makes.disable()},onBeforeYearsFind:function(){this.makes.disable(),this.models.disable()},onBeforeStylesFind:function(){this.makes.disable(),this.models.disable(),this.years.disable()},onAfterModelsFind:function(){this.makes.enable()},onAfterYearsFind:function(){this.makes.enable(),this.models.enable()},onAfterStylesFind:function(){this.makes.enable(),this.models.enable(),this.years.enable()},setMake:function(e){return this.selection.set("make",e),this},setModel:function(e,t){return this.selection.set({model:e,subModelNiceName:t}),this},setYear:function(e){return this.selection.set("year",e),this},setStyle:function(e){return this.selection.set("style",e),this},unsetMake:function(){return this.selection.unset("make"),this.models.reset(),this},unsetModel:function(){return this.selection.unset("model").unset("subModelNiceName"),this.years.reset(),this},unsetYear:function(){return this.selection.unset("year"),this.styles.reset(),this},unsetStyle:function(){return this.selection.unset("style"),this.trigger("reset"),this},complete:function(){return this.trigger("complete",this.selection),this},error:function(e){return this.trigger("error",e),this}})}),function(e,t,n,r){function o(){if(navigator.userAgent.match(/android 3/i)||navigator.userAgent.match(/honeycomb/i))return!1;try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}var i=navigator.appName==="Microsoft Internet Explorer"?!0:!1,s=function(e,t,n){return document.getElementsByClassName?s=function(e,t,n){n=n||document;var r=n.getElementsByClassName(e),i=t?new RegExp("\\b"+t+"\\b","i"):null,s=[],o;for(var u=0,a=r.length;u<a;u+=1)o=r[u],(!i||i.test(o.nodeName))&&s.push(o);return s}:document.evaluate?s=function(e,t,n){t=t||"*",n=n||document;var r=e.split(" "),i="",s="http://www.w3.org/1999/xhtml",o=document.documentElement.namespaceURI===s?s:null,u=[],a,f;for(var l=0,c=r.length;l<c;l+=1)i+="[contains(concat(' ', @class, ' '), ' "+r[l]+" ')]";try{a=document.evaluate(".//"+t+i,n,o,0,null)}catch(h){a=document.evaluate(".//"+t+i,n,null,0,null)}while(f=a.iterateNext())u.push(f);return u}:s=function(e,t,n){t=t||"*",n=n||document;var r=e.split(" "),i=[],s=t==="*"&&n.all?n.all:n.getElementsByTagName(t),o,u=[],a;for(var f=0,l=r.length;f<l;f+=1)i.push(new RegExp("(^|\\s)"+r[f]+"(\\s|$)"));for(var c=0,h=s.length;c<h;c+=1){o=s[c],a=!1;for(var p=0,d=i.length;p<d;p+=1){a=i[p].test(o.className);if(!a)break}a&&u.push(o)}return u},s(e,t,n)};n.mixin({currency:function(e){return e<0?(e*=-1,"($"+n.formatNumber(e)+")"):"$"+n.formatNumber(e)},formatNumber:function(e){return(Number(e)||0).toString().split(/(?=(?:\d{3})+(?:\.|$))/g).join(",")},rgb2hex:function(e){function t(e){return Number(e).toString(16).replace(/^(.)$/,"0$1")}return"#"+t(e.r)+t(e.g)+t(e.b)}});var u=e.NVC=function(i,o,a){var f,l,c=o;this.getDealerApiKey=function(){return c},e.Widget.call(this,i,a),n.extend(this,r.Events),this.htmlSetup=function(){function H(e){var t;for(t in e)return!1;return!0}function B(){if(g&&E&&y){x.removeAttribute("disabled");return}x.setAttribute("disabled","disabled")}function j(){t(N).closest(".nvcwidget-nav-bottom-inner").find(".msg-error").remove()}function F(e,t){E=!0,b.zipcode=e,this.configLeadForm.setOption("zip",e),this.vehicleFeaturesController.setZipCode(e),this.zipUpdate.updateZipCode(e),this.zipLocation.updateZipCode(e),this.zipMiField.updateZipCode(e),this.dealers.searchCriteria.unset("zipcode",{silent:!0}).set("zipcode",e),j(),this.zip=e,g&&this.vehiclePrice.loadPrice(this.configLeadForm.config.styleid,e,this.vehicleFeaturesController.getSelectedOptionsIds())}function q(){B(),l.eq(1).addClass("disable"),l.eq(2).addClass("disable")}var o=this,a=o.getBaseId(),c=o.getBaseClass(),h=o.getRootElement(),p=this.getOptions(),d=EDMUNDSAPI.Vehicle,v=this.getApiKey(),m=this.getDealerApiKey(),g=!1,y=!1,b={radius:100,rows:5,isPublic:!1,bookName:"",apiKey:m,premierOnly:!0,invalidTiers:"T1",keywords:p.dealerKeywords},w=this.zip=typeof p.zip=="string"?p.zip:"",E=w?!0:!1,S="";if(navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i))S="apple-device";b.zipcode=w;if(h===null)throw new Error("Root element was not found.");h.innerHTML=n.template(u.template,{titleTooltip:u.TOOLTIP_TITLE,baseId:a,nav:S,baseClass:o.getBaseClass(),layoutType:p.layoutType});var x=document.getElementById(a+"_button"),T=document.getElementById(a+"_button2"),N=document.getElementById(a+"_button3"),C=s(c+"-list-dealer","div",document)[0],k=document.getElementById(a+"_list_options"),L=document.getElementById(a+"_price"),A=document.getElementById(a+"_zip_location"),O=document.getElementById(a+"_zip_mi"),M=document.getElementById(a+"_form"),D=document.getElementById(a+"_tmvprice"),P=!1;l=t("#"+a+"_tabs").find(".tab"),f=document.getElementById(a+"_tab_content"),this.printEmailOptions=new r.Model,this.styleConfigurator=new e.VehicleStyleConfigurator({apiKey:v,includedMakes:p.includedMakes}),document.getElementById(a+"_filters").appendChild(this.styleConfigurator.render().el),this.vehiclePhotos=new e.nvc.VehiclePhotos({vehicleApiKey:i,colorScheme:p.colorScheme}),document.getElementById(a+"_vehicle_details").appendChild(this.vehiclePhotos.render().el),this.vehicleDetails=new e.nvc.VehicleDetails,document.getElementById(a+"_vehicle_details").appendChild(this.vehicleDetails.el),this.vehicleDetails2=new e.nvc.VehicleDetails,document.getElementById(a+"_vehicle_details2").appendChild(this.vehicleDetails2.el),this.vehicleDetails3=new e.nvc.VehicleDetails,document.getElementById(a+"_vehicle_details3").appendChild(this.vehicleDetails3.el),this.vehicleFeaturesController=new e.controller.VehicleFeatures({vehicleApiKey:i,baseId:a,zipCode:w}),this.zipUpdate=new e.view.form.ZipUpdate({vehicleApiKey:i,zipCode:w}),t("#"+a+"_zip_configure").append(this.zipUpdate.render().el),this.zipLocation=new e.view.form.ZipLocation({vehicleApiKey:i,zipCode:w}),t(A).html(this.zipLocation.render().el),this.zipMiField=new e.view.form.ZipMiField({el:t("#"+a+"_zip_mi"),vehicleApiKey:i,zipCode:w,radius:b.radius}),this.zipMiField.render(),this.configLeadForm=new e.nvc.ConfigLeadForm(v),this.configLeadForm.setOption("zip",w),this.vehiclePrice=new e.nvc.VehiclePrice({el:L,vehicleApiKey:i}),this.dealers=new e.view.Dealers({el:t(C)}),this.dealers.searchCriteria.set({zipcode:w,api_key:m,keywords:(p.dealerKeywords||[]).join(",")},{silent:!0}),this.dealers.render(),this.messageDialog=new e.nvc.MessageDialog,this.vehicleForm=new e.ui.VehicleForm,this.vehicleForm.render(M),this.vehicleApi=new d(v),x.onclick=function(){o.showTab(l[p.tabs.tab2?1:2]),o.vehiclePrice.updateGraph(),o.trigger("nextbtn1.click")},T.onclick=function(){o.showTab(l[2]),o.trigger("nextbtn2.click")},N.onclick=function(){function g(e){h.appendChild(o.messageDialog.render(e).el),o.messageDialog.init(),o.messageDialog.on("reset",function(){o.showTab(l[0]),o.styleConfigurator.reset(),F.call(o,w),o.vehicleForm.resetValues(),o.styleConfigurator.findMakes(),o.trigger("dialogbtn.click"),o.trigger("reset")})}function b(e){i.isSuccess=!0,g(i),N.removeAttribute("disabled"),N.innerHTML=y,o.trigger("leadformsubmit")}function E(e){i.isSuccess=!1,g(i),N.removeAttribute("disabled"),N.innerHTML=y}var r=o.configLeadForm.config,i={isSuccess:!0,name:[r.year,r.makeName,r.model].join(" "),dealers:[]},s,u,a,f,c=[],p=[],d=H(r.dealers),v=new EDMUNDSAPI.Vehicle(m);v.submitLeadForm=function(e,r,i){return t.ajax({url:"http://widgets.edmunds.com/dealer/sendlead",data:n.defaults(e||{},{fmt:"json",api_key:m}),dataType:"jsonp",timeout:7e3,traditional:!0,success:r,error:i})},j();if(d){t(N).closest(".nvcwidget-nav-bottom-inner").prepend('<div class="msg-error">At least 1 dealer must be selected.</div>');return}r.dealers.each(function(e){c.push(e.get("id")),i.dealers.push(e.get("name"))}),s={make:r.make,model:r.modelNiceName,year:r.year,style:r.styleid,optIds:r.options.join(","),pqrf_sbmtdlr:c,zip:r.zip,firstname:r.firstname,lastname:r.lastname,email:r.email,area_code:r.phoneCode,phone_prefix:r.phonePrefix,phone_suffix:r.phoneSuffix,client_key:e.util.ClientKeyGenerator.generate(16,36)};var y=N.innerHTML;N.setAttribute("disabled","disabled"),N.innerHTML="Getting dealer quotes...",v.submitLeadForm(s,b,E),o.trigger("submitbtn.click")},this.styleConfigurator.on("complete",function(e,n){var r=e.get("make"),i=e.get("model"),s=e.get("year"),u=e.get("style"),a=r.get("name"),f=r.get("niceName"),l=i.get("name"),c=i.get("niceName"),p=u.get("id");b.makeName=a,b.model=l,b.styleId=p,this.configLeadForm.setOption("make",f),this.configLeadForm.setOption("makeName",a),this.configLeadForm.setOption("model",l),this.configLeadForm.setOption("modelNiceName",c),this.configLeadForm.setOption("year",s.get("year")),this.configLeadForm.setOption("styleName",u.get("name")),this.configLeadForm.setOption("styleid",p),this.vehicleFeaturesController.setStyleId(p),this.zip&&(this.vehiclePhotos.loadPhotos(p),this.dealers.searchCriteria.set({makeName:a,model:l,styleid:p}),this.zipLocation.loadLocation(),this.vehiclePrice.loadPrice(p,this.zip,[])),this.resizeOptionsContainer(),o.vehiclePhotos.loadPhotos(p),y=!1,g=!0,B(),t(h).find(".get-started").hide()},this),this.styleConfigurator.on("error",function(e){h.appendChild(o.messageDialog.render({isSuccess:!1,text:n.isString(e)?e:'<p>Something went wrong!</p><p>Please return and try again or <a href="Mailto:api@edmunds.com">contact</a> us directly.</p>'}).el),o.messageDialog.init()}),this.styleConfigurator.on("reset",function(e){this.vehiclePhotos.reset(),this.vehicleDetails.reset(),this.vehicleFeaturesController.reset(),this.configLeadForm.reset({contacts:!0,zip:!0}),this.vehicleForm.resetValues();var n=s("msg-error","div",N.parentNode)[0];n&&N.parentNode.removeChild(n),this.dealers.reset(),g=!1,P=!1,q(),t(h).find(".get-started").show()},this),this.vehicleFeaturesController.on("updatestatus",function(e){var t=this.configLeadForm.config.styleid,n=this.configLeadForm.config.zip,r=this.vehicleFeaturesController.getSelectedOptionsIds();this.vehiclePrice.loadPrice(t,n,r),this.configLeadForm.setOption("options",r)},this),this.vehicleFeaturesController.on("load loaderror",function(e){y=!0,B(),t(l[1]).removeClass("disable"),t(l[2]).removeClass("disable")},this),this.vehiclePrice.on("load",function(e,t){var r=o.configLeadForm.config,i={tmv:t.tmv.nationalBasePrice.tmv,baseMSRP:t.tmv.nationalBasePrice.baseMSRP,baseInvoice:t.tmv.nationalBasePrice.baseInvoice},s={name:[r.year,r.makeName,r.model].join(" "),description:r.styleName,price:i.baseMSRP},u,a;g&&(this.vehicleDetails.render(s,!0),this.vehicleDetails2.render(s,!1),this.vehicleDetails3.render(s,!1)),y?this.updatePrices(t):this.vehicleFeaturesController.getDefaultConfig({previous:g}).done(n.bind(function(){this.updatePrices(t)},this)),B()},this),this.updatePrices=function(r){var i={tmv:r.tmv.nationalBasePrice.tmv,baseMSRP:r.tmv.nationalBasePrice.baseMSRP,baseInvoice:r.tmv.nationalBasePrice.baseInvoice},s=this.configLeadForm.config,o={name:[s.year,s.makeName,s.model].join(" "),description:s.styleName},u,a;this.vehicleFeaturesController.selectedFeatures.collection.updatePrices(r.tmv),this.vehicleFeaturesController.selectedFeatures.setBasePrice(i),u=this.vehicleFeaturesController.selectedFeatures.collection.getTotalPrice(),a={tmv:i.tmv+u.tmv,baseMSRP:i.baseMSRP+u.baseMSRP,baseInvoice:i.baseInvoice+u.baseInvoice};var f=t(h).find(".incentives").hide();if(r.tmv.incentivesAndRebates>0){var l=new e.view.IncentivesAndRebates({el:f,turnedOn:P,incentive:r.tmv.incentivesAndRebates});l.on("change",function(e){var i=r.tmv.incentivesAndRebates*(e?-1:1);P=e,a.tmv+=i,t(D).html('True Market Value<sub>&reg;</sub>:&nbsp;<sub class="currency">$</sub><span class="price">'+n.formatNumber(a.tmv)+"</span>"),this.vehiclePrice.render({tmv:a.tmv,invoice:a.baseInvoice,msrp:a.baseMSRP})},this),l.render(),f.show(),P&&(a.tmv-=r.tmv.incentivesAndRebates)}I.find(".tab-2")[r.tmv.incentivesAndRebates>0?"addClass":"removeClass"]("with-insentive"),t(D).html('True Market Value<sub>&reg;</sub>:&nbsp;<sub class="currency">$</sub><span class="price">'+n.formatNumber(a.tmv)+"</span>"),this.vehiclePrice.render({tmv:a.tmv,invoice:a.baseInvoice,msrp:a.baseMSRP}),this.printEmailOptions.set({vehicleFullName:o.name,vehicleStyleName:o.description,totalPrice:a,basePrice:i,customerCashPrice:r.tmv.incentivesAndRebates}),this.configLeadForm.setOption("price",a)},this.vehiclePrice.on("loaderror",function(e,t){h.appendChild(o.messageDialog.render({isSuccess:!1,text:'<p>Something went wrong!</p><p>Please return and try again or <a href="Mailto:api@edmunds.com">contact</a> us directly.</p>'}).el),o.messageDialog.init()}),this.zipUpdate.on("update",F,this),this.zipLocation.on("update",F,this),this.zipMiField.on("update",function(e,t){this.configLeadForm.setOption("radius",t),this.dealers.searchCriteria.set("radius",t,{silent:!0}),F.call(this,e)},this),this.dealers.on("select",function(){this.configLeadForm.setOption("dealers",this.dealers.getSelected()),N.disabled=!this.configLeadForm.validate(),j()},this),this.dealers.on("deselect",function(){this.configLeadForm.setOption("dealers",this.dealers.getSelected())},this),this.vehicleForm.on("update-request-form",function(e){this.configLeadForm.setOption(e.name,e.value)},this),this.configLeadForm.on("readytosubmit",function(e){N.disabled=!e},this);var I=t(h);I.find(".tab-2 .email-print-icons [data-action]").click(function(){var n=t(this).data("action"),r=new e.PrintEmailTemplate,s={vehicleFullName:o.printEmailOptions.get("vehicleFullName"),vehicleStyleName:o.printEmailOptions.get("vehicleStyleName"),features:o.vehicleFeaturesController.selectedFeatures.collection,basePrice:o.printEmailOptions.get("basePrice"),totalPrice:o.printEmailOptions.get("totalPrice"),customerCashPrice:o.printEmailOptions.get("customerCashPrice")},u;switch(n){case"email":u=prompt("Please enter e-mail address:"),u&&r.sendConfiguration(i,u,s);break;case"print":s.print=!0,r.printConfiguration(s)}}),I.find(".tab-3 .email-print-icons [data-action]").click(function(){var n=t(this).data("action"),r=new e.PrintEmailTemplate,s={vehicleFullName:o.printEmailOptions.get("vehicleFullName"),vehicleStyleName:o.printEmailOptions.get("vehicleStyleName"),premierDealers:o.dealers.premierDealers.collection,allDealers:o.dealers.allDealers.collection,basePrice:o.printEmailOptions.get("basePrice"),totalPrice:o.printEmailOptions.get("totalPrice"),customerCashPrice:o.printEmailOptions.get("customerCashPrice")},u;switch(n){case"email":u=prompt("Please enter e-mail address:"),u&&r.sendPriceQuotes(i,u,s);break;case"print":s.print=!0,r.printPriceQuotes(s)}}),l.eq(0).click(function(){t(this).hasClass("disable")||(o.trigger("tab:show",this,"Configure Tab"),o.trigger("tab1.click"))}),l.eq(1).click(function(){t(this).hasClass("disable")||(o.trigger("tab:show",this,"TMV Tab"),o.trigger("tab2.click"))}),l.eq(2).click(function(){t(this).hasClass("disable")||(o.trigger("tab:show",this,"Price Quote Tab"),o.trigger("tab3.click"))}),this.bindEvents(),this.zipUpdate.disable();var R=t(h).find(".nvcwidget-tabs");return R.find(".tab1 .tab-text").html(p.tabs.tab1?p.tabs.tab1:"Configure"),R.find(".tab2 .tab-text").html(p.tabs.tab2?p.tabs.tab2:"TMV&reg;"),R.find(".tab3 .tab-text").html(p.tabs.tab3?p.tabs.tab3:"Price Quotes"),n.isString(p.tabs.tab1)&&n.isString(p.tabs.tab2)&&n.isNull(p.tabs.tab3)&&(R.addClass("tab-layout-2"),R.find(".tab3").hide(),t(T).closest(".nvcwidget-top-footer").hide()),n.isString(p.tabs.tab1)&&n.isNull(p.tabs.tab2)&&n.isString(p.tabs.tab3)&&(R.addClass("tab-layout-2"),R.find(".tab2").hide(),t(x).text("Get Price Quote")),v&&m&&E&&(this.styleConfigurator.findMakes(),this.zipUpdate.enable()),this},this.showTab=function(e){var n=e.id.split("-").pop(),r=this.getBaseId(),i=this.getBaseClass(),o,u=s(i+"-tab-inner","",f),a=u.length;for(o=0;o<a;o+=1)t(u[o]).addClass("hide");return l.removeClass("active"),t(e).addClass("active"),t("#"+r+"_"+n).removeClass("hide"),this.trigger(n+":showed"),this}},a=u.prototype;t.extend(u.prototype,e.Widget.prototype),a.bindEvents=function(){return this.off(),this.on("tab:show",this.showTab,this),this.on("tab:show",function(){this.vehicleFeaturesController.closeCategory()},this),this.on("tab1:showed",this.resizeOptionsContainer,this),this.on("tab2:showed",this.resizeTMVTab,this),this.on("tab3:showed",this.resizePriceQuotesTab,this),this.vehicleDetails.on("render",this.resizeOptionsContainer,this),this.vehiclePhotos.on("render",this.resizeOptionsContainer,this),this},a.init=function(e){return e=e||{},this.setOptions(e),this.vehiclesApi=new EDMUNDSAPI.Vehicle(this.getApiKey()),this.zip=e.zip||"",this.trigger("init"),this},a.resizeOptionsContainer=function(){try{var e=document.getElementById(this.getBaseId()+"_tab1"),t=e.children,n=t[0],r=t[1],i=t[2];r.style.height=e.offsetHeight-(n.offsetHeight+i.offsetHeight+15)+"px"}catch(s){}return this},a.resizeListOptions=function(){try{var e=document.getElementById(this.getBaseId()+"_list_options"),t=e.children,n=t[0],r=t[1],i=t[2];r&&n&&i&&e&&(r.style.maxHeight=e.offsetHeight-(n.offsetHeight+i.offsetHeight+25)+"px")}catch(s){}return this.optionsList&&this.optionsList.resize(),this},a.resizeTMVTab=function(){var e=document.getElementById(this.getBaseId()+"_tab2"),n=this.getOptions().layoutType,r=e.children,i,s,o;if(!e||r.length===0)return;try{i=r[0],o=r[1].children[0],s=r[2],o.style.height=e.offsetHeight-(i.offsetHeight+s.offsetHeight+20)+"px",r=o.children;var u=0;for(var a=0,f=r.length;a<f;a++)a!==1&&(u+=r[a].offsetHeight);r[1].style.height=o.offsetHeight-u-20+"px";if(n==="narrow"||n==="medium"){var l=t(".tab-2 .w1"),c=t(".tab-2 .w2");l.find(".nvcwidget-list-options").outerHeight(l.outerHeight()-c.outerHeight())}}catch(h){}return this.vehicleFeaturesController.selectedFeatures.resize(),this},a.resizePriceQuotesTab=function(){var e=document.getElementById(this.getBaseId()+"_tab3"),t=e.children,n,r,i,s;if(!e||t.length===0)return;try{n=t[0],i=t[1].children[0],r=t[2],s=t[3],i.style.height=e.offsetHeight-(n.offsetHeight+r.offsetHeight+s.offsetHeight+20)+"px",t=i.children;var o=0;for(var u=0,a=t.length;u<a;u++)u!==1&&(o+=t[u].offsetHeight);t[1].style.height=i.offsetHeight-o-20+"px",t[1].children[1].style.maxHeight=t[1].offsetHeight-t[1].children[0].offsetHeight+"px"}catch(f){}return this},a.render=function(){return this.htmlSetup(),this.reset(),this.trigger("render"),this},a.reset=function(){return this.styleConfigurator.reset(),this.resizeOptionsContainer(),this},a.updateZipCode=function(e){},u.template=['<div class="<%= baseClass %>-inner <%= nav %>">','<div class="<%= baseClass %>-header noise-bg">',"<div>",'<span class="title">NEW VEHICLE CONFIGURATOR</span>','<span class="question" onclick="">',"<sup>?</sup>",'<div class="nvcwidget-tooltip"><div class="arrow-left"></div><%= titleTooltip %></div>',"</span>","</div>","</div>",'<div class="<%= baseClass %>-tabs" id="<%= baseId %>_tabs">','<div class="tab tab1 active" id="<%= baseId %>-tab1"><span class="tab-text">Configure</span></div>','<div class="tab tab2 disable" id="<%= baseId %>-tab2"><span class="tab-text">TMV&reg;</span></div>','<div class="tab tab3 disable" id="<%= baseId %>-tab3"><span class="tab-text">Price Quotes</span></div>',"</div>",'<div class="<%= baseClass %>-tab-content" id="<%= baseId %>_tab_content">','<div class="<%= baseClass %>-tab-inner tab-1" id="<%= baseId %>_tab1">','<div class="noise-bg"><div class="bottom-shadow clearfix">','<% if (layoutType === "narrow") { %>','<div class="<%= baseClass %>-filters">','<div class="filters" id="<%= baseId %>_filters"></div>','<div class="zip-code" id="<%= baseId %>_zip_configure"></div>',"</div>",'<div class="<%= baseClass %>-image" id="<%= baseId %>_vehicle_details"></div>',"<% } else { %>",'<div class="<%= baseClass %>-image" id="<%= baseId %>_vehicle_details"></div>','<div class="<%= baseClass %>-filters">','<div class="filters" id="<%= baseId %>_filters"></div>','<div class="zip-code" id="<%= baseId %>_zip_configure"></div>',"</div>","<% } %>","</div></div>",'<div class="<%= baseClass %>-options-outer">','<div class="get-started">',"<h1>Get Started</h1>","<p>Select <strong>Make</strong>, <strong>Model</strong>, <strong>Year</strong> and <strong>Style</strong> to get full list of available options</p>",'<div class="arrow"></div>',"</div>",'<div class="<%= baseClass %>-options" id="<%= baseId %>_options"></div>','<div class="category-features-list" id="<%= baseId %>_category_features_list"></div>',"</div>",'<div class="<%= baseClass %>-nav-bottom">','<button type="button" disabled="disabled" id="<%= baseId %>_button" class="button-block">Get Price</button>',"</div>","</div>",'<div class="<%= baseClass %>-tab-inner tab-2 hide" id="<%= baseId %>_tab2">','<div class="<%= baseClass %>-inner-header">','<div class="<%= baseClass %>-image" id="<%= baseId %>_vehicle_details3"></div>',"</div>",'<div class="shadow-top noise-bg">','<div class="<%= baseClass %>-body">','<div class="<%= baseClass %>-inner-zip zip-location" id="<%= baseId %>_zip_location"></div>','<div class="w1">','<% if (layoutType === "narrow" || layoutType === "medium") { %>','<div class="<%= baseClass %>-list-options" id=<%= baseId %>_list_options></div>','<div class="w2">','<div class="<%= baseClass %>-price" id="<%= baseId %>_price"></div>','<div class="incentives"></div>',"</div>","<% } else { %>",'<div class="w2">','<div class="<%= baseClass %>-price" id="<%= baseId %>_price"></div>','<div class="incentives"></div>',"</div>",'<div class="<%= baseClass %>-list-options" id=<%= baseId %>_list_options></div>',"<% } %>","</div>",'<ul class="email-print-icons">','<li data-action="email"><i class="icon-email"></i>e-mail</li>','<li data-action="print"><i class="icon-print"></i>print</li>',"</ul>","</div>","</div>",'<div class="<%= baseClass %>-top-footer"><button type="button" id="<%= baseId %>_button2">GET PRICE QUOTE</button><span>Next Step</span></div>',"</div>",'<div class="<%= baseClass %>-tab-inner tab-3 hide" id="<%= baseId %>_tab3">','<div class="<%= baseClass %>-inner-header">','<% if (layoutType === "narrow") { %>','<div class="<%= baseClass %>-image" id="<%= baseId %>_vehicle_details2"></div>','<div class="tmvprice" id="<%= baseId %>_tmvprice"></div>',"<% } else { %>",'<div class="tmvprice" id="<%= baseId %>_tmvprice"></div>','<div class="<%= baseClass %>-image" id="<%= baseId %>_vehicle_details2"></div>',"<% } %>","</div>",'<div class="shadow-top noise-bg">','<div class="<%= baseClass %>-body">','<div class="<%= baseClass %>-inner-zip" id="<%= baseId %>_zip_mi"></div>','<div class="<%= baseClass %>-list-dealer">','<div class="tab-bar">','<ul class="navbar">','<li class="tab tab-premier active" data-tab-id="premier"><div><div><span>Premier Dealers</span></div></div></li>','<li class="tab" data-tab-id="all"><div><div><span>All Dealers</span></div></div></li>',"</ul>",'<div class="tab-strip"></div>',"</div>",'<div class="tab-content">','<div class="tab-panel tab-panel-premier active"></div>','<div class="tab-panel tab-panel-all"></div>',"</div>","</div>",'<ul class="email-print-icons">','<li data-action="email"><i class="icon-email"></i>e-mail</li>','<li data-action="print"><i class="icon-print"></i>print</li>',"</ul>","</div>","</div>",'<div class="<%= baseClass %>-top-footer" id="<%= baseId %>_form">',"</div>",'<div class="<%= baseClass %>-nav-bottom">','<div class="<%= baseClass %>-nav-bottom-inner">','<div class="button-wrapper">','<button type="button" disabled class="button-green" id="<%= baseId %>_button3">GET DEALER QUOTE</button>',"</div>","</div>","</div>","</div>","</div>",'<div class="<%= baseClass %>-footer">','<a href="http://developer.edmunds.com/tmv_widget_terms" class="copy" target="_blank">Legal Notice</a>','<div class="logo">Built by<a href="http://www.edmunds.com/" target="_blank"></a></div>',"</div>","</div>"].join(""),u.TOOLTIP_TITLE="The New Vehicle Configurator is a tool that helps you customize a new vehicle, see what others in your area are paying for it on average, and get a FREE price quote from a dealership near you.",u.TOOLTIP_TMV="The Edmunds.com TMV® (Edmunds.com True Market Value®) price is the average price that others have paid for this car in the zip code provided.",u.TOOLTIP_INVOICE="This is the price the dealer paid for this car, including destination charges.",u.TOOLTIP_MSRP="This is the price the manufacturer recommends selling the car for. Most consumers end up purchasing their car for less than MSRP.",u.TOOLTIP_TRADEIN="This is the amount you can expect to receive when you trade in your used car and purchase a new car. The trade-in price is usually credited as a down payment on the new car.",u.TOOLTIP_PRIVATEPARTY="This is the amount at which the car is sold to or purchased by a private party, not a car dealer. This amount is usually more than the trade-in price but less than the dealer retail price.",u.TOOLTIP_TMVRETAIL="This is the average price that others have paid for this car in the zip code provided. Dealer retail will usually be higher than private party prices and much higher than trade-in prices.",u.TOOLTIP_CUSTOMERCASH="Rebates provided by the manufacturer directly to the customer at the time the vehicle is purchased to lower the final price of the vehicle. Consumers usually may elect to either receive this amount in cash or to credit the rebate as part of the vehicle's down payment.",e.namespace("util").ClientKeyGenerator=function(){function t(t,n){return e.floor(e.random()*(n-t+1)+t)}function n(e,n){var r=[],i=0,s;for(;i<e;i++)s=t(0,n-1),r[i]=s.toString(n);return r}function r(e,t){var r=n(e,t),i=0,s=0,o=1,u=2,a;while(u<e)i+=parseInt(r[o],t)^++s,a=o,o=u,u=a+o;return r[o]=(i%t).toString(t),r.join("")}var e=Math;return{generate:r}}(),e.PrintEmailTemplate=function(e){function c(){r=document.createElement("iframe"),r.style.display="none",n.appendChild(r),i=r.contentWindow,s=r.contentDocument||i.document}function h(e){s&&(s.open(),s.write(e),s.close())}function p(){n.removeChild(r),r=i=s=undefined}var n=document.body,r,i,s,o="http://api.edmunds.com/api/emp/esp/sendEmail",u="api@edmunds.com",a="Edmunds.com",f="api@edmunds.com",l="Your New Vehicle Configuration Details";this.printConfiguration=function(e){var t=this.getConfigurationHTML(e);c(),h(t),i.print(),p()},this.printPriceQuotes=function(e){var t=this.getPriceQuotesHTML(e);c(),h(t),i.print(),p()},this.sendConfiguration=function(e,n,r){t.ajax({url:o,type:"POST",data:{api_key:e,fromAddress:u,fromNiceName:a,toAddress:n,replyToAddress:f,emailSubject:l,emailBody:this.getConfigurationBodyHTML(r)}})},this.sendPriceQuotes=function(e,n,r){t.ajax({url:o,type:"POST",data:{api_key:e,fromAddress:u,fromNiceName:a,toAddress:n,replyToAddress:f,emailSubject:l,emailBody:this.getPriceQuotesBodyHTML(r)}})}},e.PrintEmailTemplate.prototype={getLogoSection:function(e){var t="data:image/png;base64,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",n="http://static.ed.edmunds-media.com/unversioned/img/logo.png",r=e?t:n;return'<img src="'+r+'" alt="Edmunds.com" height="36" width="109" />'},getDescriptionSection:function(e,t){return['<div class="vehicle-description">','<div class="name">'+e+"</div>","<div>"+t+"</div>","</div>"].join("")},getPricesSection:function(e){return["<h2>New Car Prices</h2>",'<div class="prices">','<div class="note">* Price as configured</div>',e.baseMSRP?"<div>MSRP: "+n.currency(e.baseMSRP)+"</div>":"",e.baseInvoice?"<div>Invoice: "+n.currency(e.baseInvoice)+"</div>":"",e.tmv?"<div><b>True Market Value<sup>&reg</sup>: "+n.currency(e.tmv)+"</b></div>":"","</div>"].join("")},getIncentivesSection:function(e){return e>0?["<h2>Incentives</h2>",'<div class="incentives">Customer Cash: '+n.currency(e)+"</div>"].join(""):""},getFeaturesSection:function(e,t){var r=["<h2>Your selected options</h2>",'<table class="table-features">',"<thead>","<tr>","<th>Description</th>",'<th class="price">MSRP</th>',"</tr>","<tr>","<th>Base Price</th>",'<th class="price">'+n.currency(t.baseMSRP)+"</th>","</tr>","</thead>","<tbody>"].join("");return e&&e.each(function(e){var t=e.get("price").baseMSRP;if(n.isNull(t))return;r+=["<tr>","<td>"+e.get("name")+"</td>",'<td class="price">'+(e.isIncluded()?"included":n.currency(t))+"</td>","</tr>"].join("")}),r+=["</tbody>","<tfoot>","<tr>","<th>Total Price</th>",'<th class="price">'+n.currency(t.baseMSRP+(e?e.getTotalPrice().baseMSRP:0))+"</th>","</tr>","</tfoot>","</table>"].join(""),r},getDealersSection:function(e,t){return['<table class="table-dealers">',"<thead>","<tr>",'<th class="col">Premier Dealers</th>','<th class="space"></th>','<th class="col">All Dealers</th>',"</tr>","</thead>","<tbody>","<tr>",'<td class="col">'+this.getDealersList(e)+"</td>",'<td class="space"></td>','<td class="col">'+this.getDealersList(t)+"</td>","</tr>","</tbody>","</table>"].join("")},getDealersList:function(e){var t="";return e&&(t+="<table><tbody>",e.each(function(e){t+=["<tr>","<td>",'<div class="name"><b>'+(e.get("name")||"&nbsp;")+"</b></div>",'<div class="distance">'+(e.getDistance()||"&nbsp;")+" mi away</div>",'<div class="address">'+(e.getAddress()||"&nbsp;")+"</div>",'<div class="phone"><b>'+(e.getPhone()||"&nbsp;")+"</b></div>","</td>","</tr>"].join("")}),t+="</tbody></table>"),t},getFooterSection:function(){return'<div class="footer">&copy; Edmunds Inc. All rights Reserved. This information was extracted from www.edmunds.com and is subject to the terms of the Visitor Agreement at http://www.edmunds.com/about/visitor-agreement.html</div>'},getCommonStyles:function(){return["<style>","body{font-family:Arial,sans-serif;font-size:12px;line-height:1.5}","h2{font-size:14px;margin:15px 0 5px}",".container{padding-top:10px;width:700px}",".vehicle-description{border-bottom:1px solid #ddd;font-size:14px;padding:15px 0}",".vehicle-description .name{font-weight:700}",".prices{border:1px solid #000;font-size:18px;list-style:none;margin:0;padding:10px 20px}",".prices .note{font-size:12px;line-height:1;margin-top:-5px;text-align:right}",".incentives{border:1px solid #000;font-size:18px;padding:10px 20px}",".footer{border-top:1px solid #ddd;color:#555;font-size:11px;margin-top:30px;padding:15px 0}","</style>"].join("")},getConfigurationStyles:function(){return["<style>",".table-features{border:0;border-collapse:collapse}",".table-features th{text-align:left}",".table-features th,.table-features td{padding:7px 0}",".table-features .price{padding-left:75px;text-align:right}","</style>"].join("")},getPriceQuotesStyles:function(){return["<style>",".table-dealers{border:0;border-collapse:collapse;margin-top:20px;width:100%}",".table-dealers th{text-align:left}",".table-dealers .space{width:10%}",".table-dealers .col{width:45%}",".table-dealers table{border:1px solid black;border-collapse:collapse;width:100%}",".table-dealers table, .table-dealers table td{border:1px solid black}",".table-dealers table td{padding:10px 15px}","</style>"].join("")},getConfigurationBodyHTML:function(e){return[this.getCommonStyles(),this.getConfigurationStyles(),'<table style="border:0;border-collapse:collapse;width:700px"><tbody><tr><td>',this.getLogoSection(e.print),this.getDescriptionSection(e.vehicleFullName,e.vehicleStyleName),this.getPricesSection(e.totalPrice),this.getIncentivesSection(e.customerCashPrice),this.getFeaturesSection(e.features,e.basePrice),this.getFooterSection(),"</td></tr></tbody></table>"].join("")},getPriceQuotesBodyHTML:function(e){return[this.getCommonStyles(),this.getPriceQuotesStyles(),'<table style="border:0;border-collapse:collapse;width:700px"><tbody><tr><td>',this.getLogoSection(e.print),this.getDescriptionSection(e.vehicleFullName,e.vehicleStyleName),this.getPricesSection(e.totalPrice),this.getIncentivesSection(e.customerCashPrice),this.getDealersSection(e.premierDealers,e.allDealers),this.getFooterSection(),"</td></tr></tbody></table>"].join("")},getConfigurationHTML:function(e){return['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">','<html xmlns="http://www.w3.org/1999/xhtml">',"<head>",'<meta http-equiv="Content-Type" content="text/html; charset=utf-8">',"<title>Configuration</title>","</head>","<body>",this.getConfigurationBodyHTML(e),"</body>","</html>"].join("")},getPriceQuotesHTML:function(e){return['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">','<html xmlns="http://www.w3.org/1999/xhtml">',"<head>",'<meta http-equiv="Content-Type" content="text/html; charset=utf-8">',"<title>Price Quotes</title>","</head>","<body>",this.getPriceQuotesBodyHTML(e),"</body>","</html>"].join("")}},e.namespace("ui").Validator=function(){function C(){}var n=/^(.+?)\[(.+)\]$/,r=/^a+|a+$/g,i=/^[0-9]+$/,s=/[0-9]/,o=/^[0-1]/,u=/^(.)\1{6}$/,a=/^[0-9]+$/,f=/^\-?[0-9]*\.?[0-9]+$/,l=/^([0-9a-zA-Z]([\-.\w]*[0-9a-zA-Z])*@([0-9a-zA-Z][\-\w]*[0-9a-zA-Z]\.)+[a-zA-Z]{2,9})$/,c=/^[A-Za-z0-9](([_\.\-]?[a-zA-Z0-9]+)*)@([A-Za-z0-9]+)(([\.\-]?[a-zA-Z0-9]+)*)\.([A-Za-z]{2,3})$/,h=/[\*\^<>\\\"\.\;\:\[\]\(\)\{\}\!\@\_]/,p=/^[a-z]+([\-][a-z]+)*?$/i,d=/^[a-z0-9]+$/i,v=/^[a-z0-9_\-]+$/i,m=/^[0-9]+$/i,g=/^[1-9][0-9]*$/i,y=/^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})$/i,b=/[^a-zA-Z0-9\/\+=]/i,w=/^[\d\-\s]+$/,E=/^((http|https):\/\/(\w+:{0,1}\w*@)?(\S+)|)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,S=/(.)\1{2}/i,x=/[bcdfghjklmnpqrstvwxz]{6}/i,T=/^(ng|([a-z\-]*?[a|e|i|o|u|y][a-z\-]*?))$/i,N=e.util.Array.contains;return C.prototype={required:function(e){var n=t.trim(e.value);return n!==null&&n!==""},nameLength:function(e){var n=t.trim(e.value);return n.length>=2},alpha:function(e){var n=t.trim(e.value);return p.test(n)},noSpecialCharacters:function(e){return!h.test(e.value)},noNumeric:function(e){return!s.test(e.value)},decimal:function(e){return f.test(e.value)||!e.value.length},excludeCode:function(e){var t=[222,333,411,444,456,500,555,666,777,911,900,999],n=e.value;return n=parseInt(n,10),!N(t,n)&&e.value!=="000"},excludePrefix:function(e){var t=[411,555,611,911],n=e.value;return n=parseInt(n,10),!N(t,n)},minLength:function(e){var n=t.trim(e.value),r=e.maxLength;return n.length===r},email:function(e){var n=t.trim(e.value);return l.test(n)},emailDomain:function(e){var n=t.trim(e.value);return c.test(n)},maxValue:function(e){return e.value<=100},integer:function(e){return a.test(t.trim(e.value))},noRepeatSame:function(e){var n=t.trim(e.value);return!S.test(n)},noRepeatConsanant:function(e){return!x.test(e.value)},containsVowel:function(e){var n=t.trim(e.value);return T.test(n)},firstDigit:function(e){return!o.test(t.trim(e.value))},phone:function(e){var n=t.trim(t('[name="phonePrefix"]').val()),r=t.trim(t('[name="phoneSuffix"]').val());if(n.length===3&&r.length===4){var i=n+r;return!u.test(i)}return!0}},C}(),e.namespace("ui").Tooltip=function(){var t=e.ui.View;return t.extend({className:"edm-tooltip",initialize:function(e){this.render(e.text)},render:function(e){var t=document.createElement("div"),n=document.createElement("span");n.innerHTML=e||"",t.className="arrow-left",this.el.appendChild(t),this.el.appendChild(n)},setText:function(e){this.el.getElementsByTagName("span")[0].innerHTML=e},show:function(){this.el.style.display="block"},hide:function(){this.el.style.display="none"}})}(),e.namespace("ui").Button=function(){var t=e.ui.View;return t.extend({tagName:"button",events:{click:"onClick"},onClick:function(){this.trigger("click")},setText:function(e){return this.el.innerHTML=e,this},disable:function(){return this.el.setAttribute("disabled","disabled"),this},enable:function(){return this.el.removeAttribute("disabled"),this}})}(),e.namespace("ui").TextField=function(){var t=e.ui.View,n=e.ui.Tooltip,r=e.api.Region,i=e.event.KeyCode,o=e.util.Array.contains,u=e.dom.Element,a=new e.ui.Validator;return t.extend({tagName:"input",className:"",attributes:{type:"text"},events:{focus:"hideLabel",blur:"showLabel",change:"validate",keyup:"validate"},initialize:function(e){e.validators&&(this.validators=e.validators)},render:function(e){var t=this.el,n,r,i;return n=document.createElement("label"),n.className=t.name,r=document.createElement("span"),r.className="text-label",r.innerHTML=t.alt,e.appendChild(n),n.appendChild(r),t.maxLength>4&&(i=document.createElement("span"),i.innerHTML="*",r.innerHTML=t.title,r.appendChild(i)),n.appendChild(t),this.renderTooltip(),this},renderTooltip:function(){var e=this.tooltip=new n({className:"nvcwidget-tooltip",text:""});return this.el.parentNode&&this.el.parentNode.insertBefore(this.tooltip.el,this.el.nextSibling),e.hide(),this.on("valid",e.hide,e),this.on("error",e.show,e),this},showLabel:function(){var e=this.el;!e.value&&s("text-label","",e.parentNode)[0]&&(s("text-label","",e.parentNode)[0].style.display="block"),this.tooltip.hide()},hideLabel:function(){s("text-label","",this.el.parentNode)[0]&&(s("text-label","",this.el.parentNode)[0].style.display="none")},reset:function(){var e=new u(this.el.parentNode);e.removeClass("invalid"),this.el.value="",this.showLabel()},validate:function(){var e=this.validators,t,n=this.el,r=new u(n.parentNode),i;this.trigger("focus");for(t in e){i=a[t](n);if(!i){this.tooltip.setText(e[t].message.replace("%s",n.title)),r.addClass("invalid"),this.trigger("error"),this.trigger("change",{isValid:i,fieldName:n.name,fieldValue:n.value});return}r.removeClass("invalid"),this.trigger("valid")}this.trigger("change",{isValid:i,fieldName:n.name,fieldValue:n.value})},validateField:function(){var e=this.validators,t,n=this.el,r=new u(n.parentNode),i;for(t in e){i=a[t](n);if(!i)return r.addClass("invalid"),{isValid:i,fieldName:n.name,fieldValue:n.value};r.removeClass("invalid")}return{isValid:i,fieldName:n.name,fieldValue:n.value}}})}(),e.namespace("ui").PhoneFieldGroup=function(){var t=e.ui.View,n=e.ui.Tooltip,r=e.ui.TextField,i=e.api.Region,s=e.event.KeyCode,o=new e.ui.Validator;return t.extend({initialize:function(e){var t=this.phoneCode=new r({className:"code-field",attributes:{type:"text",name:"phoneCode",title:"Area Code",alt:"999",maxLength:3,required:"required"},validators:{required:{message:"The %s field is required"},integer:{message:"%s must contain digits only"},firstDigit:{message:"%s must not begin with 0 or 1"},excludeCode:{message:"Must not be 000, 222, 333, 411, 444, 456, 500, 555, 666, 777, 911, 900, or 999"},decimal:{message:"%s must contain 3 digits"},minLength:{message:"%s must contain 3 digits"}}}),n=this.phonePrefix=new r({className:"prefix-field",attributes:{type:"text",name:"phonePrefix",title:"Prefix",alt:"999",maxLength:3,required:"required"},validators:{required:{message:"The %s field is required"},integer:{message:"%s must contain digits only"},firstDigit:{message:"%s must not begin with 0 or 1"},excludePrefix:{message:"Must not be 411, 555, 611 or 911"},phone:{message:"Phone number is invalid"},decimal:{message:"%s must contain 3 digits"},minLength:{message:"%s must contain 3 digits"}}}),i=this.phoneSuffix=new r({className:"suffix-field",attributes:{type:"text",name:"phoneSuffix",title:"Suffix",alt:"9999",maxLength:4,required:"required"},validators:{required:{message:"The %s field is required"},integer:{message:"%s must contain digits only"},phone:{message:"Phone number is invalid"},decimal:{message:"%s must contain 4 digits"},minLength:{message:"%s must contain 4 digits"}}});this.fields=[t,n,i]},bindEvents:function(){this.phoneCode.on("change",this.validate,this),this.phonePrefix.on("change",this.validate,this),this.phoneSuffix.on("change",this.validate,this)},render:function(e){var t=this.fields,n=t.length;for(var r=0;r<n;r+=1)t[r].render(e);return this.bindEvents(),this},reset:function(){var e=this.fields,t=e.length,n=0;for(n=0;n<t;n+=1)e[n].reset()},validate:function(){var e=this.fields,t=e.length,n=0,r;for(n=0;n<t;n+=1)r=e[n].validateField(),this.trigger("change",r)},changeAvailable:function(e){var t=this.fields,n;for(n in t)t.hasOwnProperty(n)&&(t[n].el.disabled=e?!1:!0)}})}(),e.namespace("ui").VehicleForm=function(){var n=e.ui.View,r=e.ui.Tooltip,i=e.ui.TextField,s=e.ui.PhoneFieldGroup,o=e.api.Region,u=e.event.KeyCode,a=e.template,f=e.util.Array.contains,l=new e.ui.Validator;return n.extend({initialize:function(e){var t=this.firstname=new i({attributes:{type:"text",name:"firstname",title:"First Name",required:"required",maxlength:50},validators:{required:{message:"The %s field is required"},nameLength:{message:"Must contain at least 2 characters"},noNumeric:{message:"The %s field cannot contain numbers"},noSpecialCharacters:{message:'Must not contain any special characters such as * ^ < > \\ " . ; : [ ] ( ) { } ! @ _'},alpha:{message:"The %s field is invalid"},noRepeatSame:{message:"Must not contain 3 of the same letter concurrently"},noRepeatConsanant:{message:"Must not contain 6 consecutive consonants"},containsVowel:{message:"Must contain a vowel"}}}),n=this.lastname=new i({attributes:{type:"text",name:"lastname",title:"Last Name",required:"required",maxlength:50},validators:{required:{message:"The %s field is required"},nameLength:{message:"Must contain at least 2 characters"},noNumeric:{message:"The %s field cannot contain numbers"},noSpecialCharacters:{message:'Must not contain any special characters such as * ^ < > \\ " . ; : [ ] ( ) { } ! @ _'},alpha:{message:"The %s field is invalid"},noRepeatSame:{message:"Must not contain 3 of the same letter concurrently"},noRepeatConsanant:{message:"Must not contain 6 consecutive consonants"},containsVowel:{message:"Must contain a vowel"}}}),r=this.email=new i({attributes:{type:"text",name:"email",title:"E-mail",required:"required",maxlength:50},validators:{required:{message:"The %s field is required"},email:{message:"The %s field is invalid"},emailDomain:{message:"The %s field is invalid"}}}),o=this.phoneGroup=new s;this.fields=[t,n,r,o],this.template=a(this.template)},bindEvents:function(){this.firstname.on("change",this.validate,this),this.lastname.on("change",this.validate,this),this.email.on("change",this.validate,this),this.phoneGroup.on("change",this.validate,this)},resetValues:function(){var e=this.fields,t=e.length,n=0;for(n=0;n<t;n+=1)e[n].reset()},render:function(e){var n=this.fields,r=n.length,i,s,o;this.root=e,e&&(e.innerHTML=this.template({})),i=t(e).find(".form");for(s=0;s<r;s+=1)o=t('<div class="form-field"><div class="form-field-inner"></div></div>'),t(i).append(o),n[s].render(o.find(".form-field-inner")[0]);return this.bindEvents(),this},reset:function(){return this.root.innerHTML="",this},validate:function(e){this.trigger("update-request-form",{name:e.fieldName,value:e.isValid?t.trim(e.fieldValue):""})},changeAvailable:function(e){var t=this.fields,n;for(n in t)t.hasOwnProperty(n)&&(t[n].hasOwnProperty("fields")?t[n].changeAvailable(e):t[n].el.disabled=e?!1:!0)},template:'<div class="rule"><b>2.</b> Request free price quote by using the form below and find the best deals</div><div class="form"></div>'})}(),e.namespace("nvc").ConfigLeadForm=function(){function u(e){t.call(this),this.apiKey=e,this.initialize(e),this.bindEvents()}var t=e.mixin.Observable,r=e.util.Array,i=r.isArray,s=r.contains,o=e.util.Function.bind;return u.prototype={initialize:function(e){this.config={apiKey:e,make:"",model:"",year:"",styleid:"",zip:"",options:[],price:{},radius:100,dealers:[],firstname:"",lastname:"",email:"",phoneCode:"",phonePrefix:"",phoneSuffix:""}},setOption:function(e,t){return this.config[e]=t,this.trigger("change"),this},bindEvents:function(){this.on("change",this.validate,this)},validate:function(){var e=!1;return this.config.dealers.length&&this.config.firstname.length&&this.config.lastname.length&&this.config.email.length&&this.config.phoneCode.length&&this.config.phonePrefix.length&&this.config.phoneSuffix.length&&(e=!0),this.trigger("readytosubmit",e),e},reset:function(e){var t=n.clone(this.config);this.config={apiKey:this.apiKey,make:"",model:"",year:"",styleid:"",zip:e.zip?t.zip:"",options:[],price:{},radius:100,dealers:[],firstname:"",lastname:"",email:"",phoneCode:"",phonePrefix:"",phoneSuffix:""}}},u}(),e.namespace("nvc").VehicleDetails=function(){var t=e.ui.View,n=e.template;return t.extend({className:"vehicle-description",render:function(e,t){return this.el.innerHTML=n(this.template,{details:e,showPrice:t,msrpTooltip:u.TOOLTIP_MSRP}),this.trigger("render"),this},reset:function(){return this.el.innerHTML='<span class="default-price">Base MSRP:&nbsp;---</span>',this},template:['<div class="name"><%= details.name %></div>','<div class="desc"><%= details.description %></div>',"<% if(showPrice) { %>",'<div class="price">',"Base MSRP:<sup>$</sup>",'<span class="value" onclick="">',"<%= _.formatNumber(details.price) %>",'<div class="nvcwidget-tooltip"><div class="arrow-left"></div><%= msrpTooltip %></div>',"</span>","</div>","<% } %>"].join("")})}(),e.namespace("nvc").VehiclePhotos=function(){var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAAWdEVYdENyZWF0aW9uIFRpbWUAMDkvMTIvMTOcPiNzAAAADUlEQVQImWP4//8/AwAI/AL+hc2rNAAAAABJRU5ErkJggg==";return r.View.extend({className:"vehicle-photos",template:'<div class="image"><img src="" alt=""></div><div class="image"><img src="" alt=""></div>',initialize:function(t){this.vehicleApi=new e.api.Vehicle(t.vehicleApiKey),this.$el.addClass(t.colorScheme)},render:function(){return this.$el.html(this.template),this.reset(),this},reset:function(){return this.$("img").attr("src",t),this},loadPhotos:function(e){var t=n.bind(this.onPhotosLoad,this);this.vehicleApi.getPhotosByStyleId(e,t)},onPhotosLoad:function(e){var r="http://media.ed.edmunds-media.com",i=[],s=this.$("img");i.push(n.findWhere(e,{subType:"exterior",shotTypeAbbreviation:"FQ"})),i.push(n.findWhere(e,{subType:"exterior",shotTypeAbbreviation:"RQ"})),i=n.map(i,function(e){return r+(e&&e.id||t).replace("dam/photo","")+"_500.jpg"}),s.eq(0).attr("src",i[0]),s.eq(1).attr("src",i[1])}})}(),e.namespace("nvc").VehiclePrice=function(){function l(e){this.initialize(e),this.bindEvents()}var t=e.mixin.Observable,o=EDMUNDSAPI.Vehicle,a=e.util.Function.bind,f=e.template;return n.extend(l.prototype,r.Events,{initialize:function(e){this.options=e,this.el=e.el,this.template=f(this.template),this.vehicleApi=new o(e.vehicleApiKey)},bindEvents:function(){},render:function(e){var t=e,n=/(?=(?:\d{3})+(?:\.|$))/g,r,i;return this.totalPrice=e,t.tmv>t.invoice&&t.tmv<=t.msrp?(r=(t.tmv-t.invoice)*100/(t.msrp-t.invoice),i=0):t.tmv<t.invoice?(r=0,i=(t.invoice-t.tmv)*100/(t.msrp-t.tmv)):t.tmv>t.msrp?(r=100,i=0):(r=0,i=0),this.graphDash=i,t={tmv:t.tmv?t.tmv.toString().split(n).join(","):"N/A",invoice:t.invoice?t.invoice.toString().split(n).join(","):"N/A",msrp:t.msrp?t.msrp.toString().split(n).join(","):"N/A",width:r,leftDash:i,tmvTooltip:u.TOOLTIP_TMV,msrpTooltip:u.TOOLTIP_MSRP,invoiceTooltip:u.TOOLTIP_INVOICE},this.el.innerHTML=this.template({totalPrice:t}),this.updateGraph(),this.trigger("render"),this},updateGraph:function(){try{var e=s("bottom","",this.el)[0],t=i?e.childNodes[1]:s("left","",e)[0],n=i?e.childNodes[0]:s("right","",e)[0],r=s("value","",t)[0].offsetWidth,o=s("value","",n)[0].offsetWidth,u=e.offsetWidth,a=this.graphDash,f=10,l;a>0&&(l=(r+o+f)*100/u,l>100-a&&!i&&(t.style.marginLeft=100-l+"%"))}catch(c){}},loadPrice:function(e,t,r){var i=n.bind(this.onPriceLoadSuccess,this),s=n.bind(this.onPriceLoadError,this),o="optionid="+r.join("&optionid=")+"&";return this.vehicleApi.getOptionsList(o,t,e,i,s),this},onPriceLoadSuccess:function(e){if(e.error||e.hasOwnProperty("errorType"))return this.onPriceLoadError();var t={invoice:e.tmv.totalWithOptions.baseInvoice,tmv:e.tmv.totalWithOptions.tmv,msrp:e.tmv.totalWithOptions.baseMSRP};this.trigger("load",t,e)},onPriceLoadError:function(){this.trigger("loaderror")},reset:function(){this.el.innerHTML=""},template:["<div>","<div>",'<div class="nvcwidget-price-graph">','<div class="top" style="width: <%= totalPrice.width %>%;">','<div class="top-inner">','<span class="name">True Market Value&reg;</span>','<span class="value" onclick=""><sup>$</sup><%= totalPrice.tmv %><div class="nvcwidget-tooltip"><div class="arrow-left"></div><%= totalPrice.tmvTooltip %></div></span>',"</div>","</div>",'<div class="graph">','<div class="left" style="width: <%= totalPrice.width %>%;">','<div class="middle"></div>',"</div>",'<div class="dash" style="left: <%= totalPrice.leftDash %>%;"></div>','<div class="dash rights"></div>','<div class="right"></div>',"</div>",'<div class="bottom">','<div class="right">','<span class="name">MSRP</span>','<span class="value" onclick=""><sup>$</sup><%= totalPrice.msrp %><div class="nvcwidget-tooltip"><div class="arrow-left"></div><%= totalPrice.msrpTooltip %></div></span>',"</div>",'<div class="left" style="margin-left: <%= totalPrice.leftDash %>%;">','<span class="name">Invoice</span>','<span class="value" onclick=""><sup>$</sup><%= totalPrice.invoice %><div class="nvcwidget-tooltip"><div class="arrow-left"></div><%= totalPrice.invoiceTooltip %></div></span>',"</div>","</div>","</div>","</div>","</div>"].join("")}),l}(),e.namespace("nvc").MessageDialog=function(){function r(){t.call(this),this.el=document.createElement("div"),this.el.className="nvcwidget-overlay",this.template=n(this.template)}var t=e.mixin.Observable,n=e.template;return r.prototype={render:function(e){return e=e||{},e.text||(e.text=["<p>Something went wrong when sending your form!</p>",'<p>Please return to the form and try again or <a href="Mailto:api@edmunds.com">contact</a> us directly.</p>'].join("")),this.el.innerHTML='<div class="overlay-bg"></div>',this.isSuccess=e.isSuccess,this.message=document.createElement("div"),this.message.className="nvcwidget-message",this.message.innerHTML=this.template({options:e}),this.message.className+=e.isSuccess?" success-message":" failure-message",this.el.appendChild(this.message),this},setMargin:function(){var e=this.message.offsetHeight;this.message.style.marginTop=-e/2+"px"},init:function(){var e=this.el.getElementsByTagName("button")[0];this.setMargin(),e.onclick=function(e){return function(){e.isSuccess===!0&&e.trigger("reset"),e.el.parentNode.removeChild(e.el)}}(this)},template:["<% if (options.isSuccess === true) { %>",'<div class="message-header">Thank you!</div>','<div class="message-body">',"<p>We have sent your request for a price quote on the</p>",'<p class="name"><%= options.name%></p>',"<p>to the following dealer(s)</p>","<ul>","<% for (var i = 0, length = options.dealers.length; i < length; i++) { %>","<li>-&nbsp;<%= options.dealers[i] %></li>","<% } %>","</ul>","</div>",'<div class="message-bottom">','<button type="reset" id="continue_button">Configure another vehicle</button>',"</div>","<% } else { %>",'<div class="message-header">Oh no...</div>','<div class="message-body">',"<%= options.text %>","</div>",'<div class="message-bottom">','<button type="button">Return and try again</button>',"</div>","<% } %>"].join("")},r}(),e.namespace("view").Tooltip=r.View.extend({className:"edm-tooltip",template:'<div class="arrow arrow-left"></div><span></span>',render:function(){return this.$el.html(this.template),this.options.text&&this.setText(this.options.text),this[this.options.show?"show":"hide"](),this},setText:function(e){return this.$("span").text(e),this},show:function(){return this.$el.show(),this},hide:function(){return this.$el.hide(),this}}),e.namespace("view.form").Button=r.View.extend({tagName:"button",events:{click:"onClick"},render:function(){return this.$el.text(this.options.text),this},onClick:function(){this.trigger("click")},disable:function(){return this.$el.prop("disabled",!0),this},enable:function(){return this.$el.prop("disabled",!1),this}}),e.namespace("view.form").ZipField=r.View.extend({tagName:"input",className:"edm-form-zipfield zip-field",attributes:{type:"text",title:"ZIP Code",maxlength:5},events:{change:"validate",blur:"setCurrentValue",keyup:"validate",keypress:"onKeyPress"},initialize:function(t){this.currentZipCode=t.zipCode,this.regionApi=new e.api.Region(t.vehicleApiKey),this.tooltip=new e.view.Tooltip({className:"nvcwidget-tooltip",text:"Please enter a valid Zip Code"}),this.on("valid",this.onValid,this),this.on("invalid",this.onInvalid,this),this.on("change",this.validate,this)},render:function(){return this.$el.val(this.currentZipCode),this.$el.before(this.tooltip.render().el),this},enable:function(){return this.$el.prop("disabled",!1),this},disable:function(){return this.$el.prop("disabled",!0),this},onKeyPress:function(t){var r=t.which,i=e.event.KeyCode,s=[i.BACKSPACE,i.DELETE,i.TAB,i.ENTER,i.ARROW_LEFT,i.ARROW_UP,i.ARROW_RIGHT,i.ARROW_DOWN];if(t.shiftKey||t.altKey||t.ctrlKey||t.metaKey)return;if(String.fromCharCode(r).match(/\d/))return;if((!t.which||!t.charCode)&&t.keyCode&&n.contains(s,t.keyCode))return;return t.preventDefault(),!1},validate:function(){var e=this.$el.val(),t=/\d{5}/,r=n.bind(this.onZipLoadSuccess,this),i=n.bind(this.onZipLoadError,this);return this.pending?this:this.currentZipCode===e?this.trigger("valid",e):t.test(e)?(this.pending=!0,this.regionApi.getValidZip(e,r,i),this):this.trigger("invalid",e)},setCurrentValue:function(){return this.$el.val(this.currentZipCode),this.validate()},onValid:function(e){this.currentZipCode=e,this.tooltip.hide()},onInvalid:function(){this.tooltip.show()},onZipLoadSuccess:function(e){var t=this.$el.val();return this.pending=!1,e[t]&&e[t]==="true"?this.trigger("valid",t):this.trigger("invalid",t)},onZipLoadError:function(){return this.pending=!1,this.trigger("invalid",this.$el.val())},updateZipCode:function(e){return this.$el.val(e),this.trigger("valid",e)}}),e.namespace("view.form").MiField=r.View.extend({tagName:"input",className:"edm-form-mifield within-field",attributes:{type:"text",maxlength:3},events:{change:"onChange",blur:"onChange",keyup:"validate",keypress:"onKeyPress"},initialize:function(){n.defaults(this.options,{min:1,max:100,radius:100}),this.tooltip=this.tooltip=new e.view.Tooltip({className:"nvcwidget-tooltip",text:"The Radius is invalid"}),this.on("valid",this.onValid,this),this.on("invalid",this.onInvalid,this)},onChange:function(){var e=this.$el.val(),t=this.validate();t&&this.$el.val(Number(e))},render:function(){return this.$el.val(this.options.radius),this.$el.before(this.tooltip.render().el),this},validate:function(){var e=Number(this.$el.val());return this.$el.val().length?/\d+/.test(e)?e!==Math.round(e)?(this.trigger("invalid","Radius must be an integer"),!1):e>this.options.max?(this.trigger("invalid","Radius must be less than or equal to "+this.options.max),!1):e<this.options.min?(this.trigger("invalid","Radius must be greater than or equal to "+this.options.min),!1):(this.trigger("valid",e),!0):(this.trigger("invalid","Radius must be a number"),!1):(this.trigger("invalid","Radius must not be empty"),!1)},onValid:function(){this.tooltip.hide()},onInvalid:function(e){this.tooltip.setText(e).show()},onKeyPress:function(t){var r=t.which,i=e.event.KeyCode,s=[i.BACKSPACE,i.DELETE,i.TAB,i.ENTER,i.ARROW_LEFT,i.ARROW_UP,i.ARROW_RIGHT,i.ARROW_DOWN];if(t.shiftKey||t.altKey||t.ctrlKey||t.metaKey)return;if(String.fromCharCode(r).match(/\d/))return;if((!t.which||!t.charCode)&&t.keyCode&&n.contains(s,t.keyCode))return;return t.preventDefault(),!1}}),e.namespace("view.form").ZipUpdate=r.View.extend({className:"edm-form-zipupdate zipcode-update",initialize:function(t){this.zipField=new e.view.form.ZipField({vehicleApiKey:t.vehicleApiKey,zipCode:t.zipCode}),this.zipField.on("valid",this.onZipValid,this),this.zipField.on("invalid",this.onZipInvalid,this),this.zipField.on("blur",this.onZipBlur,this),this.button=new e.view.form.Button({className:"button-light",text:"Update"}),this.button.on("click",this.onButtonClick,this)},render:function(){var e=this.$el;return e.append("<label>ZIP: </label>"),e.append(this.zipField.el),e.append(this.button.render().el),this.zipField.render(),this},disable:function(){return this.button.disable(),this.zipField.disable(),this},enable:function(){return this.button.enable(),this.zipField.enable(),this},onButtonClick:function(){this.trigger("update",this.zipField.$el.val())},onZipValid:function(){this.button.enable()},onZipInvalid:function(){this.button.disable()},updateZipCode:function(e){this.zipField.updateZipCode(e)}}),e.namespace("view.form").ZipLocation=e.view.form.ZipUpdate.extend({className:"edm-form-zipupdate zipcode-update",template:['<span class="name">Prices for Zip code</span>','<div class="zip-code tab2-zip"></div>','<span class="state">&nbsp;</span>'],initialize:function(t){e.view.form.ZipUpdate.prototype.initialize.apply(this,arguments),this.vehicleApi=new EDMUNDSAPI.Vehicle(t.vehicleApiKey)},render:function(){return this.$el.html(this.template),this.$(".zip-code").append(this.zipField.el),this.$(".zip-code").after(this.button.render().el),this.zipField.render(),this},onButtonClick:function(){this.trigger("update",this.zipField.$el.val())},loadLocation:function(){var e=n.bind(this.onLocationLoad,this),t=this.zipField.$el.val();this.vehicleApi.getUpdateLocation(t,e)},onLocationLoad:function(e){var t=this.parseLocation(e);this.setLocationText(t),this.trigger("location-load")},parseLocation:function(e){var t={state:e.regionsHolder?e.regionsHolder[0].name:null,stateCode:e.regionsHolder?e.regionsHolder[0].stateCode:null};return t},setLocationText:function(e){var t=e.state?e.state+", "+e.stateCode:"Please click UPDATE button one more time.";return this.$(".state").text(t),this},updateZipCode:function(e){this.zipField.updateZipCode(e),this.loadLocation()}}),e.namespace("view.form").ZipMiField=e.view.form.ZipUpdate.extend({className:"edm-form-zipupdate zipcode-update",template:['<div class="name"><b>1.</b> Select dealer near your location</div>','<div class="zip-code"></div>','<div class="within"><span>within</span><span>mi</span></div>'],initialize:function(t){e.view.form.ZipUpdate.prototype.initialize.apply(this,arguments),this.miField=new e.view.form.MiField({radius:this.options.radius}),this.miField.on("valid",this.onRadiusValid,this),this.miField.on("invalid",this.onRadiusInValid,this),this.isValidZip=n.has(this.options,"zipCode"),this.isValidRadius=n.has(this.options,"radius")},render:function(){return this.$el.html(this.template),this.$(".zip-code").append("<label>ZIP: </label>"),this.$(".zip-code").append(this.zipField.el),this.$(".within").after(this.button.render().el),this.$(".within span:first").after(this.miField.el),this.zipField.render(),this.miField.render(),this},toggleButton:function(){this.button[this.isValidZip&&this.isValidRadius?"enable":"disable"]()},onButtonClick:function(){this.trigger("update",this.zipField.$el.val(),this.miField.$el.val())},onZipValid:function(){this.isValidZip=!0,this.toggleButton()},onZipInvalid:function(){this.isValidZip=!1,this.toggleButton()},onRadiusValid:function(){this.isValidRadius=!0,this.toggleButton()},onRadiusInValid:function(){this.isValidRadius=!1,this.toggleButton()}}),e.namespace("view").IncentivesAndRebates=r.View.extend({className:"incentives",events:{"click .switcher":"toggleState"},template:['<div class="incentive-toggle">','<div class="switcher-wrapper">','<span class="">Include in TMV<sup>&reg;</sup></span>','<div class="switcher"></div>',"</div>",'<div class="incentive-label"><i class="icon-incentive"></i>Incentives</div>',"</div>",'<div class="incentive-info">','<span class="incentive-price"><%= _.currency(incentive) %></span>','<span class="incentive-subprogram">Customer Cash<div class="nvcwidget-tooltip"><div class="arrow-left"></div><%= description %></div></span>',"</div>"].join(""),render:function(){return this.$el.html(n.template(this.template,{incentive:this.options.incentive,description:u.TOOLTIP_CUSTOMERCASH})),this.switcher=this.$(".switcher"),this.options.turnedOn?this.switcher.removeClass("off").addClass("on"):this.switcher.removeClass("on").addClass("off"),this},toggleState:function(){return this.switcher.toggleClass("on off"),this.trigger("change",this.switcher.hasClass("on")),this}}),function(){var t=r.Model.extend({defaults:{name:"",status:"available",price:{tmv:0,baseMSRP:0,baseInvoice:0}},setAvailable:function(){return this.set("status",t.STATUS_AVAILABLE)},setExcluded:function(){return this.set("status",t.STATUS_EXCLUDED)},setIncluded:function(){return this.set("status",t.STATUS_INCLUDED)},setSelected:function(){return this.set("status",t.STATUS_SELECTED)},isAvailable:function(){return this.get("status")===t.STATUS_AVAILABLE},isExcluded:function(){return this.get("status")===t.STATUS_EXCLUDED},isIncluded:function(){return this.get("status")===t.STATUS_INCLUDED},isSelected:function(){return this.get("status")===t.STATUS_SELECTED},isUnavailableSelected:function(){return this.get("status")===t.STATUS_UNAVAILABLE_SELECTED},isColor:function(){return this.get("type")===t.TYPE_COLOR},isOption:function(){return this.get("type")===t.TYPE_OPTION}},{fromFeaturesMapObject:function(e){return new t({id:e.id,name:e.name,type:e.equipmentType})},STATUS_AVAILABLE:"available",STATUS_INCLUDED:"included",STATUS_EXCLUDED:"excluded",STATUS_SELECTED:"selected",STATUS_UNAVAILABLE_SELECTED:"unavailable selected",TYPE_COLOR:"color",TYPE_OPTION:"option"});e.namespace("model").Feature=t}(),function(t){var n=t.extend({},{fromFeaturesMapObject:function(e){var t={id:e.id,name:e.name,type:e.equipmentType},r=e.attributeGroups;return r.COLOR_INFO&&r.COLOR_INFO.attributes.MANUFACTURER_OPTION_NAME&&(t.name=r.COLOR_INFO.attributes.MANUFACTURER_OPTION_NAME.value),r.COLOR_TYPE&&r.COLOR_TYPE.attributes.COLOR_TYPE&&(t.category=r.COLOR_TYPE.attributes.COLOR_TYPE.value),r.COLOR_CHIPS&&(r.COLOR_CHIPS.attributes.PRIMARY_R_CODE&&r.COLOR_CHIPS.attributes.PRIMARY_G_CODE&&r.COLOR_CHIPS.attributes.PRIMARY_B_CODE&&(t.primaryColor={r:r.COLOR_CHIPS.attributes.PRIMARY_R_CODE.value,g:r.COLOR_CHIPS.attributes.PRIMARY_G_CODE.value,b:r.COLOR_CHIPS.attributes.PRIMARY_B_CODE.value}),r.COLOR_CHIPS.attributes.SECONDARY_R_CODE&&r.COLOR_CHIPS.attributes.SECONDARY_G_CODE&&r.COLOR_CHIPS.attributes.SECONDARY_B_CODE&&(t.secondaryColor={r:r.COLOR_CHIPS.attributes.SECONDARY_R_CODE.value,g:r.COLOR_CHIPS.attributes.SECONDARY_G_CODE.value,b:r.COLOR_CHIPS.attributes.SECONDARY_B_CODE.value})),t.price=e.price,new n(t)}});e.namespace("model.feature").Color=n}(e.model.Feature),function(t){var n=t.extend({},{fromFeaturesMapObject:function(e){var t={id:e.id,name:e.name,type:e.equipmentType},r=e.attributeGroups;return r.OPTION_INFO&&r.OPTION_INFO.attributes.MANUFACTURER_OPTION_NAME&&(t.name=r.OPTION_INFO.attributes.MANUFACTURER_OPTION_NAME.value),r.OPTION_INFO&&r.OPTION_INFO.attributes.OPTION_CATEGORY?t.category=r.OPTION_INFO.attributes.OPTION_CATEGORY.value:t.category="Other",t.price=e.price,new n(t)}});e.namespace("model.feature").Option=n}(e.model.Feature),function(t,i,s){var o=r.Collection.extend({model:t,currentState:{},previousState:{},comparator:function(e){var t=e.get("category")==="Additional Fees"?"_":"";return+e.get("id")<6&&(t+="_"),t+e.get("name")},saveCurrentState:function(){var e;return this.previousState=n.clone(this.currentState),e=this.currentState={available:[],selected:[],excluded:[],included:[]},this.each(function(t){t.isAvailable()&&e.available.push(t.get("id")),t.isSelected()&&e.selected.push(t.get("id")),t.isIncluded()&&e.included.push(t.get("id")),t.isExcluded()&&e.excluded.push(t.get("id"))}),this},applyOptions:function(e){function d(e){var t=this.get(e);return t&&t.isColor()}var r=this.mapByType(),i=r[t.TYPE_OPTION],s=r[t.TYPE_COLOR].mapByCategory(),o=[],u=[],a=[],f=[],l=[],c=[],h=[],p=[];u=n.union(this.currentState.selected,e.requiredItems,e.currentOptions,e.selectedOption),u=n.without(u,e.deselectedOption),u=n.difference(u,e.furtherRemovals,e.includedItems),f=e.excludedItems,h=n.filter(e.includedItems,d,this),l=n.difference(e.includedItems,h),p=n.filter(u,d,this),c=n.difference(u,p);var v=n.union(h,p),m=this.mapByTypeAndCategory(),g=m[t.TYPE_COLOR];return n.each(g,function(t){var r=t.pluck("id"),i=n.intersection(r,h),s=n.intersection(r,p),o=n.intersection(s,e.requiredItems);o.length&&(s=o),h=n.difference(h,r),p=n.difference(p,r),n.contains(i,e.selectedOption)?(p=n.without(p,e.selectedOption),h.push(e.selectedOption)):n.contains(s,e.selectedOption)?p.push(e.selectedOption):i.length>0?h.push(n.last(i)):p=n.union(p,s)},this),a=n.union(h,l),u=n.union(p,c),this.each(function(e){if(e.isAvailable()||e.isUnavailableSelected())return;e.setAvailable()},this),this.setExcluded(f),this.setIncluded(a),this.setSelected(u),this.saveCurrentState(),this},setPreviousState:function(){var e=this.previousState;return this.setAvailable(e.available),this.setExcluded(e.excluded),this.setIncluded(e.included),this.setSelected(e.selected),this.saveCurrentState(),this},resetState:function(){return this.previousState={},this.currentState={},this},mapByType:function(){var e={};return this.each(function(t){var n=t.get("type");e[n]||(e[n]=new o),e[n].add(t)}),e},mapByCategory:function(){var e={};return this.each(function(t){var n=t.get("category");e[n]||(e[n]=new o),e[n].add(t)}),e},mapByTypeAndCategory:function(){var e={};return n.each(this.mapByType(),function(t,n){e[n]=t.mapByCategory()}),e},setAvailable:function(e){return n.each(e,function(e){var t=this.get(e);t&&t.setAvailable()},this),this},setExcluded:function(e){return n.each(e,function(e){var t=this.get(e);t&&t.setExcluded()},this),this},setIncluded:function(e){return n.each(e,function(e){var t=this.get(e);t&&t.setIncluded()},this),this},setSelected:function(e){return n.each(e,function(e){var t=this.get(e);t&&t.setSelected()},this),this},getTotalPrice:function(){var e={tmv:0,baseMSRP:0,baseInvoice:0};return this.each(function(t){var n;if(t.isSelected()||t.isUnavailableSelected())n=t.get("price"),e.tmv+=Number(n.tmv)||0,e.baseMSRP+=n.baseMSRP,e.baseInvoice+=n.baseInvoice}),e},updatePrices:function(e){var r;return e.regionalAdjustment&&(r=this.get("000000003"),r?r.set("price",{tmv:Number(e.regionalAdjustment.tmv),baseMSRP:null,baseInvoice:null}):this.add({id:"000000003",name:"Regional Adjustment",category:"Additional Fees",type:t.TYPE_OPTION,status:t.STATUS_UNAVAILABLE_SELECTED,price:{tmv:Number(e.regionalAdjustment.tmv),baseMSRP:null,baseInvoice:null}})),e.colorAdjustment&&(r=this.get("000000004"),r?r.set("price",{tmv:Number(e.colorAdjustment.tmv),baseMSRP:null,baseInvoice:null}):this.add({id:"000000004",name:"Color Adjustment",category:"Additional Fees",type:t.TYPE_OPTION,status:t.STATUS_UNAVAILABLE_SELECTED,price:{tmv:Number(e.colorAdjustment.tmv),baseMSRP:null,baseInvoice:null}})),e.colorAdjustment&&(r=this.get("000000005"),r?r.set("price",{tmv:null,baseMSRP:null,baseInvoice:Number(e.regionalAdFee)||0}):this.add({id:"000000005",name:"Advertising Fee",category:"Additional Fees",type:t.TYPE_OPTION,status:t.STATUS_UNAVAILABLE_SELECTED,price:{tmv:null,baseMSRP:null,baseInvoice:Number(e.regionalAdFee)}})),n.each(e.optionTMVPrices,function(e,t){var r=this.get(t),i;r&&(i=r.get("price"),r.set("price",{tmv:n.isNull(e.tmv)?i.tmv:e.tmv,baseMSRP:n.isNull(e.baseMSRP)?i.baseMSRP:e.baseMSRP,baseInvoice:n.isNull(e.baseInvoice)?i.baseInvoice:e.baseInvoice}))},this),this}},{fromFeaturesMap:function(e){var r=[];return n.each(e,function(e,n){var o;switch(e.equipmentType){case t.TYPE_COLOR:o=i.fromFeaturesMapObject(e);break;case t.TYPE_OPTION:e.price?e.price.baseMSRP>=0&&(o=s.fromFeaturesMapObject(e)):o=s.fromFeaturesMapObject(e)}o&&r.push(o)}),new o(r)}});e.namespace("collection").Features=o}(e.model.Feature,e.model.feature.Color,e.model.feature.Option),e.namespace("view.features").Category=r.View.extend({className:"features-category-head",events:{click:"onClick"},template:['<div class="inner">','<div class="features-category-price"><%= _.currency(totalPrice.baseMSRP) %></div>','<div class="features-category-title"><%= categoryName %></div>',"</div>"].join(""),initialize:function(){this.collection.on("reset",this.updateTotalPrice,this),this.template=n.template(this.template),this.setTitle(this.options.categoryName)},render:function(){return this.el.innerHTML=this.template({categoryName:this.categoryName,totalPrice:this.collection.getTotalPrice()}),this},updateTotalPrice:function(){var e=this.collection.getTotalPrice();return this.$(".features-category-price").html(n.currency(e.baseMSRP)),this},onClick:function(){this.trigger("open",this.categoryName,this.collection)},setTitle:function(e){return this.categoryName=this.normalizeTitle(e||""),this.render()},normalizeTitle:function(e){var t=e.split(/[\s_]+/g);return n.each(t,function(e,t,n){n[t]=e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}),t.join(" ")}}),e.namespace("view.features.category").ColorCategory=e.view.features.Category.extend({template:['<div class="inner">','<div class="features-category-color">','<% if (feature && feature.has("secondaryColor")) { %>','<div class="feature-secondary-color" style="background-color: <%= _.rgb2hex(feature && feature.get("secondaryColor")) %>"></div>',"<% } %>",'<% if (feature && feature.has("primaryColor")) { %>','<div class="feature-primary-color" style="background-color: <%= _.rgb2hex(feature && feature.get("primaryColor")) %>"></div>',"<% } %>","</div>",'<div class="features-category-price"><%= _.currency(totalPrice.baseMSRP) %></div>','<div class="features-category-title"><%= categoryName %></div>',"</div>"].join(""),render:function(){var e=this.collection.filter(function(e){return e.isSelected()||e.isIncluded()})[0],t=this.collection.at(0),n="category-"+(t&&t.get("category")||"").toLowerCase().replace(/[\s_]+/g,"-");return this.el.innerHTML=this.template({categoryName:e?e.get("name"):"Select a color",totalPrice:this.collection.getTotalPrice(),feature:e}),this.$el.addClass(n),this}}),e.namespace("view.features").Categories=r.View.extend({categoriesMap:{},render:function(){var e="Package",t="Additional Fees",r="color",i="option",s,o;return this.$el.empty(),this.collection.length===0?(this.$el.html('<div class="alert">Sorry, we don\'t have configurable options for this vehicle.</div>'),this):(s=this.collection.mapByTypeAndCategory(),this.createGroupWrapper(),s[i]&&s[i][e]&&this.renderOptionsCategory(e,s[i][e]),this.createExtraGroupWrapper(),n.each(s[r],function(e,t){this.renderColorsCategory(t,e)},this),this.$extraGroupWrapper=null,this.createGroupWrapper(),s[i]&&this.$groupWrapper.append('<h6 class="features-category-title">Options</h6>'),n.each(s[i],function(n,r){r!==e&&r!==t&&this.renderOptionsCategory(r,n)},this),this.createGroupWrapper(),s[i]&&s[i][t]&&this.renderOptionsCategory(t,s[i][t]),this)},createGroupWrapper:function(){return this.$groupWrapper=t('<div class="features-group-wrapper"></div>').appendTo(this.$extraGroupWrapper||this.el),this},createExtraGroupWrapper:function(){return this.$extraGroupWrapper=t('<div class="features-extra-group-wrapper"></div>').appendTo(this.el),this},renderColorsCategory:function(t,n){var r=new e.view.features.category.ColorCategory({collection:n,categoryName:t});return r.on("open",this.openCategory,this),this.createGroupWrapper(),this.$groupWrapper.append('<h6 class="features-category-title">'+r.normalizeTitle(t)+"</h6>"),this.$groupWrapper.append(r.render().el),this.categoriesMap.color||(this.categoriesMap.color={}),this.categoriesMap.color[t]=r,this},renderOptionsCategory:function(t,n){var r=new e.view.features.Category({collection:n,categoryName:t});return r.on("open",this.openCategory,this),this.$groupWrapper.append(r.render().el),this.categoriesMap.option||(this.categoriesMap.option={}),this.categoriesMap.option[t]=r,this},refresh:function(){return n.each(this.categoriesMap.color,function(e){e.render()}),n.each(this.categoriesMap.option,function(e){e.updateTotalPrice()}),this},openCategory:function(e,t){this.trigger("opencategory",e,t)}}),e.namespace("view.features").ListItem=r.View.extend({tagName:"li",className:"features-list-item",events:{'click [type="checkbox"]':"onSelect"},template:['<label for="feature-<%= data.cid %>-<%= data.feature.get("id") %>">',"<% if (data.feature.isColor()) { %>",'<div class="feature-color">','<% if (data.feature.has("secondaryColor")) { %>','<div class="feature-secondary-color" style="background-color: <%= _.rgb2hex(data.feature.get("secondaryColor")) %>"></div>',"<% } %>",'<% if (data.feature.has("primaryColor")) { %>','<div class="feature-primary-color" style="background-color: <%= _.rgb2hex(data.feature.get("primaryColor")) %>"></div>',"<% } %>","<i></i>","</div>","<% } %>",'<input type="checkbox" id="feature-<%= data.cid %>-<%= data.feature.get("id") %>" value="<%= data.feature.get("id") %>">','<span class="feature-price feature-price-msrp"><%= _.currency(data.feature.get("price").baseMSRP) %></span>','<span class="feature-name"><span class="notification-icon"></span><%= data.feature.get("name") %></span>',"</label>"].join(""),initialize:function(){this.model.on("change",this.render,this)},render:function(){function i(e){return n.isNull(e)?"N/A":n.currency(e)}var e=this.model,t,r;return this.$el.html(n.template(this.template,{feature:e,cid:this.cid},{variable:"data"})).removeClass("available included excluded selected").addClass(e.get("status")).addClass(e.get("type")),t=this.$('[type="checkbox"]'),e.isSelected()?t.prop({checked:!0,disabled:!1}):e.isIncluded()||e.isUnavailableSelected()?t.prop({checked:!0,disabled:!0}):(e.isAvailable()||e.isExcluded())&&t.prop({checked:!1,disabled:!1}),e.isIncluded()?this.$(".feature-price").text("Included"):(r=this.model.get("price"),this.$(".feature-price-msrp").html(i(r.baseMSRP)),this.$(".feature-price-tmv").html(i(r.tmv)),this.$(".feature-price-invoice").html(i(r.baseInvoice))),this},onSelect:function(e){var t=e.target;e.preventDefault(),this.trigger("select",t.value,t.checked,this)}}),e.namespace("view.features").List=r.View.extend({tagName:"ul",className:"features-list",loadingText:"Loading options...",emptyText:"Sorry, we don't have configurable options for this vehicle.",initialize:function(){this.collection.on("reset",this.render,this),this.collection.on("request",this.onRequest,this)},render:function(){return this.$el.empty(),this.collection.length?(this.setClassName(),this.collection.each(this.add,this),this):(this.$el.html(this.emptyText),this)},add:function(t){var r;return n.isNull(t.get("price").baseMSRP)?this:(r=new e.view.features.ListItem({model:t}),r.on("select",this.onSelect,this),this.$el.append(r.render().el),this)},showLoadingOverlay:function(){this.loadingOverlay||(this.loadingOverlay=t('<li class="overlay"></li>')),this.loadingOverlay.appendTo(this.$el)},hideLoadingOverlay:function(){this.loadingOverlay&&this.loadingOverlay.remove()},onSelect:function(e,t,n){this.trigger("select",e,t,n)},onRequest:function(){this.showLoadingOverlay()},setClassName:function(){var e="category-"+(this.collection.at(0).get("category")||"").toLowerCase().replace(/[\s_]+/g,"-");return this.$el.removeClass().addClass(this.className).addClass(e),this}}),e.namespace("view.features").SelectedListItem=e.view.features.ListItem.extend({events:{'click [data-action="remove"]':"onRemoveClick"},template:['<a href="#" class="icon-remove" data-action="remove">','<div class="nvcwidget-tooltip"><div class="arrow-left"></div>Delete</div>',"</a>",'<span class="feature-price feature-price-msrp"><%= _.currency(data.feature.get("price").baseMSRP) %></span>','<span class="feature-price feature-price-tmv"><%= _.currency(data.feature.get("price").tmv) %></span>','<span class="feature-price feature-price-invoice"><%= _.currency(data.feature.get("price").baseInvoice) %></span>','<span class="feature-name"><span class="notification-icon"></span><%= data.feature.get("name") %></span>'].join(""),onRemoveClick:function(e){e.preventDefault(),this.trigger("select",this.model.get("id"),!1,this)}}),e.namespace("view.features").SelectedList=e.view.features.List.extend({className:"selected-features-list",emptyText:"",add:function(t){var n=new e.view.features.SelectedListItem({model:t});return n.on("select",this.onSelect,this),this.$el.append(n.render().el),this}}),e.namespace("view.features").SelectedFeatures=r.View.extend({className:"selected-features",headerTemplate:['<div class="selected-features-header">','<div class="headers-row">','<div class="price-dropdown">','<div class="arrow"></div>',"<ul>",'<li data-price-type="msrp">MSRP</li>','<li data-price-type="tmv">TMV&reg;</li>','<li data-price-type="invoice">Invoice</li>',"</ul>","</div>",'<div class="feature-price feature-price-msrp">MSRP</div>','<div class="feature-price feature-price-tmv">TMV&reg;</div>','<div class="feature-price feature-price-invoice">Invoice</div>','<div class="feature-name">Description</div>',"</div>",'<div class="base-price-row">','<div class="feature-price feature-price-msrp">$0</div>','<div class="feature-price feature-price-tmv">$0</div>','<div class="feature-price feature-price-invoice">$0</div>','<div class="feature-name">Base Price</div>',"</div>","</div>"].join(""),footerTemplate:['<div class="selected-features-footer">','<div class="total-price-row">','<div class="feature-price feature-price-msrp">$0</div>','<div class="feature-price feature-price-tmv">$0</div>','<div class="feature-price feature-price-invoice">$0</div>','<div class="feature-name">Total Price</div>',"</div>","</div>"].join(""),initialize:function(t){this.basePrice=this.setBasePrice(t.basePrice),this.list=new e.view.features.SelectedList({collection:this.collection})},render:function(){var e=n.template(this.headerTemplate,{baseMSRP:this.baseMSRP}),t=n.template(this.footerTemplate,{totalPrice:this.totalPrice});return this.$el.append(e),this.initPriceDropdown(),this.$el.append(this.list.el),this.$el.append(t),this},initPriceDropdown:function(){function i(n){var r=e.$(".feature-price");r.hide(),r.filter(function(){return t(this).hasClass("feature-price-"+n)}).show()}var e=this,n=this.$(".price-dropdown"),r=n.find("ul");return n.on({mouseenter:function(){r.show()},mouseleave:function(){r.hide()}}),r.find("li").on("click",function(){i(t(this).data("priceType")),r.hide()}),this},resize:function(){var e=this.$el.parent().height(),t=this.$(".selected-features-header"),n=this.$(".selected-features-footer"),r=t.height(),i=n.height(),s=this.$(".selected-features-list > :first"),o,u;if(this.$el.closest(".nvcwidget").hasClass("nvcwidget-wide")||this.$el.closest(".nvcwidget").hasClass("nvcwidget-x-wide"))e=this.$el.closest(".w1").height();return this.list.$el.css("max-height",e-(r+i)),s.length===1&&(o=s.outerWidth(),u=Math.max(n.outerWidth()-o,0),t.css("padding-right",u),n.css("padding-right",u)),this},setBasePrice:function(e){var t=this.$(".selected-features-header .base-price-row");return this.basePrice=e||{tmv:0,baseMSRP:0,baseInvoice:0},t.find(".feature-price-msrp").text(n.currency(this.basePrice.baseMSRP)),t.find(".feature-price-tmv").text(n.currency(this.basePrice.tmv)),t.find(".feature-price-invoice").text(n.currency(this.basePrice.baseInvoice)),this.updateTotalPrice(),this},updateTotalPrice:function(){var e=this.collection.getTotalPrice(),t=this.basePrice,r=this.$(".selected-features-footer");return r.find(".feature-price-msrp").text(n.currency(t.baseMSRP+e.baseMSRP)),r.find(".feature-price-tmv").text(n.currency(t.tmv+e.tmv)),r.find(".feature-price-invoice").text(n.currency(t.baseInvoice+e.baseInvoice)),this}}),e.namespace("view.features").Notification=r.View.extend({className:"feature-notification",events:{'click [data-action="ok"]':"onOkClick",'click [data-action="cancel"]':"onCancelClick"},itemTemplate:["<li>",'<span class="feature-price"><%= _.currency(feature.get("price").baseMSRP) %></span>','<span class="feature-name"><%= feature.get("name") %></span>',"</li>"].join(""),render:function(){var e,r;return this.options.required.length&&(this.$el.append("<p>Your selection requires the following:</p>"),e=t("<ul/>").appendTo(this.el),n.each(this.options.required,function(t){r=n.template(this.itemTemplate,t,{variable:"feature"}),e.append(r)},this),this.$el.append("<p>which will be selected.</p>")),this.options.excluded.length&&(this.options.required.length?this.$el.append("<p>And excludes the following:</p>"):this.$el.append("<p>Your selection excludes the following:</p>"),e=t("<ul/>").appendTo(this.el),n.each(this.options.excluded,function(t){r=n.template(this.itemTemplate,t,{variable:"feature"}),e.append(r)},this)),this.$el.append("<p>Continue with these changes?</p>"),this.$el.append(['<div class="feature-notification-buttons">','<button type="button" data-action="ok">Yes, continue</button>','<button type="button" data-action="cancel">Do not change</button>',"</div>"].join("")),this},onOkClick:function(){this.trigger("ok")},onCancelClick:function(){this.trigger("cancel")}}),e.namespace("view.features").CategoryList=r.View.extend({className:"features-category",events:{'[data-action="close"]':"onCloseClick"},initialize:function(){this.head=new e.view.features.Category({categoryName:this.options.categoryName,collection:this.collection}),this.list=new e.view.features.List({collection:this.collection}),this.button=new e.view.form.Button({className:"button-small button-light",text:"Close"}),this.button.on("click",this.close,this)},render:function(){return this.$el.html(this.head.render().el),this.$el.append(this.list.el),this.$el.append('<div class="features-category-footer"></div>'),this.$(".features-category-footer").append(this.button.render().el),this},close:function(){return this.trigger("close")}}),function(){var i=function(e){this.initialize(e)};n.extend(i.prototype,r.Events,{defaults:{},initialize:function(r){return this.options=n.extend({},this.defaults,r),this.features=new e.collection.Features,this.features.on("reset",this.renderCategories,this),this.$categoriesEl=t("#"+this.options.baseId+"_options"),this.$featuresEl=t("#"+this.options.baseId+"_category_features_list"),this.$selectedFeaturesEl=t("#"+this.options.baseId+"_options_list"),this.categoryListView=new e.view.features.CategoryList({el:this.$featuresEl,collection:new e.collection.Features}),this.categoryListView.render(),this.categoryListView.on("close",this.closeCategory,this),this.categoryListView.list.on("select",this.onSelectFeature,this),this.selectedFeatures=new e.view.features.SelectedFeatures({collection:new e.collection.Features}),this.selectedFeatures.list.on("select",this.onSelectFeature,this),t("#"+this.options.baseId+"_list_options").html(this.selectedFeatures.render().el),this},onSelectFeature:function(e,t,n){var r={},i=t?"select":"deselect";r[t?"selectedId":"deselectedId"]=e,this.trigger("vehicle.feature."+i,e),this.removeNotification(),this.selectedItemView=n,this.getConfigWithOptions(r)},getDefaultConfig:function(n){var r=this.features,i=this;return n=n||{},this.$categoriesEl.html('<div class="alert">Loading options...</div>'),this.$featuresEl.hide(),this.$categoriesEl.show(),(!n.previous||this.isNewStyle)&&this.features.resetState(),t.ajax({url:"http://api.edmunds.com/v1/api/configurator/default",data:{api_key:this.options.vehicleApiKey,zip:this.options.zipCode,styleid:this.options.styleId},timeout:7e3,dataType:"jsonp",success:function(t){if(t.error||t.errorMessage){r.reset(),i.updateSelectedList(),i.trigger("loaderror");return}var s=e.collection.Features.fromFeaturesMap(t.featuresMap),o=i.parseAdditionalFees(t);s.add(o),r.reset(s.models),i.updateFeaturesStatus(t,n.previous,{silent:!0}),i.trigger("load",t)},error:function(){r.reset(),i.updateSelectedList(),i.trigger("loaderror")}})},getConfigWithOptions:function(e){var n=this.features,r=this.categoryListView.list,i=this;return r&&r.showLoadingOverlay(),t.ajax({url:"http://api.edmunds.com/v1/api/configurator/withOptions",data:{zip:this.options.zipCode,api_key:this.options.vehicleApiKey,styleid:this.options.styleId,optionid:this.features.currentState.selected,selected:e.selectedId,deselected:e.deselectedId},traditional:!0,timeout:7e3,dataType:"jsonp",success:function(t){if(t.errorMessage){i.updateFeaturesStatus({selectedOption:e.selectedId,deselectedOption:e.deselectedId});return}if(t.error){i.trigger("updateerror");return}if(t.requiredItems.length||t.furtherRemovals.length)return i.showNotification(t);i.updateFeaturesStatus(t)},error:function(){},complete:function(){r&&r.hideLoadingOverlay(),i.updateSelectedList()}})},resizeCategoryList:function(){var e=this.categoryListView.$el,t=e.parent().height(),n;n=t-(e.find(".features-category-head").outerHeight()+e.find(".features-category-footer").outerHeight()),e.find(".features-list").height(n)},parseAdditionalFees:function(t){if(t.error||t.hasOwnProperty("errorType")){this.trigger("loaderror");return}var n=t.pricingAttributeGroup.attributes,r=e.model.Feature,i=[],s;return n.DELIVERY_CHARGE&&n.DELIVERY_CHARGE.value>0&&(s=new r({id:"000000001",name:"Destination Fee",category:"Additional Fees",type:r.TYPE_OPTION,status:r.STATUS_UNAVAILABLE_SELECTED,price:{tmv:Number(n.DELIVERY_CHARGE.value),baseMSRP:Number(n.DELIVERY_CHARGE.value),baseInvoice:Number(n.DELIVERY_CHARGE.value)}}),i.push(s)),n.GAS_GUZZLER_TAX&&n.GAS_GUZZLER_TAX.value>0&&(s=new r({id:"000000002",name:"Gas Guzzler Tax",category:"Additional Fees",type:r.TYPE_OPTION,status:r.STATUS_UNAVAILABLE_SELECTED,price:{tmv:Number(n.GAS_GUZZLER_TAX.value),baseMSRP:Number(n.GAS_GUZZLER_TAX.value),baseInvoice:Number(n.GAS_GUZZLER_TAX.value)}}),i.push(s)),t.tmv&&t.tmv.regionalAdjustment&&(s=new r({id:"000000003",name:"Regional Adjustment",category:"Additional Fees",type:r.TYPE_OPTION,status:r.STATUS_UNAVAILABLE_SELECTED,price:{tmv:Number(t.tmv.regionalAdjustment.tmv),baseMSRP:null,baseInvoice:null}}),i.push(s)),t.tmv&&t.tmv.colorAdjustment&&(s=new r({id:"000000004",name:"Color Adjustment",category:"Additional Fees",type:r.TYPE_OPTION,status:r.STATUS_UNAVAILABLE_SELECTED,price:{tmv:Number(t.tmv.colorAdjustment.tmv),baseMSRP:null,baseInvoice:null}}),i.push(s)),s=new r({id:"000000005",name:"Advertising Fee",category:"Additional Fees",type:r.TYPE_OPTION,status:r.STATUS_UNAVAILABLE_SELECTED,price:{tmv:null,baseMSRP:null,baseInvoice:Number(t.tmv.regionalAdFee)}}),i.push(s),i},getSelectedOptionsIds:function(){var e=this.features.filter(function(e){return e.isSelected()});return n.map(e,function(e){return e.get("id")})},showNotification:function(t){function r(e){return this.features.filter(function(t){return n.contains(e,t.get("id"))})}this.removeNotification(),this.notification=new e.view.features.Notification({required:r.call(this,n.without(t.requiredItems,t.selectedOption)),excluded:r.call(this,t.furtherRemovals)}),this.notification.on("ok",function(){this.updateFeaturesStatus(t),this.removeNotification()},this),this.notification.on("cancel",function(){this.removeNotification()},this),this.selectedItemView&&(this.selectedItemView.$el.addClass("active"),this.selectedItemView.$el.append(this.notification.render().el))},removeNotification:function(){this.notification&&this.notification.remove(),this.selectedItemView&&this.selectedItemView.$el.removeClass("active")},updateFeaturesStatus:function(e,t,n){return this.features.applyOptions(e),t&&this.features.setPreviousState(),this.updateSelectedList(),this.categories.refresh(),this.categoryListView.head.updateTotalPrice(),(!n||n&&!n.silent)&&this.trigger("updatestatus"),this},setStyleId:function(e){return this.isNewStyle=this.options.styleId!==e,this.options.styleId=e,this},setZipCode:function(e){return this.options.zipCode=e,this},renderCategories:function(){return this.categories=new e.view.features.Categories({collection:this.features}),this.categories.on("opencategory",this.openCategory,this),this.$categoriesEl.html(this.categories.render().el),this},openCategory:function(e,t){return this.categoryListView.head.setTitle(e),this.categoryListView.collection.reset(t.models),this.$categoriesEl.hide(),this.$featuresEl.show(),this.resizeCategoryList(),this},closeCategory:function(){return this.removeNotification(),this.$featuresEl.hide(),this.$categoriesEl.show(),this},updateSelectedList:function(){var e=this.features.filter(function(e){return e.isSelected()||e.isIncluded()||e.isUnavailableSelected()});this.selectedFeatures.collection.reset(e),this.selectedFeatures.updateTotalPrice().resize()},setBasePrice:function(e){return this.selectedFeatures.updateBasePrice(e),this},reset:function(){return this.$featuresEl.hide(),this.$categoriesEl.empty(),this.$categoriesEl.show(),this}}),e.namespace("controller").VehicleFeatures=i}(),e.namespace("model.dealers").SearchCriteria=r.Model.extend({defaults:{api_key:"",makeName:"",model:"",styleid:"",zipcode:"",keywords:"",premierOnly:!1,radius:100,rows:5,isPublic:!1,bookName:"",invalidTiers:"T1",sortBy:"dealer_distance:asc",fmt:"json"}}),e.namespace("model.dealers").Dealer=r.Model.extend({defaults:{address:{},displayinfo:{},ratings:{},selected:!1},getAddress:function(){var e=this.attributes.address;return e.city+", "+e.stateCode+" "+e.zipcode},getDistance:function(){return parseFloat(this.attributes.displayinfo.dealer_distance).toFixed(2)},getPhone:function(){return this.attributes.displayinfo.dealer_trackable_phone},getFullRating:function(){return parseFloat(this.attributes.ratings.SALES_OVERALL_RATING)||0},getRatingClassName:function(){var e=this.getFullRating();return(Math.round(e*2)/2).toString().replace(".","_")},getReviewsCount:function(){var e=this.attributes.ratings,t=parseInt(e.SALES_RECOMMENDED_REVIEW_COUNT,10)||0,n=parseInt(e.SALES_NOT_RECOMMENDED_REVIEW_COUNT,10)||0;return t+n},getSalesReviewsUrl:function(){return this.getUrl()+"/sales.1.html"},getUrl:function(){var e=this.attributes,t=e.address;return["http://www.edmunds.com/dealerships",t.stateName.replace(/\s+/g,""),t.city.replace(/\s+/g,""),e.logicalName].join("/")},isPremier:function(){return this.attributes.displayinfo.is_premier==="true"},isSelected:function(){return this.attributes.selected}}),e.namespace("collection").Dealers=r.Collection.extend({url:"http://api.edmunds.com/v1/api/dealer",model:e.model.dealers.Dealer,parse:function(e){return e.dealerHolder},setSelected:function(e){return n.each(e,function(t){var r=this.get(t);r?r.set("selected",!0):e=n.without(e,t)},this),e}}),e.namespace("view.dealers").ListItem=r.View.extend({className:"item",template:['<div class="item-inner"><div class="item-inner-bg">','<input type="checkbox" value="<%= dealer.get("id") %>" <% if (dealer.isSelected()) { %> checked="checked"<% } %>>','<div class="info">','<span class="name"><%= dealer.get("name") %></span>','<span class="map"><span><%= dealer.getDistance() %> mi</span><%= dealer.getAddress() %> <a href="<%= dealer.getUrl() %>" target="_blank"></a></span>','<span class="phone"><%= dealer.getPhone() %></span>','<span class="rating r<%= dealer.getRatingClassName() %>" title="<%= dealer.getFullRating() %>"></span>','<span class="reviews">','(<a href="<%= dealer.getSalesReviewsUrl() %>" target="_blank"><%= dealer.getReviewsCount() %> consumer review<% if (dealer.getReviewsCount() > 1) { print("s"); } %></a>)',"</span>","</div>","</div></div>"].join(""),initialize:function(){this.model.on("change",this.render,this)},render:function(){return this.el.innerHTML=n.template(this.template,{dealer:this.model}),this.model.isPremier()&&this.$el.addClass("premier-dealer"),this}}),e.namespace("view.dealers").List=r.View.extend({className:"list",events:{'click [data-action="select-all"]':"onSelectAllClick",'click [type="checkbox"]':"onChange"},initialize:function(){this.collection.on("reset",this.render,this),this.collection.on("request",this.onRequest,this)},render:function(){return this.collection.length===0?this.showMessage("There are no dealers in our network that are located within your location."):(this.collection.length===1&&(this.collection.at(0).set("selected",!0),this.trigger("change",this.collection.at(0),!0)),this.$el.empty(),this.collection.each(this.add,this),this)},add:function(t){var n=new e.view.dealers.ListItem({model:t});return this.el.appendChild(n.render().el),this},showMessage:function(e){return this.$el.html('<div class="loading">'+e+"</div>"),this},onChange:function(e){var t=e.target,n=this.collection.get(t.value);e.preventDefault(),n.set("selected",t.checked),this.trigger("change",n,t.checked)},onRequest:function(){return this.$el.html('<div class="loading">Loading dealers...</div>'),this.showMessage("Loading dealers...")}}),e.namespace("view").Dealers=r.View.extend({events:{"click .tab":"onTabClick"},selectedDealers:[],initialize:function(t){this.premierDealers=new e.view.dealers.List({collection:new e.collection.Dealers}),this.allDealers=new e.view.dealers.List({collection:new e.collection.Dealers}),this.premierDealers.on("change",this.onPremierChange,this),this.allDealers.on("change",this.onAllChange,this),this.searchCriteria=new e.model.dealers.SearchCriteria,this.searchCriteria.on("change",this.findDealers,this),this.searchCriteria.on("change:makeName",this.onMakeChange,this)},isGMC:function(){return this.searchCriteria.get("makeName")==="GMC"},onMakeChange:function(e,t){var n=t==="GMC";this.$('.tab[data-tab-id="all"]')[n?"show":"hide"](),this.showTabById("premier")},findDealers:function(){return this.findPremierDealers(),this.isGMC()&&this.findAllDealers(),this},findAllDealers:function(){var e=this;return this.searchCriteria.set("premierOnly",!1,{silent:!0}),this.allDealers.collection.fetch({data:this.searchCriteria.toJSON(),dataType:"jsonp",timeout:7e3,reset:!0}).done(n.bind(this.onFindAllDealersDone,this)).fail(n.bind(this.onFindAllDealersFail,this))},findPremierDealers:function(){return this.searchCriteria.set("premierOnly",!0,{silent:!0}),this.premierDealers.collection.fetch({data:this.searchCriteria.toJSON(),dataType:"jsonp",timeout:7e3,reset:!0}).done(n.bind(this.onFindPremierDealersDone,this)).fail(n.bind(this.onFindPremierDealersFail,this))},render:function(){return this.$(".tab-panel-premier").html(this.premierDealers.render().el),this.$(".tab-panel-all").html(this.allDealers.render().el),this},onFindPremierDealersDone:function(){this.selectedDealers=this.premierDealers.collection.setSelected(this.selectedDealers)},onFindPremierDealersFail:function(){this.premierDealers.collection.reset()},onFindAllDealersDone:function(){this.selectedDealers=this.allDealers.collection.setSelected(this.selectedDealers)},onFindAllDealersFail:function(){this.premierDealers.collection.reset()},onTabClick:function(e){var n=t(e.currentTarget),r="active";if(n.hasClass(r))return;this.showTabById(n.data("tabId"))},showTabById:function(e){var t="active";return this.$(".tab").removeClass(t).filter('[data-tab-id="'+e+'"]').addClass(t),this.$(".tab-panel").removeClass(t).filter(".tab-panel-"+e).addClass(t),this},onAllChange:function(e,t){var r=e.get("id"),i=this.premierDealers.collection.get(r);i&&i.set("selected",t),t?this.selectedDealers=n.union(this.selectedDealers,[r]):this.selectedDealers=n.without(this.selectedDealers,r),this.trigger(t?"select":"deselect",e)},onPremierChange:function(e,t){var r=e.get("id"),i=this.allDealers.collection.get(r);i&&i.set("selected",t),t?this.selectedDealers=n.union(this.selectedDealers,[r]):this.selectedDealers=n.without(this.selectedDealers,r),this.trigger(t?"select":"deselect",e)},getSelected:function(){var t=new e.collection.Dealers,n=function(e){return e.get("selected")};return t.add(this.allDealers.collection.filter(n)),t.add(this.premierDealers.collection.filter(n)),t},reset:function(){return this.selectedDealers=[],this.allDealers.collection.reset(),this.premierDealers.collection.reset(),this.searchCriteria.unset("makeName",{silent:!0}),this}})}(window.EDM,window.jQuery,window._,window.Backbone),define("util/GoogleAnalytics",[],function(){function n(n,r,i){_gaq.push(["_trackEvent",n,r,i]),e&&t.log("Track Event: "+[n,r,i].join(" => "))}var e=!1,t=window.console||{log:function(){}};return window._gaq=window._gaq||[],function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),{init:function(t){return e=!!t,_gaq.push(["_setAccount","UA-24637375-3"]),_gaq.push(["_trackPageview"]),this},normalizeEvents:function(e){e.styleConfigurator.makes.on("change",function(t){if(!t)return e.trigger("vehicle.style.deselect");e.trigger("vehicle.make.select",t.get("id"),t.get("name"))}),e.styleConfigurator.models.on("change",function(t){if(!t)return e.trigger("vehicle.model.deselect");e.trigger("vehicle.model.select",t.get("id"),t.get("name"))}),e.styleConfigurator.years.on("change",function(t){if(!t)return e.trigger("vehicle.year.deselect");e.trigger("vehicle.year.select",t.get("id"),t.get("year"))}),e.styleConfigurator.styles.on("change",function(t){if(!t)return e.trigger("vehicle.style.deselect");e.trigger("vehicle.style.select",t.get("id"),t.get("name"))}),e.vehicleFeaturesController.on("vehicle.feature.select",function(t){e.trigger("vehicle.feature.select",t)}),e.vehicleFeaturesController.on("vehicle.feature.deselect",function(t){e.trigger("vehicle.feature.deselect",t)}),e.dealers.on("select",function(t){e.trigger("dealer.select",t.get("id"))}),e.dealers.on("deselect",function(t){e.trigger("dealer.deselect",t.get("id"))}),e.zipUpdate.on("update",function(t){e.trigger("zip.update",t)}),e.zipLocation.on("update",function(t){e.trigger("ziplocation.update",t)}),e.zipMiField.on("update",function(t,n){e.trigger("zipmi.update",t,n)})},track:function(e){this.normalizeEvents(e),e.on("vehicle.make.select",function(e){n("Vehicle Configuration","Select a Make",e)}),e.on("vehicle.model.select",function(e){n("Vehicle Configuration","Select a Model",e)}),e.on("vehicle.year.select",function(e){n("Vehicle Configuration","Select a Year",e)}),e.on("vehicle.style.select",function(e){n("Vehicle Configuration","Select a Style",e)}),e.on("vehicle.make.deselect",function(){n("Vehicle Configuration","Unselect a Make")}),e.on("vehicle.model.deselect",function(){n("Vehicle Configuration","Deselect a Model")}),e.on("vehicle.year.deselect",function(){n("Vehicle Configuration","Deselect a Year")}),e.on("vehicle.style.deselect",function(){n("Vehicle Configuration","Deselect a Style")}),e.on("vehicle.feature.select",function(e){n("Vehicle Features","Select a vehicle feature",e)}),e.on("vehicle.feature.deselect",function(e){n("Vehicle Features","Deselect a vehicle feature",e)}),e.on("dealer.select",function(e){n("Dealers","Select a dealer",e)}),e.on("dealer.deselect",function(e){n("Dealers","Deselect a dealer",e)}),e.on("tab1.click",function(){n("Tabs","Click","Tab1")}),e.on("tab2.click",function(){n("Tabs","Click","Tab2")}),e.on("tab3.click",function(){n("Tabs","Click","Tab3")}),e.on("zip.update",function(e){n("Zip","Change Zip on the tab1",e)}),e.on("ziplocation.update",function(e){n("Zip","Change Zip on the tab2",e)}),e.on("zipmi.update",function(e,t){n("Zip","Change Zip and Radius","Zip: "+e+"; Radius: "+t)}),e.on("nextbtn1.click",function(){n("Buttons","Click","Next button on the first tab")}),e.on("nextbtn2.click",function(){n("Buttons","Click","Next button on the second tab")}),e.on("submitbtn.click",function(){n("Buttons","Click","Submit button on the third tab")}),e.on("dialogbtn.click",function(){n("Buttons","Click","Dialog button")})}}}),require(["view/vehicle/StyleConfigurator","util/GoogleAnalytics"],function(e,t){function s(e){var t;return e<485?t="narrow":e>=485&&e<720?t="medium":e>=720&&e<955?t="wide":t="x-wide",t}EDM.VehicleStyleConfigurator=e;var n=window.widgetConfig||{options:{},style:{}},r=window.widgetSubscriber||{},i;n.options.hasOwnProperty("apiKey")?i=new EDM.NVC(n.options.apiKey,n.options.apiKey,{root:"nvcwidget",baseClass:"nvcwidget"}):i=new EDM.NVC(n.options.vehicleApiKey,n.options.dealerApiKey,{root:"nvcwidget",baseClass:"nvcwidget"}),$(document.body).css({margin:0,padding:0}),$(i.getRootElement()).addClass("nvcwidget-"+s(n.style.width)),i.init({includedMakes:n.options.includedMakes,zip:n.options.zipCode,dealerKeywords:n.options.dealerKeywords,tabs:n.options.tabs,colorScheme:n.style.color,isNarrowLayout:n.style.width<485,layoutType:s(n.style.width)}),i.render(),t.init(n.debug),t.track(i),n.debug&&(window.widget=i),_.each(r._deferredEvents,function(e){i.on(e.name,e.callback,e.context)}),delete r._deferredEvents,r.on=function(e,t,n){i.on(e,t,n)}});